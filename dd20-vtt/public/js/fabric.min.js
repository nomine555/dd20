
/*
 Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,c,f){e!=Array.prototype&&e!=Object.prototype&&(e[c]=f.value)};
$jscomp.getGlobal=function(e){e=["object"==typeof globalThis&&globalThis,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,e];for(var c=0;c<e.length;++c){var f=e[c];if(f&&f.Math==Math)return f}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(e,c,f,b){if(c){f=$jscomp.global;e=e.split(".");for(b=0;b<e.length-1;b++){var a=e[b];a in f||(f[a]={});f=f[a]}e=e[e.length-1];b=f[e];c=c(b);c!=b&&null!=c&&$jscomp.defineProperty(f,e,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.fill",function(e){return e?e:function(c,f,b){var a=this.length||0;0>f&&(f=Math.max(0,a+f));if(null==b||b>a)b=a;b=Number(b);0>b&&(b=Math.max(0,a+b));for(f=Number(f||0);f<b;f++)this[f]=c;return this}},"es6","es3");
$jscomp.checkStringArgs=function(e,c,f){if(null==e)throw new TypeError("The 'this' value for String.prototype."+f+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+f+" must not be a regular expression");return e+""};
$jscomp.polyfill("String.prototype.repeat",function(e){return e?e:function(c){var f=$jscomp.checkStringArgs(this,null,"repeat");if(0>c||1342177279<c)throw new RangeError("Invalid count value");c|=0;for(var b="";c;)if(c&1&&(b+=f),c>>>=1)f+=f;return b}},"es6","es3");$jscomp.findInternal=function(e,c,f){e instanceof String&&(e=String(e));for(var b=e.length,a=0;a<b;a++){var g=e[a];if(c.call(f,g,a,e))return{i:a,v:g}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(c,f){return $jscomp.findInternal(this,c,f).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(e){var c=0;return function(){return c<e.length?{done:!1,value:e[c++]}:{done:!0}}};$jscomp.arrayIterator=function(e){return{next:$jscomp.arrayIteratorImpl(e)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(e,c){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:c})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function e(f){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(f||"")+"_"+c++,f)}var c=0;return e}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.asyncIterator;e||(e=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(e){$jscomp.initSymbolIterator();e={next:e};e[$jscomp.global.Symbol.iterator]=function(){return this};return e};
$jscomp.iteratorFromArray=function(e,c){$jscomp.initSymbolIterator();e instanceof String&&(e+="");var f=0,b={next:function(){if(f<e.length){var a=f++;return{value:c(a,e[a]),done:!1}}b.next=function(){return{done:!0,value:void 0}};return b.next()}};b[Symbol.iterator]=function(){return b};return b};$jscomp.polyfill("Array.prototype.keys",function(e){return e?e:function(){return $jscomp.iteratorFromArray(this,function(c){return c})}},"es6","es3");var fabric=fabric||{version:"3.6.3"};
"undefined"!==typeof exports?exports.fabric=fabric:"function"===typeof define&&define.amd&&define([],function(){return fabric});
if("undefined"!==typeof document&&"undefined"!==typeof window)fabric.document=document instanceof("undefined"!==typeof HTMLDocument?HTMLDocument:Document)?document:document.implementation.createHTMLDocument(""),fabric.window=window;else{var jsdom=require("jsdom"),virtualWindow=(new jsdom.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"})).window;fabric.document=virtualWindow.document;
fabric.jsdomImplForWrapper=require("jsdom/lib/jsdom/living/generated/utils").implForWrapper;fabric.nodeCanvas=require("jsdom/lib/jsdom/utils").Canvas;fabric.window=virtualWindow;DOMParser=fabric.window.DOMParser}fabric.isTouchSupported="ontouchstart"in fabric.window||"ontouchstart"in fabric.document||fabric.window&&fabric.window.navigator&&0<fabric.window.navigator.maxTouchPoints;fabric.isLikelyNode="undefined"!==typeof Buffer&&"undefined"===typeof window;fabric.SHARED_ATTRIBUTES="display transform fill fill-opacity fill-rule opacity stroke stroke-dasharray stroke-linecap stroke-dashoffset stroke-linejoin stroke-miterlimit stroke-opacity stroke-width id paint-order vector-effect instantiated_by_use clip-path".split(" ");
fabric.DPI=96;fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)";fabric.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig;fabric.reNonWord=/[ \n\.,;!\?\-]/;fabric.fontPaths={};fabric.iMatrix=[1,0,0,1,0,0];fabric.svgNS="http://www.w3.org/2000/svg";fabric.perfLimitSizeTotal=2097152;fabric.maxCacheSideLimit=4096;fabric.minCacheSideLimit=256;fabric.charWidthsCache={};fabric.textureSize=2048;fabric.disableStyleCopyPaste=!1;fabric.enableGLFiltering=!0;
fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1;fabric.browserShadowBlurConstant=1;fabric.arcToSegmentsCache={};fabric.boundsOfCurveCache={};fabric.cachesBoundsOfCurve=!0;fabric.forceGLPutImageData=!1;
fabric.initFilterBackend=function(){if(fabric.enableGLFiltering&&fabric.isWebglSupported&&fabric.isWebglSupported(fabric.textureSize))return console.log("max texture size: "+fabric.maxTextureSize),new fabric.WebglFilterBackend({tileSize:fabric.textureSize});if(fabric.Canvas2dFilterBackend)return new fabric.Canvas2dFilterBackend};"undefined"!==typeof document&&"undefined"!==typeof window&&(window.fabric=fabric);
(function(){function e(a,b){this.__eventListeners[a]&&(a=this.__eventListeners[a],b?a[a.indexOf(b)]=!1:fabric.util.array.fill(a,!1))}function c(a,b){this.__eventListeners||(this.__eventListeners={});if(1===arguments.length)for(var l in a)this.on(l,a[l]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(b);return this}function f(a,b){if(!this.__eventListeners)return this;if(0===arguments.length)for(a in this.__eventListeners)e.call(this,a);else if(1===arguments.length&&
"object"===typeof arguments[0])for(var l in a)e.call(this,l,a[l]);else e.call(this,a,b);return this}function b(a,b){if(!this.__eventListeners)return this;var l=this.__eventListeners[a];if(!l)return this;for(var d=0,g=l.length;d<g;d++)l[d]&&l[d].call(this,b||{});this.__eventListeners[a]=l.filter(function(a){return!1!==a});return this}fabric.Observable={observe:c,stopObserving:f,fire:b,on:c,off:f,trigger:b}})();
fabric.Collection={_objects:[],add:function(){this._objects.push.apply(this._objects,arguments);if(this._onObjectAdded)for(var e=0,c=arguments.length;e<c;e++)this._onObjectAdded(arguments[e]);this.renderOnAddRemove&&this.requestRenderAll();return this},insertAt:function(e,c,f){var b=this._objects;f?b[c]=e:b.splice(c,0,e);this._onObjectAdded&&this._onObjectAdded(e);this.renderOnAddRemove&&this.requestRenderAll();return this},remove:function(){for(var e=this._objects,c,f=!1,b=0,a=arguments.length;b<
a;b++)c=e.indexOf(arguments[b]),-1!==c&&(f=!0,e.splice(c,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[b]));this.renderOnAddRemove&&f&&this.requestRenderAll();return this},forEachObject:function(e,c){for(var f=this.getObjects(),b=0,a=f.length;b<a;b++)e.call(c,f[b],b,f);return this},getObjects:function(e){return"undefined"===typeof e?this._objects.concat():this._objects.filter(function(c){return c.type===e})},item:function(e){return this._objects[e]},isEmpty:function(){return 0===this._objects.length},
size:function(){return this._objects.length},contains:function(e){return-1<this._objects.indexOf(e)},complexity:function(){return this._objects.reduce(function(e,c){return e+=c.complexity?c.complexity():0},0)}};
fabric.CommonMethods={_setOptions:function(e){for(var c in e)this.set(c,e[c])},_initGradient:function(e,c){!e||!e.colorStops||e instanceof fabric.Gradient||this.set(c,new fabric.Gradient(e))},_initPattern:function(e,c,f){!e||!e.source||e instanceof fabric.Pattern?f&&f():this.set(c,new fabric.Pattern(e,f))},_initClipping:function(e){e.clipTo&&"string"===typeof e.clipTo&&(e=fabric.util.getFunctionBody(e.clipTo),"undefined"!==typeof e&&(this.clipTo=new Function("ctx",e)))},_setObject:function(e){for(var c in e)this._set(c,
e[c])},set:function(e,c){"object"===typeof e?this._setObject(e):"function"===typeof c&&"clipTo"!==e?this._set(e,c(this.get(e))):this._set(e,c);return this},_set:function(e,c){this[e]=c},toggle:function(e){var c=this.get(e);"boolean"===typeof c&&this.set(e,!c);return this},get:function(e){return this[e]}};
(function(e){var c=Math.sqrt,f=Math.atan2,b=Math.pow,a=Math.PI/180,g=Math.PI/2;fabric.util={cos:function(a){if(0===a)return 1;0>a&&(a=-a);switch(a/g){case 1:case 3:return 0;case 2:return-1}return Math.cos(a)},sin:function(a){if(0===a)return 0;var d=a/g,b=1;0>a&&(b=-1);switch(d){case 1:return b;case 2:return 0;case 3:return-b}return Math.sin(a)},removeFromArray:function(a,d){d=a.indexOf(d);-1!==d&&a.splice(d,1);return a},getRandomInt:function(a,d){return Math.floor(Math.random()*(d-a+1))+a},degreesToRadians:function(b){return b*
a},radiansToDegrees:function(b){return b/a},rotatePoint:function(a,d,b){a.subtractEquals(d);a=fabric.util.rotateVector(a,b);return(new fabric.Point(a.x,a.y)).addEquals(d)},rotateVector:function(a,d){var b=fabric.util.sin(d);d=fabric.util.cos(d);return{x:a.x*d-a.y*b,y:a.x*b+a.y*d}},transformPoint:function(a,d,b){return b?new fabric.Point(d[0]*a.x+d[2]*a.y,d[1]*a.x+d[3]*a.y):new fabric.Point(d[0]*a.x+d[2]*a.y+d[4],d[1]*a.x+d[3]*a.y+d[5])},makeBoundingBoxFromPoints:function(a,d){if(d)for(var b=0;b<a.length;b++)a[b]=
fabric.util.transformPoint(a[b],d);b=[a[0].x,a[1].x,a[2].x,a[3].x];d=fabric.util.array.min(b);b=fabric.util.array.max(b)-d;var g=[a[0].y,a[1].y,a[2].y,a[3].y];a=fabric.util.array.min(g);g=fabric.util.array.max(g);return{left:d,top:a,width:b,height:g-a}},invertTransform:function(a){var d=1/(a[0]*a[3]-a[1]*a[2]);d=[d*a[3],-d*a[1],-d*a[2],d*a[0]];a=fabric.util.transformPoint({x:a[4],y:a[5]},d,!0);d[4]=-a.x;d[5]=-a.y;return d},toFixed:function(a,d){return parseFloat(Number(a).toFixed(d))},parseUnit:function(a,
d){var b=/\D{0,2}$/.exec(a);a=parseFloat(a);d||(d=fabric.Text.DEFAULT_SVG_FONT_SIZE);switch(b[0]){case "mm":return a*fabric.DPI/25.4;case "cm":return a*fabric.DPI/2.54;case "in":return a*fabric.DPI;case "pt":return a*fabric.DPI/72;case "pc":return a*fabric.DPI/72*12;case "em":return a*d;default:return a}},falseFunction:function(){return!1},getKlass:function(a,d){a=fabric.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1));return fabric.util.resolveNamespace(d)[a]},getSvgAttributes:function(a){var d=
["instantiated_by_use","style","id","class"];switch(a){case "linearGradient":d=d.concat("x1 y1 x2 y2 gradientUnits gradientTransform".split(" "));break;case "radialGradient":d=d.concat("gradientUnits gradientTransform cx cy r fx fy fr".split(" "));break;case "stop":d=d.concat(["offset","stop-color","stop-opacity"])}return d},resolveNamespace:function(a){if(!a)return fabric;a=a.split(".");var d=a.length,b,g=e||fabric.window;for(b=0;b<d;++b)g=g[a[b]];return g},loadImage:function(a,d,b,g){if(a){var l=
fabric.util.createImage(),k=function(){d&&d.call(b,l);l=l.onload=l.onerror=null};l.onload=k;l.onerror=function(){fabric.log("Error loading "+l.src);d&&d.call(b,null,!0);l=l.onload=l.onerror=null};0!==a.indexOf("data")&&g&&(l.crossOrigin=g);"data:image/svg"===a.substring(0,14)&&(l.onload=null,fabric.util.loadImageInDom(l,k));l.src=a}else d&&d.call(b,a)},loadImageInDom:function(a,b){var d=fabric.document.createElement("div");d.style.width=d.style.height="1px";d.style.left=d.style.top="-100%";d.style.position=
"absolute";d.appendChild(a);fabric.document.querySelector("body").appendChild(d);a.onload=function(){b();d.parentNode.removeChild(d);d=null}},enlivenObjects:function(a,d,b,g){function l(){++c===f&&d&&d(k.filter(function(a){return a}))}a=a||[];var k=[],c=0,f=a.length;f?a.forEach(function(a,d){a&&a.type?fabric.util.getKlass(a.type,b).fromObject(a,function(b,c){c||(k[d]=b);g&&g(a,b,c);l()}):l()}):d&&d(k)},enlivenPatterns:function(a,d){a=a||[];var b=[],g=0,l=a.length;l?a.forEach(function(a,k){a&&a.source?
new fabric.Pattern(a,function(a){b[k]=a;++g===l&&d&&d(b)}):(b[k]=a,++g===l&&d&&d(b))}):d&&d(b)},groupSVGElements:function(a,b,g){if(a&&1===a.length)return a[0];b&&(b.width&&b.height?b.centerPoint={x:b.width/2,y:b.height/2}:(delete b.width,delete b.height));a=new fabric.Group(a,b);"undefined"!==typeof g&&(a.sourcePath=g);return a},populateWithProperties:function(a,b,g){if(g&&"[object Array]"===Object.prototype.toString.call(g))for(var d=0,l=g.length;d<l;d++)g[d]in a&&(b[g[d]]=a[g[d]])},drawDashedLine:function(a,
b,g,h,m,e){h-=b;var d=m-g;m=c(h*h+d*d);h=f(d,h);d=e.length;var l=0,k=!0;a.save();a.translate(b,g);a.moveTo(0,0);a.rotate(h);for(b=0;m>b;)b+=e[l++%d],b>m&&(b=m),a[k?"lineTo":"moveTo"](b,0),k=!k;a.restore()},createCanvasElement:function(){return fabric.document.createElement("canvas")},copyCanvasElement:function(a){var b=fabric.util.createCanvasElement();b.width=a.width;b.height=a.height;b.getContext("2d").drawImage(a,0,0);return b},toDataURL:function(a,b,g){return a.toDataURL("image/"+b,g)},createImage:function(){return fabric.document.createElement("img")},
clipContext:function(a,b){b.save();b.beginPath();a.clipTo(b);b.clip()},multiplyTransformMatrices:function(a,b,g){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],g?0:a[0]*b[4]+a[2]*b[5]+a[4],g?0:a[1]*b[4]+a[3]*b[5]+a[5]]},qrDecompose:function(g){var d=f(g[1],g[0]),k=b(g[0],2)+b(g[1],2),l=c(k),m=(g[0]*g[3]-g[2]*g[1])/l;k=f(g[0]*g[2]+g[1]*g[3],k);return{angle:d/a,scaleX:l,scaleY:m,skewX:k/a,skewY:0,translateX:g[4],translateY:g[5]}},calcRotateMatrix:function(a){if(!a.angle)return fabric.iMatrix.concat();
var b=fabric.util.degreesToRadians(a.angle);a=fabric.util.cos(b);b=fabric.util.sin(b);return[a,b,-b,a,0,0]},calcDimensionsMatrix:function(a){var b="undefined"===typeof a.scaleX?1:a.scaleX,g="undefined"===typeof a.scaleY?1:a.scaleY;b=[a.flipX?-b:b,0,0,a.flipY?-g:g,0,0];g=fabric.util.multiplyTransformMatrices;var l=fabric.util.degreesToRadians;a.skewX&&(b=g(b,[1,0,Math.tan(l(a.skewX)),1],!0));a.skewY&&(b=g(b,[1,Math.tan(l(a.skewY)),0,1],!0));return b},composeMatrix:function(a){var b=[1,0,0,1,a.translateX||
0,a.translateY||0],g=fabric.util.multiplyTransformMatrices;a.angle&&(b=g(b,fabric.util.calcRotateMatrix(a)));if(a.scaleX||a.scaleY||a.skewX||a.skewY||a.flipX||a.flipY)b=g(b,fabric.util.calcDimensionsMatrix(a));return b},customTransformMatrix:function(a,b,g){return fabric.util.composeMatrix({scaleX:a,scaleY:b,skewX:g})},resetObjectTransform:function(a){a.scaleX=1;a.scaleY=1;a.skewX=0;a.skewY=0;a.flipX=!1;a.flipY=!1;a.rotate(0)},saveObjectTransform:function(a){return{scaleX:a.scaleX,scaleY:a.scaleY,
skewX:a.skewX,skewY:a.skewY,angle:a.angle,left:a.left,flipX:a.flipX,flipY:a.flipY,top:a.top}},getFunctionBody:function(a){return(String(a).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(a,b,g,c){0<c&&(b=b>c?b-c:0,g=g>c?g-c:0);var d=!0;b=a.getImageData(b,g,2*c||1,2*c||1);g=b.data.length;for(a=3;a<g&&(d=b.data[a],d=0>=d,!1!==d);a+=4);return d},parsePreserveAspectRatioAttribute:function(a){var b="meet";if((a=a.split(" "))&&a.length)if(b=a.pop(),"meet"!==b&&"slice"!==b){var g=b;b=
"meet"}else a.length&&(g=a.pop());a="none"!==g?g.slice(1,4):"none";g="none"!==g?g.slice(5,8):"none";return{meetOrSlice:b,alignX:a,alignY:g}},clearFabricFontCache:function(a){(a=(a||"").toLowerCase())?fabric.charWidthsCache[a]&&delete fabric.charWidthsCache[a]:fabric.charWidthsCache={}},limitDimsByArea:function(a,b){a=Math.sqrt(b*a);return{x:Math.floor(a),y:Math.floor(b/a)}},capValue:function(a,b,g){return Math.max(a,Math.min(b,g))},findScaleToFit:function(a,b){return Math.min(b.width/a.width,b.height/
a.height)},findScaleToCover:function(a,b){return Math.max(b.width/a.width,b.height/a.height)},matrixToSVG:function(a){return"matrix("+a.map(function(a){return fabric.util.toFixed(a,fabric.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"}}})("undefined"!==typeof exports?exports:this);
(function(){function e(a,g,f,d,k,h,m){var l=b.call(arguments);if(fabric.arcToSegmentsCache[l])return fabric.arcToSegmentsCache[l];var e=Math.PI,x=m*e/180,t=fabric.util.sin(x);x=fabric.util.cos(x);var C=0,B=0;f=Math.abs(f);d=Math.abs(d);var v=-x*a*.5-t*g*.5,r=-x*g*.5+t*a*.5,w=f*f,y=d*d,z=r*r,p=v*v,u=w*y-w*z-y*p,A=0;0>u?(w=Math.sqrt(1-u/(w*y)),f*=w,d*=w):A=(k===h?-1:1)*Math.sqrt(u/(w*z+y*p));y=A*f*r/d;z=-A*d*v/f;A=x*y-t*z+.5*a;w=t*y+x*z+.5*g;var E=c(1,0,(v-y)/f,(r-z)/d);r=c((v-y)/f,(r-z)/d,(-v-y)/f,
(-r-z)/d);0===h&&0<r?r-=2*e:1===h&&0>r&&(r+=2*e);e=Math.ceil(Math.abs(r/e*2));v=[];r/=e;y=8/3*Math.sin(r/4)*Math.sin(r/4)/Math.sin(r/2);z=E+r;for(p=0;p<e;p++){u=p;var G=E,F=z;E=x;var H=t,D=f,J=d,K=A,N=w,P=y,O=fabric.util.cos(G);G=fabric.util.sin(G);var I=fabric.util.cos(F);F=fabric.util.sin(F);K=E*D*I-H*J*F+K;N=H*D*I+E*J*F+N;v[u]=[C+P*(-E*D*G-H*J*O),B+P*(-H*D*G+E*J*O),K+P*(E*D*F+H*J*I),N+P*(H*D*F-E*J*I),K,N];C=v[p][4];B=v[p][5];E=z;z+=r}return fabric.arcToSegmentsCache[l]=v}function c(a,b,c,d){a=
Math.atan2(b,a);c=Math.atan2(d,c);return c>=a?c-a:2*Math.PI-(a-c)}function f(a,g,c,d,k,f,m,e){if(fabric.cachesBoundsOfCurve){var h=b.call(arguments);if(fabric.boundsOfCurveCache[h])return fabric.boundsOfCurveCache[h]}var l=Math.sqrt,q=Math.min,C=Math.max,B=Math.abs,v=[],r=[[],[]];var w=6*a-12*c+6*k;var y=-3*a+9*c-9*k+3*m;var z=3*c-3*a;for(var p=0;2>p;++p)if(0<p&&(w=6*g-12*d+6*f,y=-3*g+9*d-9*f+3*e,z=3*d-3*g),1E-12>B(y)){if(!(1E-12>B(w))){var u=-z/w;0<u&&1>u&&v.push(u)}}else if(u=w*w-4*z*y,!(0>u)){var A=
l(u);u=(-w+A)/(2*y);0<u&&1>u&&v.push(u);u=(-w-A)/(2*y);0<u&&1>u&&v.push(u)}for(B=l=v.length;l--;)u=v[l],w=1-u,y=w*w*w*a+3*w*w*u*c+3*w*u*u*k+u*u*u*m,r[0][l]=y,y=w*w*w*g+3*w*w*u*d+3*w*u*u*f+u*u*u*e,r[1][l]=y;r[0][B]=a;r[1][B]=g;r[0][B+1]=m;r[1][B+1]=e;q=[{x:q.apply(null,r[0]),y:q.apply(null,r[1])},{x:C.apply(null,r[0]),y:C.apply(null,r[1])}];fabric.cachesBoundsOfCurve&&(fabric.boundsOfCurveCache[h]=q);return q}var b=Array.prototype.join;fabric.util.drawArc=function(a,b,c,d){var g=[[],[],[],[]];d=e(d[5]-
b,d[6]-c,d[0],d[1],d[3],d[4],d[2]);for(var f=0,l=d.length;f<l;f++)g[f][0]=d[f][0]+b,g[f][1]=d[f][1]+c,g[f][2]=d[f][2]+b,g[f][3]=d[f][3]+c,g[f][4]=d[f][4]+b,g[f][5]=d[f][5]+c,a.bezierCurveTo.apply(a,g[f])};fabric.util.getBoundsOfArc=function(a,b,c,d,k,h,m,q,n){var g=0,l=0,C=[];c=e(q-a,n-b,c,d,h,m,k);d=0;for(k=c.length;d<k;d++)g=f(g,l,c[d][0],c[d][1],c[d][2],c[d][3],c[d][4],c[d][5]),C.push({x:g[0].x+a,y:g[0].y+b}),C.push({x:g[1].x+a,y:g[1].y+b}),g=c[d][4],l=c[d][5];return C};fabric.util.getBoundsOfCurve=
f})();
(function(){function e(c,b,a){if(c&&0!==c.length){var g=c.length-1,f=b?c[g][b]:c[g];if(b)for(;g--;)a(c[g][b],f)&&(f=c[g][b]);else for(;g--;)a(c[g],f)&&(f=c[g]);return f}}var c=Array.prototype.slice;fabric.util.array={fill:function(c,b){for(var a=c.length;a--;)c[a]=b;return c},invoke:function(f,b){for(var a=c.call(arguments,2),g=[],l=0,d=f.length;l<d;l++)g[l]=a.length?f[l][b].apply(f[l],a):f[l][b].call(f[l]);return g},min:function(c,b){return e(c,b,function(a,b){return a<b})},max:function(c,b){return e(c,
b,function(a,b){return a>=b})}}})();(function(){function e(c,f,b){if(b)if(!fabric.isLikelyNode&&f instanceof Element)c=f;else if(f instanceof Array){c=[];for(var a=0,g=f.length;a<g;a++)c[a]=e({},f[a],b)}else if(f&&"object"===typeof f)for(a in f)"canvas"===a?c[a]=e({},f[a]):f.hasOwnProperty(a)&&(c[a]=e({},f[a],b));else c=f;else for(a in f)c[a]=f[a];return c}fabric.util.object={extend:e,clone:function(c,f){return e({},c,f)}};fabric.util.object.extend(fabric.util,fabric.Observable)})();
(function(){function e(c,f){var b=c.charCodeAt(f);if(isNaN(b))return"";if(55296>b||57343<b)return c.charAt(f);if(55296<=b&&56319>=b){if(c.length<=f+1)throw"High surrogate without following low surrogate";b=c.charCodeAt(f+1);if(56320>b||57343<b)throw"High surrogate without following low surrogate";return c.charAt(f)+c.charAt(f+1)}if(0===f)throw"Low surrogate without preceding high surrogate";c=c.charCodeAt(f-1);if(55296>c||56319<c)throw"Low surrogate without preceding high surrogate";return!1}fabric.util.string=
{camelize:function(c){return c.replace(/-+(.)?/g,function(c,b){return b?b.toUpperCase():""})},capitalize:function(c,f){return c.charAt(0).toUpperCase()+(f?c.slice(1):c.slice(1).toLowerCase())},escapeXml:function(c){return c.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(c){var f,b=[];var a=0;for(f;a<c.length;a++)!1!==(f=e(c,a))&&b.push(f);return b}}})();
(function(){function e(){}function c(a){for(var b=null,g=this;g.constructor.superclass;){var c=g.constructor.superclass.prototype[a];if(g[a]!==c){b=c;break}g=g.constructor.superclass.prototype}return b?1<arguments.length?b.apply(this,f.call(arguments,1)):b.call(this):console.log("tried to callSuper "+a+", method not found in prototype chain",this)}var f=Array.prototype.slice,b=function(){},a=function(){for(var a in{toString:1})if("toString"===a)return!1;return!0}(),g=function(b,d,g){for(var c in d)c in
b.prototype&&"function"===typeof b.prototype[c]&&-1<(d[c]+"").indexOf("callSuper")?b.prototype[c]=function(a){return function(){var b=this.constructor.superclass;this.constructor.superclass=g;var c=d[a].apply(this,arguments);this.constructor.superclass=b;if("initialize"!==a)return c}}(c):b.prototype[c]=d[c],a&&(d.toString!==Object.prototype.toString&&(b.prototype.toString=d.toString),d.valueOf!==Object.prototype.valueOf&&(b.prototype.valueOf=d.valueOf))};fabric.util.createClass=function(){function a(){this.initialize.apply(this,
arguments)}var d=null,k=f.call(arguments,0);"function"===typeof k[0]&&(d=k.shift());a.superclass=d;a.subclasses=[];d&&(e.prototype=d.prototype,a.prototype=new e,d.subclasses.push(a));for(var h=0,m=k.length;h<m;h++)g(a,k[h],d);a.prototype.initialize||(a.prototype.initialize=b);a.prototype.constructor=a;a.prototype.callSuper=c;return a}})();
(function(){var e=!!fabric.document.createElement("div").attachEvent;fabric.util.addListener=function(c,f,b,a){c&&c.addEventListener(f,b,e?!1:a)};fabric.util.removeListener=function(c,f,b,a){c&&c.removeEventListener(f,b,e?!1:a)};fabric.util.getPointer=function(c){var f=fabric.util.getScrollLeftTop(c.target);var b=c.changedTouches;c=b&&b[0]?b[0]:c;return{x:c.clientX+f.left,y:c.clientY+f.top}}})();
(function(){var e=fabric.document.createElement("div"),c="string"===typeof e.style.filter,f=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,b=function(a){return a};"string"===typeof e.style.opacity?b=function(a,b){a.style.opacity=b;return a}:c&&(b=function(a,b){var g=a.style;a.currentStyle&&!a.currentStyle.hasLayout&&(g.zoom=1);f.test(g.filter)?g.filter=g.filter.replace(f,.9999<=b?"":"alpha(opacity="+100*b+")"):g.filter+=" alpha(opacity="+100*b+")";return a});fabric.util.setStyle=function(a,g){var c=a.style;
if(!c)return a;if("string"===typeof g)return a.style.cssText+=";"+g,-1<g.indexOf("opacity")?b(a,g.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var d in g)"opacity"===d?b(a,g[d]):c["float"===d||"cssFloat"===d?"undefined"===typeof c.styleFloat?"cssFloat":"styleFloat":d]=g[d];return a}})();
(function(){function e(a,b){a=fabric.document.createElement(a);for(var d in b)"class"===d?a.className=b[d]:"for"===d?a.htmlFor=b[d]:a.setAttribute(d,b[d]);return a}function c(a){for(var b=0,g=0,c=fabric.document.documentElement,f=fabric.document.body||{scrollLeft:0,scrollTop:0};a&&(a.parentNode||a.host)&&(a=a.parentNode||a.host,a===fabric.document?(b=f.scrollLeft||c.scrollLeft||0,g=f.scrollTop||c.scrollTop||0):(b+=a.scrollLeft||0,g+=a.scrollTop||0),1!==a.nodeType||"fixed"!==a.style.position););return{left:b,
top:g}}var f=Array.prototype.slice,b=function(a){return f.call(a,0)};try{var a=b(fabric.document.childNodes)instanceof Array}catch(l){}a||(b=function(a){for(var b=Array(a.length),g=a.length;g--;)b[g]=a[g];return b});var g=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(a,b){return(a=fabric.document.defaultView.getComputedStyle(a,null))?a[b]:void 0}:function(a,b){var d=a.style[b];!d&&a.currentStyle&&(d=a.currentStyle[b]);return d};(function(){var a=fabric.document.documentElement.style,
b="userSelect"in a?"userSelect":"MozUserSelect"in a?"MozUserSelect":"WebkitUserSelect"in a?"WebkitUserSelect":"KhtmlUserSelect"in a?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=function(a){"undefined"!==typeof a.onselectstart&&(a.onselectstart=fabric.util.falseFunction);b?a.style[b]="none":"string"===typeof a.unselectable&&(a.unselectable="on");return a};fabric.util.makeElementSelectable=function(a){"undefined"!==typeof a.onselectstart&&(a.onselectstart=null);b?a.style[b]="":"string"===
typeof a.unselectable&&(a.unselectable="");return a}})();(function(){fabric.util.getScript=function(a,b){var d=fabric.document.getElementsByTagName("head")[0],g=fabric.document.createElement("script"),c=!0;g.onload=g.onreadystatechange=function(a){!c||"string"===typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(c=!1,b(a||fabric.window.event),g=g.onload=g.onreadystatechange=null)};g.src=a;d.appendChild(g)}})();fabric.util.getById=function(a){return"string"===typeof a?
fabric.document.getElementById(a):a};fabric.util.toArray=b;fabric.util.makeElement=e;fabric.util.addClass=function(a,b){a&&-1===(" "+a.className+" ").indexOf(" "+b+" ")&&(a.className+=(a.className?" ":"")+b)};fabric.util.wrapElement=function(a,b,g){"string"===typeof b&&(b=e(b,g));a.parentNode&&a.parentNode.replaceChild(b,a);b.appendChild(a);return b};fabric.util.getScrollLeftTop=c;fabric.util.getElementOffset=function(a){var b=a&&a.ownerDocument;var f={left:0,top:0},h={left:0,top:0},m={borderLeftWidth:"left",
borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!b)return h;for(var l in m)h[m[l]]+=parseInt(g(a,l),10)||0;b=b.documentElement;"undefined"!==typeof a.getBoundingClientRect&&(f=a.getBoundingClientRect());a=c(a);return{left:f.left+a.left-(b.clientLeft||0)+h.left,top:f.top+a.top-(b.clientTop||0)+h.top}};fabric.util.getElementStyle=g;fabric.util.getNodeCanvas=function(a){a=fabric.jsdomImplForWrapper(a);return a._canvas||a._image};fabric.util.cleanUpJsdomNode=function(a){fabric.isLikelyNode&&
(a=fabric.jsdomImplForWrapper(a))&&(a._image=null,a._canvas=null,a._currentSrc=null,a._attributes=null,a._classList=null)}})();
(function(){function e(c,b){return c+(/\?/.test(c)?"&":"?")+b}function c(){}fabric.util.request=function(f,b){b||(b={});var a=b.method?b.method.toUpperCase():"GET",g=b.onComplete||function(){},l=new fabric.window.XMLHttpRequest,d=b.body||b.parameters;l.onreadystatechange=function(){4===l.readyState&&(g(l),l.onreadystatechange=c)};"GET"===a&&(d=null,"string"===typeof b.parameters&&(f=e(f,b.parameters)));l.open(a,f,!0);"POST"!==a&&"PUT"!==a||l.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
l.send(d);return l}})();fabric.log=console.log;fabric.warn=console.warn;
(function(){function e(){return!1}function c(a,b,d,c){return-d*Math.cos(a/c*(Math.PI/2))+d+b}function f(){return b.apply(fabric.window,arguments)}var b=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(a){return fabric.window.setTimeout(a,1E3/60)},a=fabric.window.cancelAnimationFrame||fabric.window.clearTimeout;fabric.util.animate=function(a){f(function(b){a||
(a={});var d=b||+new Date,g=a.duration||500,h=d+g,m,l=a.onChange||e,n=a.abort||e,x=a.onComplete||e,t=a.easing||c,C="startValue"in a?a.startValue:0,B="endValue"in a?a.endValue:100,v=a.byValue||B-C;a.onStart&&a.onStart();(function y(a){m=a||+new Date;var b=m>h?g:m-d;a=b/g;b=t(b,C,v,g);var c=Math.abs((b-C)/v);n()?x(B,1,1):m>h?(l(B,1,1),x(B,1,1)):(l(b,c,a),f(y))})(d)})};fabric.util.requestAnimFrame=f;fabric.util.cancelAnimFrame=function(){return a.apply(fabric.window,arguments)}})();
(function(){fabric.util.animateColor=function(e,c,f,b){e=(new fabric.Color(e)).getSource();c=(new fabric.Color(c)).getSource();b=b||{};fabric.util.animate(fabric.util.object.extend(b,{duration:f||500,startValue:e,endValue:c,byValue:c,easing:function(a,g,c,d){a=b.colorEasing?b.colorEasing(a,d):1-Math.cos(a/d*(Math.PI/2));d="rgba("+parseInt(g[0]+a*(c[0]-g[0]),10)+","+parseInt(g[1]+a*(c[1]-g[1]),10)+","+parseInt(g[2]+a*(c[2]-g[2]),10);d+=","+(g&&c?parseFloat(g[3]+a*(c[3]-g[3])):1);return d+")"}}))}})();
(function(e){function c(a,b,d,g){var c="[object Array]"===Object.prototype.toString.call(b);if("fill"!==a&&"stroke"!==a||"none"!==b)if("vector-effect"===a)b="non-scaling-stroke"===b;else if("strokeDashArray"===a)b="none"===b?null:b.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===a)b=d&&d.transformMatrix?v(d.transformMatrix,n.parseTransformAttribute(b)):n.parseTransformAttribute(b);else if("visible"===a)b="none"!==b&&"hidden"!==b,d&&!1===d.visible&&(b=!1);else if("opacity"===
a)b=parseFloat(b),d&&"undefined"!==typeof d.opacity&&(b*=d.opacity);else if("textAnchor"===a)b="start"===b?"left":"end"===b?"right":"center";else if("charSpacing"===a)var f=B(b,g)/g*1E3;else if("paintFirst"===a)a=b.indexOf("fill"),d=b.indexOf("stroke"),b="fill",-1<a&&-1<d&&d<a?b="stroke":-1===a&&-1<d&&(b="stroke");else{if("href"===a||"xlink:href"===a)return b;f=c?b.map(B):B(b,g)}else b="";return!c&&isNaN(f)?b:f}function f(a){return new RegExp("^("+a.join("|")+")\\b","i")}function b(a){for(var b in w)if("undefined"!==
typeof a[w[b]]&&""!==a[b]){if("undefined"===typeof a[b]){if(!n.Object.prototype[b])continue;a[b]=n.Object.prototype[b]}if(0!==a[b].indexOf("url(")){var d=new n.Color(a[b]);a[b]=d.setAlpha(C(d.getAlpha()*a[w[b]],2)).toRgba()}}return a}function a(a,b){var d=[],g;var c=0;for(g=b.length;c<g;c++){var f=b[c];f=a.getElementsByTagName(f);d=d.concat(Array.prototype.slice.call(f))}return d}function g(a,b){var d,g;a.replace(/;\s*$/,"").split(";").forEach(function(a){a=a.split(":");d=a[0].trim().toLowerCase();
g=a[1].trim();b[d]=g})}function l(a,b){var g={},c;for(c in n.cssRules[b]){var f,k=a,h=c.split(" "),m=!0;if((f=d(k,h.pop()))&&h.length){m=void 0;for(var e=h,l=!0;k.parentNode&&1===k.parentNode.nodeType&&e.length;)l&&(m=e.pop()),k=k.parentNode,l=d(k,m);m=0===e.length}if(f&&m&&0===h.length)for(var q in n.cssRules[b][c])g[q]=n.cssRules[b][c][q]}return g}function d(a,b){var d=a.nodeName,g=a.getAttribute("class");a=a.getAttribute("id");d=new RegExp("^"+d,"i");b=b.replace(d,"");a&&b.length&&(d=new RegExp("#"+
a+"(?![a-zA-Z\\-]+)","i"),b=b.replace(d,""));if(g&&b.length)for(g=g.split(" "),a=g.length;a--;)d=new RegExp("\\."+g[a]+"(?![a-zA-Z\\-]+)","i"),b=b.replace(d,"");return 0===b.length}function k(a,b){var d;a.getElementById&&(d=a.getElementById(b));if(d)return d;var g,c=a.getElementsByTagName("*");d=0;for(g=c.length;d<g;d++)if(a=c[d],b===a.getAttribute("id"))return a}function h(b){for(var d=a(b,["use","svg:use"]),g=0;d.length&&g<d.length;){var c=d[g],f=(c.getAttribute("xlink:href")||c.getAttribute("href")).substr(1),
h=c.getAttribute("x")||0,e=c.getAttribute("y")||0;f=k(b,f).cloneNode(!0);h=(f.getAttribute("transform")||"")+" translate("+h+", "+e+")";e=d.length;var l,q=n.svgNS;m(f);if(/^svg$/i.test(f.nodeName)){var t=f.ownerDocument.createElementNS(q,"g");var x=0;var p=f.attributes;for(l=p.length;x<l;x++){var r=p.item(x);t.setAttributeNS(q,r.nodeName,r.nodeValue)}for(;f.firstChild;)t.appendChild(f.firstChild);f=t}x=0;p=c.attributes;for(l=p.length;x<l;x++)r=p.item(x),"x"!==r.nodeName&&"y"!==r.nodeName&&"xlink:href"!==
r.nodeName&&"href"!==r.nodeName&&("transform"===r.nodeName?h=r.nodeValue+" "+h:f.setAttribute(r.nodeName,r.nodeValue));f.setAttribute("transform",h);f.setAttribute("instantiated_by_use","1");f.removeAttribute("id");c.parentNode.replaceChild(f,c);d.length===e&&g++}}function m(a){var b=a.getAttribute("viewBox"),d=1,g=1,c=a.getAttribute("width"),f=a.getAttribute("height"),k=a.getAttribute("x")||0,h=a.getAttribute("y")||0,m=a.getAttribute("preserveAspectRatio")||"";var e=!b||!n.svgViewBoxElementsRegEx.test(a.nodeName)||
!(b=b.match(y));var l=!c||!f||"100%"===c||"100%"===f;var q=e&&l;var t={},x="",p=0,r=0;t.width=0;t.height=0;if(t.toBeParsed=q)return t;if(e)return t.width=B(c),t.height=B(f),t;e=-parseFloat(b[1]);q=-parseFloat(b[2]);var C=parseFloat(b[3]);b=parseFloat(b[4]);t.minX=e;t.minY=q;t.viewBoxWidth=C;t.viewBoxHeight=b;l?(t.width=C,t.height=b):(t.width=B(c),t.height=B(f),d=t.width/C,g=t.height/b);m=n.util.parsePreserveAspectRatioAttribute(m);"none"!==m.alignX&&("meet"===m.meetOrSlice&&(g=d=d>g?g:d),"slice"===
m.meetOrSlice&&(g=d=d>g?d:g),p=t.width-C*d,r=t.height-b*d,"Mid"===m.alignX&&(p/=2),"Mid"===m.alignY&&(r/=2),"Min"===m.alignX&&(p=0),"Min"===m.alignY&&(r=0));if(1===d&&1===g&&0===e&&0===q&&0===k&&0===h)return t;if(k||h)x=" translate("+B(k)+" "+B(h)+") ";d=x+" matrix("+d+" 0 0 "+g+" "+(e*d+p)+" "+(q*g+r)+") ";t.viewboxTransform=n.parseTransformAttribute(d);if("svg"===a.nodeName){for(g=a.ownerDocument.createElementNS(n.svgNS,"g");a.firstChild;)g.appendChild(a.firstChild);a.appendChild(g)}else g=a,d=
g.getAttribute("transform")+d;g.setAttribute("transform",d);return t}function q(a,b){var d=b.getAttribute("xlink:href").substr(1),g=k(a,d);g&&g.getAttribute("xlink:href")&&q(a,g);"gradientTransform x1 x2 y1 y2 gradientUnits cx cy r fx fy".split(" ").forEach(function(a){g&&!b.hasAttribute(a)&&g.hasAttribute(a)&&b.setAttribute(a,g.getAttribute(a))});if(!b.children.length)for(a=g.cloneNode(!0);a.firstChild;)b.appendChild(a.firstChild);b.removeAttribute("xlink:href")}var n=e.fabric||(e.fabric={}),x=n.util.object.extend,
t=n.util.object.clone,C=n.util.toFixed,B=n.util.parseUnit,v=n.util.multiplyTransformMatrices,r={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap",
"stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform"},w={stroke:"strokeOpacity",fill:"fillOpacity"};n.svgValidTagNamesRegEx=f("path circle polygon polyline ellipse rect line image text".split(" "));n.svgViewBoxElementsRegEx=f("symbol image marker pattern view svg".split(" "));
n.svgInvalidAncestorsRegEx=f("pattern defs symbol metadata clipPath mask desc".split(" "));n.svgValidParentsRegEx=f("symbol g a svg clipPath defs".split(" "));n.cssRules={};n.gradientDefs={};n.clipPaths={};n.parseTransformAttribute=function(){function a(a,b){var d=n.util.cos(b[0]),g=n.util.sin(b[0]),c=0,f=0;3===b.length&&(c=b[1],f=b[2]);a[0]=d;a[1]=g;a[2]=-g;a[3]=d;a[4]=c-(d*c-g*f);a[5]=f-(g*c+d*f)}function b(a,b){var d=2===b.length?b[1]:b[0];a[0]=b[0];a[3]=d}function d(a,b){a[4]=b[0];2===b.length&&
(a[5]=b[1])}var g=n.iMatrix,c=n.reNum,f="(?:(?:(matrix)\\s*\\(\\s*("+(c+")(?:\\s+,?\\s*|,\\s*)("+c+")(?:\\s+,?\\s*|,\\s*)("+c+")(?:\\s+,?\\s*|,\\s*)("+c+")(?:\\s+,?\\s*|,\\s*)("+c+")(?:\\s+,?\\s*|,\\s*)("+c+")\\s*\\))|(?:(translate)\\s*\\(\\s*(")+(c+")(?:(?:\\s+,?\\s*|,\\s*)("+c+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*(")+(c+")(?:(?:\\s+,?\\s*|,\\s*)("+c+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*(")+(c+")(?:(?:\\s+,?\\s*|,\\s*)("+c+")(?:\\s+,?\\s*|,\\s*)("+c+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*(")+(c+")\\s*\\))|(?:(skewY)\\s*\\(\\s*(")+
(c+")\\s*\\)))"),k=new RegExp("^\\s*(?:(?:"+(f+"(?:(?:\\s+,?\\s*|,\\s*)*"+f+")*)?)\\s*$")),h=new RegExp(f,"g");return function(c){var m=g.concat(),e=[];if(!c||c&&!k.test(c))return m;c.replace(h,function(c){var k=(new RegExp(f)).exec(c).filter(function(a){return!!a});c=k[1];k=k.slice(2).map(parseFloat);switch(c){case "translate":d(m,k);break;case "rotate":k[0]=n.util.degreesToRadians(k[0]);a(m,k);break;case "scale":b(m,k);break;case "skewX":m[2]=Math.tan(n.util.degreesToRadians(k[0]));break;case "skewY":m[1]=
Math.tan(n.util.degreesToRadians(k[0]));break;case "matrix":m=k}e.push(m.concat());m=g.concat()});for(c=e[0];1<e.length;)e.shift(),c=n.util.multiplyTransformMatrices(c,e[0]);return c}}();var y=new RegExp("^\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*$");n.parseSVGDocument=function(a,b,d,g){if(a){h(a);var c=n.Object.__uid++,f,k=m(a),e=n.util.toArray(a.getElementsByTagName("*"));k.crossOrigin=g&&g.crossOrigin;k.svgUid=c;if(0===e.length&&n.isLikelyNode){e=
a.selectNodes('//*[name(.)!="svg"]');var l=[];var q=0;for(f=e.length;q<f;q++)l[q]=e[q];e=l}q=e.filter(function(a){m(a);var b;if(b=n.svgValidTagNamesRegEx.test(a.nodeName.replace("svg:",""))){a:{for(b=n.svgInvalidAncestorsRegEx;a&&(a=a.parentNode);)if(a.nodeName&&b.test(a.nodeName.replace("svg:",""))&&!a.getAttribute("instantiated_by_use")){a=!0;break a}a=!1}b=!a}return b});if(!q||q&&!q.length)b&&b([],{});else{var x={};e.filter(function(a){return"clipPath"===a.nodeName.replace("svg:","")}).forEach(function(a){var b=
a.getAttribute("id");x[b]=n.util.toArray(a.getElementsByTagName("*")).filter(function(a){return n.svgValidTagNamesRegEx.test(a.nodeName.replace("svg:",""))})});n.gradientDefs[c]=n.getGradientDefs(a);n.cssRules[c]=n.getCSSRules(a);n.clipPaths[c]=x;n.parseElements(q,function(a,d){b&&(b(a,k,d,e),delete n.gradientDefs[c],delete n.cssRules[c],delete n.clipPaths[c])},t(k),d,g)}}};var z=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+
n.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+n.reNum+"))?\\s+(.*)");x(n,{parseFontDeclaration:function(a,b){var d=a.match(z);if(d){a=d[1];var g=d[3],c=d[4],f=d[5];d=d[6];a&&(b.fontStyle=a);g&&(b.fontWeight=isNaN(parseFloat(g))?g:parseFloat(g));c&&(b.fontSize=B(c));d&&(b.fontFamily=d);f&&(b.lineHeight="normal"===f?1:f)}},getGradientDefs:function(b){var d=a(b,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),g,c={};for(g=d.length;g--;){var f=d[g];f.getAttribute("xlink:href")&&
q(b,f);c[f.getAttribute("id")]=f}return c},parseAttributes:function(a,d,g){if(a){var f,k={},h;"undefined"===typeof g&&(g=a.getAttribute("svgUid"));a.parentNode&&n.svgValidParentsRegEx.test(a.parentNode.nodeName)&&(k=n.parseAttributes(a.parentNode,d,g));d=d.reduce(function(b,d){(f=a.getAttribute(d))&&(b[d]=f);return b},{});g=x(l(a,g),n.parseStyleAttribute(a));d=x(d,g);g["clip-path"]&&a.setAttribute("clip-path",g["clip-path"]);g=h=k.fontSize||n.Text.DEFAULT_SVG_FONT_SIZE;d["font-size"]&&(d["font-size"]=
g=B(d["font-size"],h));var m={},e;for(e in d){h=e in r?r[e]:e;var q=c(h,d[e],k,g);m[h]=q}m&&m.font&&n.parseFontDeclaration(m.font,m);k=x(k,m);return n.svgValidParentsRegEx.test(a.nodeName)?k:b(k)}},parseElements:function(a,b,d,g,c){(new n.ElementsParser(a,b,d,g,c)).parse()},parseStyleAttribute:function(a){var b={};a=a.getAttribute("style");if(!a)return b;if("string"===typeof a)g(a,b);else{var d;for(d in a)if("undefined"!==typeof a[d]){var c=d.toLowerCase();var f=a[d];b[c]=f}}return b},parsePointsAttribute:function(a){if(!a)return null;
a=a.replace(/,/g," ").trim();a=a.split(/\s+/);var b=[],d;var g=0;for(d=a.length;g<d;g+=2)b.push({x:parseFloat(a[g]),y:parseFloat(a[g+1])});return b},getCSSRules:function(a){a=a.getElementsByTagName("style");var b,d={};var g=0;for(b=a.length;g<b;g++){var c=a[g].textContent||"";c=c.replace(/\/\*[\s\S]*?\*\//g,"");""!==c.trim()&&(c=c.match(/[^{]*\{[\s\S]*?\}/g),c=c.map(function(a){return a.trim()}),c.forEach(function(a){a=a.match(/([\s\S]*?)\s*\{([^}]*)\}/);var c={},f=a[2].trim().replace(/;$/,"").split(/\s*;\s*/);
g=0;for(b=f.length;g<b;g++){var k=f[g].split(/\s*:\s*/);c[k[0]]=k[1]}a=a[1];a.split(",").forEach(function(a){a=a.replace(/^svg/i,"").trim();""!==a&&(d[a]?n.util.object.extend(d[a],c):d[a]=n.util.object.clone(c))})}))}return d},loadSVGFromURL:function(a,b,d,g){a=a.replace(/^\n\s*/,"").trim();new n.util.request(a,{method:"get",onComplete:function(a){var c=a.responseXML;c&&!c.documentElement&&n.window.ActiveXObject&&a.responseText&&(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(a.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,
"")));if(!c||!c.documentElement)return b&&b(null),!1;n.parseSVGDocument(c.documentElement,function(a,d,g,c){b&&b(a,d,g,c)},d,g)}})},loadSVGFromString:function(a,b,d,g){a=a.trim();var c;if("undefined"!==typeof n.window.DOMParser){var f=new n.window.DOMParser;f&&f.parseFromString&&(c=f.parseFromString(a,"text/xml"))}else n.window.ActiveXObject&&(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(a.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));n.parseSVGDocument(c.documentElement,
function(a,d,g,c){b(a,d,g,c)},d,g)}})})("undefined"!==typeof exports?exports:this);fabric.ElementsParser=function(e,c,f,b,a,g){this.elements=e;this.callback=c;this.options=f;this.reviver=b;this.svgUid=f&&f.svgUid||0;this.parsingOptions=a;this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g;this.doc=g};
(function(e){e.parse=function(){this.instances=Array(this.elements.length);this.numElements=this.elements.length;this.createObjects()};e.createObjects=function(){var c=this;this.elements.forEach(function(f,b){f.setAttribute("svgUid",c.svgUid);c.createObject(f,b)})};e.findTag=function(c){return fabric[fabric.util.string.capitalize(c.tagName.replace("svg:",""))]};e.createObject=function(c,f){var b=this.findTag(c);if(b&&b.fromElement)try{b.fromElement(c,this.createCallback(f,c),this.options)}catch(a){fabric.log(a)}else this.checkIfDone()};
e.createCallback=function(c,f){var b=this;return function(a){var g;b.resolveGradient(a,f,"fill");b.resolveGradient(a,f,"stroke");a instanceof fabric.Image&&a._originalElement&&(g=a.parsePreserveAspectRatioAttribute(f));a._removeTransformMatrix(g);b.resolveClipPath(a,f);b.reviver&&b.reviver(f,a);b.instances[c]=a;b.checkIfDone()}};e.extractPropertyDefinition=function(c,f,b){f=c[f];c=this.regexUrl;if(c.test(f))return c.lastIndex=0,f=c.exec(f)[1],c.lastIndex=0,fabric[b][this.svgUid][f]};e.resolveGradient=
function(c,f,b){var a=this.extractPropertyDefinition(c,b,"gradientDefs");a&&(f=f.getAttribute(b+"-opacity"),a=fabric.Gradient.fromElement(a,c,f,this.options),c.set(b,a))};e.createClipPathCallback=function(c,f){return function(b){b._removeTransformMatrix();b.fillRule=b.clipRule;f.push(b)}};e.resolveClipPath=function(c,f){var b=this.extractPropertyDefinition(c,"clipPath","clipPaths"),a;if(b){var g=[];var e=fabric.util.invertTransform(c.calcTransformMatrix());for(a=b[0].parentNode;f.parentNode&&f.getAttribute("clip-path")!==
c.clipPath;)f=f.parentNode;f.parentNode.appendChild(a);for(var d=0;d<b.length;d++){a=b[d];var k=this.findTag(a);k.fromElement(a,this.createClipPathCallback(c,g),this.options)}b=1===g.length?g[0]:new fabric.Group(g);e=fabric.util.multiplyTransformMatrices(e,b.calcTransformMatrix());b.clipPath&&this.resolveClipPath(b,f);e=fabric.util.qrDecompose(e);b.flipX=!1;b.flipY=!1;b.set("scaleX",e.scaleX);b.set("scaleY",e.scaleY);b.angle=e.angle;b.skewX=e.skewX;b.skewY=0;b.setPositionByOrigin({x:e.translateX,
y:e.translateY},"center","center");c.clipPath=b}else delete c.clipPath};e.checkIfDone=function(){0===--this.numElements&&(this.instances=this.instances.filter(function(c){return null!=c}),this.callback(this.instances,this.elements))}})(fabric.ElementsParser.prototype);
(function(e){function c(c,b){this.x=c;this.y=b}e=e.fabric||(e.fabric={});e.Point?e.warn("fabric.Point is already defined"):(e.Point=c,c.prototype={type:"point",constructor:c,add:function(f){return new c(this.x+f.x,this.y+f.y)},addEquals:function(c){this.x+=c.x;this.y+=c.y;return this},scalarAdd:function(f){return new c(this.x+f,this.y+f)},scalarAddEquals:function(c){this.x+=c;this.y+=c;return this},subtract:function(f){return new c(this.x-f.x,this.y-f.y)},subtractEquals:function(c){this.x-=c.x;this.y-=
c.y;return this},scalarSubtract:function(f){return new c(this.x-f,this.y-f)},scalarSubtractEquals:function(c){this.x-=c;this.y-=c;return this},multiply:function(f){return new c(this.x*f,this.y*f)},multiplyEquals:function(c){this.x*=c;this.y*=c;return this},divide:function(f){return new c(this.x/f,this.y/f)},divideEquals:function(c){this.x/=c;this.y/=c;return this},eq:function(c){return this.x===c.x&&this.y===c.y},lt:function(c){return this.x<c.x&&this.y<c.y},lte:function(c){return this.x<=c.x&&this.y<=
c.y},gt:function(c){return this.x>c.x&&this.y>c.y},gte:function(c){return this.x>=c.x&&this.y>=c.y},lerp:function(f,b){"undefined"===typeof b&&(b=.5);b=Math.max(Math.min(1,b),0);return new c(this.x+(f.x-this.x)*b,this.y+(f.y-this.y)*b)},distanceFrom:function(c){var b=this.x-c.x;c=this.y-c.y;return Math.sqrt(b*b+c*c)},midPointFrom:function(c){return this.lerp(c)},min:function(f){return new c(Math.min(this.x,f.x),Math.min(this.y,f.y))},max:function(f){return new c(Math.max(this.x,f.x),Math.max(this.y,
f.y))},toString:function(){return this.x+","+this.y},setXY:function(c,b){this.x=c;this.y=b;return this},setX:function(c){this.x=c;return this},setY:function(c){this.y=c;return this},setFromPoint:function(c){this.x=c.x;this.y=c.y;return this},swap:function(c){var b=this.x,a=this.y;this.x=c.x;this.y=c.y;c.x=b;c.y=a},clone:function(){return new c(this.x,this.y)}})})("undefined"!==typeof exports?exports:this);
(function(e){function c(b){this.status=b;this.points=[]}var f=e.fabric||(e.fabric={});f.Intersection?f.warn("fabric.Intersection is already defined"):(f.Intersection=c,f.Intersection.prototype={constructor:c,appendPoint:function(b){this.points.push(b);return this},appendPoints:function(b){this.points=this.points.concat(b);return this}},f.Intersection.intersectLineLine=function(b,a,g,e){var d=(e.x-g.x)*(b.y-g.y)-(e.y-g.y)*(b.x-g.x);var k=(a.x-b.x)*(b.y-g.y)-(a.y-b.y)*(b.x-g.x);g=(e.y-g.y)*(a.x-b.x)-
(e.x-g.x)*(a.y-b.y);0!==g?(d/=g,k/=g,0<=d&&1>=d&&0<=k&&1>=k?(k=new c("Intersection"),k.appendPoint(new f.Point(b.x+d*(a.x-b.x),b.y+d*(a.y-b.y)))):k=new c):k=0===d||0===k?new c("Coincident"):new c("Parallel");return k},f.Intersection.intersectLinePolygon=function(b,a,g){var f=new c,d=g.length,k;for(k=0;k<d;k++){var h=g[k];var e=g[(k+1)%d];h=c.intersectLineLine(b,a,h,e);f.appendPoints(h.points)}0<f.points.length&&(f.status="Intersection");return f},f.Intersection.intersectPolygonPolygon=function(b,
a){var g=new c,f=b.length,d;for(d=0;d<f;d++){var k=c.intersectLinePolygon(b[d],b[(d+1)%f],a);g.appendPoints(k.points)}0<g.points.length&&(g.status="Intersection");return g},f.Intersection.intersectPolygonRectangle=function(b,a,g){var e=a.min(g),d=a.max(g);g=new f.Point(d.x,e.y);var k=new f.Point(e.x,d.y);a=c.intersectLinePolygon(e,g,b);g=c.intersectLinePolygon(g,d,b);d=c.intersectLinePolygon(d,k,b);b=c.intersectLinePolygon(k,e,b);e=new c;e.appendPoints(a.points);e.appendPoints(g.points);e.appendPoints(d.points);
e.appendPoints(b.points);0<e.points.length&&(e.status="Intersection");return e})})("undefined"!==typeof exports?exports:this);
(function(e){function c(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function f(a,b,c){0>c&&(c+=1);1<c&&--c;return c<1/6?a+6*(b-a)*c:.5>c?b:c<2/3?a+(b-a)*(2/3-c)*6:a}var b=e.fabric||(e.fabric={});b.Color?b.warn("fabric.Color is already defined."):(b.Color=c,b.Color.prototype={_tryParsingColor:function(a){var b;a in c.colorNameMap&&(a=c.colorNameMap[a]);"transparent"===a&&(b=[255,255,255,0]);b||(b=c.sourceFromHex(a));b||(b=c.sourceFromRgb(a));b||(b=c.sourceFromHsl(a));b||(b=[0,0,0,1]);b&&
this.setSource(b)},_rgbToHsl:function(a,g,c){a/=255;g/=255;c/=255;var d=b.util.array.max([a,g,c]);var f=b.util.array.min([a,g,c]);var h=(d+f)/2;if(d===f)var e=f=0;else{var l=d-f;f=.5<h?l/(2-d-f):l/(d+f);switch(d){case a:e=(g-c)/l+(g<c?6:0);break;case g:e=(c-a)/l+2;break;case c:e=(a-g)/l+4}e/=6}return[Math.round(360*e),Math.round(100*f),Math.round(100*h)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+
","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource();a=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+b[0]+","+b[1]+"%,"+b[2]+"%,"+a[3]+")"},toHex:function(){var a=this.getSource();var b=a[0].toString(16);b=1===b.length?"0"+b:b;var c=a[1].toString(16);c=1===c.length?"0"+c:c;a=a[2].toString(16);
a=1===a.length?"0"+a:a;return b.toUpperCase()+c.toUpperCase()+a.toUpperCase()},toHexa:function(){var a=this.getSource();a=Math.round(255*a[3]);a=a.toString(16);a=1===a.length?"0"+a:a;return this.toHex()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var b=this.getSource();b[3]=a;this.setSource(b);return this},toGrayscale:function(){var a=this.getSource(),b=parseInt((.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),10);this.setSource([b,b,b,a[3]]);return this},toBlackWhite:function(a){var b=
this.getSource(),c=(.3*b[0]+.59*b[1]+.11*b[2]).toFixed(0);b=b[3];c=Number(c)<Number(a||127)?0:255;this.setSource([c,c,c,b]);return this},overlayWith:function(a){a instanceof c||(a=new c(a));var b=[],f=this.getAlpha(),d=this.getSource();a=a.getSource();var k;for(k=0;3>k;k++)b.push(Math.round(.5*d[k]+.5*a[k]));b[3]=f;this.setSource(b);return this}},b.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?%?)\s*,\s*(\d{1,3}(?:\.\d+)?%?)\s*,\s*(\d{1,3}(?:\.\d+)?%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,b.Color.reHSLa=
/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}%)\s*,\s*(\d{1,3}%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,b.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,b.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",
cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",
deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",
lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",
mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",
powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",
whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},b.Color.fromRgb=function(a){return c.fromSource(c.sourceFromRgb(a))},b.Color.sourceFromRgb=function(a){if(a=a.match(c.reRGBa)){var b=parseInt(a[1],10)/(/%$/.test(a[1])?100:1)*(/%$/.test(a[1])?255:1),f=parseInt(a[2],10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?255:1),d=parseInt(a[3],10)/(/%$/.test(a[3])?100:1)*(/%$/.test(a[3])?255:1);return[parseInt(b,10),parseInt(f,10),parseInt(d,10),a[4]?parseFloat(a[4]):1]}},b.Color.fromRgba=c.fromRgb,
b.Color.fromHsl=function(a){return c.fromSource(c.sourceFromHsl(a))},b.Color.sourceFromHsl=function(a){if(a=a.match(c.reHSLa)){var b=(parseFloat(a[1])%360+360)%360/360,e=parseFloat(a[2])/(/%$/.test(a[2])?100:1),d=parseFloat(a[3])/(/%$/.test(a[3])?100:1);if(0===e)d=e=b=d;else{var k=.5>=d?d*(e+1):d+e-d*e,h=2*d-k;d=f(h,k,b+1/3);e=f(h,k,b);b=f(h,k,b-1/3)}return[Math.round(255*d),Math.round(255*e),Math.round(255*b),a[4]?parseFloat(a[4]):1]}},b.Color.fromHsla=c.fromHsl,b.Color.fromHex=function(a){return c.fromSource(c.sourceFromHex(a))},
b.Color.sourceFromHex=function(a){if(a.match(c.reHex)){var b=a.slice(a.indexOf("#")+1),f=3===b.length||4===b.length,d=8===b.length||4===b.length;a=f?b.charAt(0)+b.charAt(0):b.substring(0,2);var k=f?b.charAt(1)+b.charAt(1):b.substring(2,4),h=f?b.charAt(2)+b.charAt(2):b.substring(4,6);b=d?f?b.charAt(3)+b.charAt(3):b.substring(6,8):"FF";return[parseInt(a,16),parseInt(k,16),parseInt(h,16),parseFloat((parseInt(b,16)/255).toFixed(2))]}},b.Color.fromSource=function(a){var b=new c;b.setSource(a);return b})})("undefined"!==
typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={}),f=c.util.toFixed;c.Shadow?c.warn("fabric.Shadow is already defined."):(c.Shadow=c.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(b){"string"===typeof b&&(b=this._parseShadow(b));for(var a in b)this[a]=b[a];this.id=c.Object.__uid++},_parseShadow:function(b){b=b.trim();var a=c.Shadow.reOffsetsAndBlur.exec(b)||[];return{color:(b.replace(c.Shadow.reOffsetsAndBlur,"")||
"rgb(0,0,0)").trim(),offsetX:parseInt(a[1],10)||0,offsetY:parseInt(a[2],10)||0,blur:parseInt(a[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(b){var a=40,g=40,e=c.Object.NUM_FRACTION_DIGITS,d=c.util.rotateVector({x:this.offsetX,y:this.offsetY},c.util.degreesToRadians(-b.angle)),k=new c.Color(this.color);b.width&&b.height&&(a=100*f((Math.abs(d.x)+this.blur)/b.width,e)+20,g=100*f((Math.abs(d.y)+this.blur)/b.height,e)+20);b.flipX&&(d.x*=
-1);b.flipY&&(d.y*=-1);return'<filter id="SVGID_'+this.id+'" y="-'+g+'%" height="'+(100+2*g)+'%" x="-'+a+'%" width="'+(100+2*a)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+f(this.blur?this.blur/2:0,e)+'"></feGaussianBlur>\n\t<feOffset dx="'+f(d.x,e)+'" dy="'+f(d.y,e)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+k.toRgb()+'" flood-opacity="'+k.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},
toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var b={},a=c.Shadow.prototype;"color blur offsetX offsetY affectStroke nonScaling".split(" ").forEach(function(c){this[c]!==a[c]&&(b[c]=this[c])},this);return b}}),c.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)})("undefined"!==typeof exports?exports:
this);
(function(){if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var e=fabric.util.object.extend,c=fabric.util.getElementOffset,f=fabric.util.removeFromArray,b=fabric.util.toFixed,a=fabric.util.transformPoint,g=fabric.util.invertTransform,l=fabric.util.getNodeCanvas,d=fabric.util.createCanvasElement,k=Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass(fabric.CommonMethods,{initialize:function(a,b){b||(b={});this.renderAndResetBound=this.renderAndReset.bind(this);
this.requestRenderAllBound=this.requestRenderAll.bind(this);this._initStatic(a,b)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:fabric.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(a,b){var d=
this.requestRenderAllBound;this._objects=[];this._createLowerCanvas(a);this._initOptions(b);this._setImageSmoothing();this.interactive||this._initRetinaScaling();b.overlayImage&&this.setOverlayImage(b.overlayImage,d);b.backgroundImage&&this.setBackgroundImage(b.backgroundImage,d);b.backgroundColor&&this.setBackgroundColor(b.backgroundColor,d);b.overlayColor&&this.setOverlayColor(b.overlayColor,d);this.calcOffset()},_isRetinaScaling:function(){return 1!==fabric.devicePixelRatio&&this.enableRetinaScaling},
getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var a=fabric.devicePixelRatio;this.__initRetinaScaling(a,this.lowerCanvasEl,this.contextContainer);this.upperCanvasEl&&this.__initRetinaScaling(a,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(a,b,d){b.setAttribute("width",this.width*a);b.setAttribute("height",this.height*a);d.scale(a,a)},calcOffset:function(){this._offset=c(this.lowerCanvasEl);
return this},setOverlayImage:function(a,b,d){return this.__setBgOverlayImage("overlayImage",a,b,d)},setBackgroundImage:function(a,b,d){return this.__setBgOverlayImage("backgroundImage",a,b,d)},setOverlayColor:function(a,b){return this.__setBgOverlayColor("overlayColor",a,b)},setBackgroundColor:function(a,b){return this.__setBgOverlayColor("backgroundColor",a,b)},_setImageSmoothing:function(){var a=this.getContext();a.imageSmoothingEnabled=a.imageSmoothingEnabled||a.webkitImageSmoothingEnabled||a.mozImageSmoothingEnabled||
a.msImageSmoothingEnabled||a.oImageSmoothingEnabled;a.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(a,b,d,c){"string"===typeof b?fabric.util.loadImage(b,function(b){if(b){var g=new fabric.Image(b,c);this[a]=g;g.canvas=this}d&&d(b)},this,c&&c.crossOrigin):(c&&b.setOptions(c),(this[a]=b)&&(b.canvas=this),d&&d(b));return this},__setBgOverlayColor:function(a,b,d){this[a]=b;this._initGradient(b,a);this._initPattern(b,a,d);return this},_createCanvasElement:function(){var a=
d();if(!a)throw k;a.style||(a.style={});if("undefined"===typeof a.getContext)throw k;return a},_initOptions:function(a){var b=this.lowerCanvasEl;this._setOptions(a);this.width=this.width||parseInt(b.width,10)||0;this.height=this.height||parseInt(b.height,10)||0;this.lowerCanvasEl.style&&(b.width=this.width,b.height=this.height,b.style.width=this.width+"px",b.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(a){this.lowerCanvasEl=a&&a.getContext?
a:fabric.util.getById(a)||this._createCanvasElement();fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,b){return this.setDimensions({width:a},b)},setHeight:function(a,b){return this.setDimensions({height:a},b)},setDimensions:function(a,b){b=b||{};for(var d in a){var c=a[d];
b.cssOnly||(this._setBackstoreDimension(d,a[d]),c+="px",this.hasLostContext=!0);b.backstoreOnly||this._setCssDimension(d,c)}this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles();this._initRetinaScaling();this._setImageSmoothing();this.calcOffset();b.cssOnly||this.requestRenderAll();return this},_setBackstoreDimension:function(a,b){this.lowerCanvasEl[a]=b;this.upperCanvasEl&&(this.upperCanvasEl[a]=b);this.cacheCanvasEl&&(this.cacheCanvasEl[a]=b);this[a]=b;return this},
_setCssDimension:function(a,b){this.lowerCanvasEl.style[a]=b;this.upperCanvasEl&&(this.upperCanvasEl.style[a]=b);this.wrapperEl&&(this.wrapperEl.style[a]=b);return this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(a){var b=this._activeObject,d;this.viewportTransform=a;var c=0;for(d=this._objects.length;c<d;c++)a=this._objects[c],a.group||a.setCoords(!1,!0);b&&"activeSelection"===b.type&&b.setCoords(!1,!0);this.calcViewportBoundaries();this.renderOnAddRemove&&
this.requestRenderAll();return this},zoomToPoint:function(b,d){var c=b,f=this.viewportTransform.slice(0);b=a(b,g(this.viewportTransform));f[0]=d;f[3]=d;b=a(b,f);f[4]+=c.x-b.x;f[5]+=c.y-b.y;return this.setViewportTransform(f)},setZoom:function(a){this.zoomToPoint(new fabric.Point(0,0),a);return this},absolutePan:function(a){var b=this.viewportTransform.slice(0);b[4]=-a.x;b[5]=-a.y;return this.setViewportTransform(b)},relativePan:function(a){return this.absolutePan(new fabric.Point(-a.x-this.viewportTransform[4],
-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(a){this.stateful&&a.setupState();a._set("canvas",this);a.setCoords();this.fire("object:added",{target:a});a.fire("added")},_onObjectRemoved:function(a){this.fire("object:removed",{target:a});a.fire("removed");delete a.canvas},clearContext:function(a){a.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=
0;this.overlayImage=this.backgroundImage=null;this.overlayColor=this.backgroundColor="";this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1);this.clearContext(this.contextContainer);this.fire("canvas:cleared");this.renderOnAddRemove&&this.requestRenderAll();return this},renderAll:function(){this.renderCanvas(this.contextContainer,this._objects);return this},renderAndReset:function(){this.isRendering=0;this.renderAll()},requestRenderAll:function(){this.isRendering||
(this.isRendering=fabric.util.requestAnimFrame(this.renderAndResetBound));return this},calcViewportBoundaries:function(){var b={},d=this.width,c=this.height,f=g(this.viewportTransform);b.tl=a({x:0,y:0},f);b.br=a({x:d,y:c},f);b.tr=new fabric.Point(b.br.x,b.tl.y);b.bl=new fabric.Point(b.tl.x,b.br.y);return this.vptCoords=b},cancelRequestedRender:function(){this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(a,b){var d=this.viewportTransform,c=
this.clipPath;this.cancelRequestedRender();this.calcViewportBoundaries();this.clearContext(a);this.fire("before:render",{ctx:a});this.clipTo&&fabric.util.clipContext(this,a);this._renderBackground(a);a.save();a.transform(d[0],d[1],d[2],d[3],d[4],d[5]);this._renderObjects(a,b);a.restore();!this.controlsAboveOverlay&&this.interactive&&this.drawControls(a);this.clipTo&&a.restore();c&&(c.canvas=this,c.shouldCache(),c._transformDone=!0,c.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(a));this._renderOverlay(a);
this.controlsAboveOverlay&&this.interactive&&this.drawControls(a);this.fire("after:render",{ctx:a})},drawClipPathOnCanvas:function(a){var b=this.viewportTransform,d=this.clipPath;a.save();a.transform(b[0],b[1],b[2],b[3],b[4],b[5]);a.globalCompositeOperation="destination-in";d.transform(a);a.scale(1/d.zoomX,1/d.zoomY);a.drawImage(d._cacheCanvas,-d.cacheTranslationX,-d.cacheTranslationY);a.restore()},_renderObjects:function(a,b){var d;var c=0;for(d=b.length;c<d;++c)b[c]&&b[c].render(a)},_renderBackgroundOrOverlay:function(a,
b){var d=this[b+"Color"],c=this[b+"Image"],g=this.viewportTransform;b=this[b+"Vpt"];if(d||c)d&&(a.save(),a.beginPath(),a.moveTo(0,0),a.lineTo(this.width,0),a.lineTo(this.width,this.height),a.lineTo(0,this.height),a.closePath(),a.fillStyle=d.toLive?d.toLive(a,this):d,b&&a.transform(g[0],g[1],g[2],g[3],g[4],g[5]),a.transform(1,0,0,1,d.offsetX||0,d.offsetY||0),(d=d.gradientTransform||d.patternTransform)&&a.transform(d[0],d[1],d[2],d[3],d[4],d[5]),a.fill(),a.restore()),c&&(a.save(),b&&a.transform(g[0],
g[1],g[2],g[3],g[4],g[5]),c.render(a),a.restore())},_renderBackground:function(a){this._renderBackgroundOrOverlay(a,"background")},_renderOverlay:function(a){this._renderBackgroundOrOverlay(a,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},centerObjectH:function(a){return this._centerObject(a,new fabric.Point(this.getCenter().left,a.getCenterPoint().y))},centerObjectV:function(a){return this._centerObject(a,new fabric.Point(a.getCenterPoint().x,this.getCenter().top))},
centerObject:function(a){var b=this.getCenter();return this._centerObject(a,new fabric.Point(b.left,b.top))},viewportCenterObject:function(a){var b=this.getVpCenter();return this._centerObject(a,b)},viewportCenterObjectH:function(a){var b=this.getVpCenter();this._centerObject(a,new fabric.Point(b.x,a.getCenterPoint().y));return this},viewportCenterObjectV:function(a){var b=this.getVpCenter();return this._centerObject(a,new fabric.Point(a.getCenterPoint().x,b.y))},getVpCenter:function(){var b=this.getCenter(),
d=g(this.viewportTransform);return a({x:b.left,y:b.top},d)},_centerObject:function(a,b){a.setPositionByOrigin(b,"center","center");a.setCoords();this.renderOnAddRemove&&this.requestRenderAll();return this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(a,b){var d=this.clipPath,c={version:fabric.version,objects:this._toObjects(a,
b)};d&&(c.clipPath=this._toObject(this.clipPath,a,b));e(c,this.__serializeBgOverlay(a,b));fabric.util.populateWithProperties(this,c,b);return c},_toObjects:function(a,b){return this._objects.filter(function(a){return!a.excludeFromExport}).map(function(d){return this._toObject(d,a,b)},this)},_toObject:function(a,b,d){if(!this.includeDefaultValues){var c=a.includeDefaultValues;a.includeDefaultValues=!1}b=a[b](d);this.includeDefaultValues||(a.includeDefaultValues=c);return b},__serializeBgOverlay:function(a,
b){var d={},c=this.backgroundImage,g=this.overlayImage;this.backgroundColor&&(d.background=this.backgroundColor.toObject?this.backgroundColor.toObject(b):this.backgroundColor);this.overlayColor&&(d.overlay=this.overlayColor.toObject?this.overlayColor.toObject(b):this.overlayColor);c&&!c.excludeFromExport&&(d.backgroundImage=this._toObject(c,a,b));g&&!g.excludeFromExport&&(d.overlayImage=this._toObject(g,a,b));return d},svgViewportTransformation:!0,toSVG:function(a,b){a||(a={});a.reviver=b;var d=[];
this._setSVGPreamble(d,a);this._setSVGHeader(d,a);this.clipPath&&d.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n');this._setSVGBgOverlayColor(d,"background");this._setSVGBgOverlayImage(d,"backgroundImage",b);this._setSVGObjects(d,b);this.clipPath&&d.push("</g>\n");this._setSVGBgOverlayColor(d,"overlay");this._setSVGBgOverlayImage(d,"overlayImage",b);d.push("</svg>");return d.join("")},_setSVGPreamble:function(a,b){b.suppressPreamble||a.push('<?xml version="1.0" encoding="',b.encoding||
"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(a,d){var c=d.width||this.width,g=d.height||this.height;var f='viewBox="0 0 '+this.width+" "+this.height+'" ';var k=fabric.Object.NUM_FRACTION_DIGITS;d.viewBox?f='viewBox="'+d.viewBox.x+" "+d.viewBox.y+" "+d.viewBox.width+" "+d.viewBox.height+'" ':this.svgViewportTransformation&&(f=this.viewportTransform,f='viewBox="'+b(-f[4]/f[0],k)+" "+
b(-f[5]/f[3],k)+" "+b(this.width/f[0],k)+" "+b(this.height/f[3],k)+'" ');a.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',c,'" ','height="',g,'" ',f,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(d),"</defs>\n")},createSVGClipPathMarkup:function(a){var b=this.clipPath;return b?(b.clipPathId=
"CLIPPATH_"+fabric.Object.__uid++,'<clipPath id="'+b.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(a.reviver)+"</clipPath>\n"):""},createSVGRefElementsMarkup:function(){var a=this;return["background","overlay"].map(function(b){var d=a[b+"Color"];if(d&&d.toLive){b=a[b+"Vpt"];var c=a.viewportTransform;return d.toSVG({width:a.width/(b?c[0]:1),height:a.height/(b?c[3]:1)},{additionalTransform:b?fabric.util.matrixToSVG(c):""})}}).join("")},createSVGFontFacesMarkup:function(){var a="",b={},d,c,g,f=fabric.fontPaths,
k=[];this._objects.forEach(function u(a){k.push(a);a._objects&&a._objects.forEach(u)});var e=0;for(g=k.length;e<g;e++){var l=k[e];var r=l.fontFamily;if(-1!==l.type.indexOf("text")&&!b[r]&&f[r]&&(b[r]=!0,l.styles))for(d in l=l.styles,l){var w=l[d];for(c in w)r=w[c],r=r.fontFamily,!b[r]&&f[r]&&(b[r]=!0)}}for(var y in b)a+=["\t\t@font-face {\n\t\t\tfont-family: '",y,"';\n\t\t\tsrc: url('",f[y],"');\n\t\t}\n"].join("");a&&(a=['\t<style type="text/css"><![CDATA[\n',a,"]]\x3e</style>\n"].join(""));return a},
_setSVGObjects:function(a,b){var d,c=this._objects;var g=0;for(d=c.length;g<d;g++){var f=c[g];f.excludeFromExport||this._setSVGObject(a,f,b)}},_setSVGObject:function(a,b,d){a.push(b.toSVG(d))},_setSVGBgOverlayImage:function(a,b,d){this[b]&&!this[b].excludeFromExport&&this[b].toSVG&&a.push(this[b].toSVG(d))},_setSVGBgOverlayColor:function(a,b){var d=this[b+"Color"],c=this.viewportTransform,g=this.width,f=this.height;if(d)if(d.toLive){var k=d.repeat;c=fabric.util.invertTransform(c);b=this[b+"Vpt"]?
fabric.util.matrixToSVG(c):"";a.push('<rect transform="'+b+" translate(",g/2,",",f/2,')"',' x="',d.offsetX-g/2,'" y="',d.offsetY-f/2,'" ','width="',"repeat-y"===k||"no-repeat"===k?d.source.width:g,'" height="',"repeat-x"===k||"no-repeat"===k?d.source.height:f,'" fill="url(#SVGID_'+d.id+')"',"></rect>\n")}else a.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',d,'"',"></rect>\n")},sendToBack:function(a){if(!a)return this;var b=this._activeObject;if(a===b&&"activeSelection"===a.type){var d=
b._objects;for(a=d.length;a--;)b=d[a],f(this._objects,b),this._objects.unshift(b)}else f(this._objects,a),this._objects.unshift(a);this.renderOnAddRemove&&this.requestRenderAll();return this},bringToFront:function(a){if(!a)return this;var b=this._activeObject;if(a===b&&"activeSelection"===a.type){var d=b._objects;for(a=0;a<d.length;a++)b=d[a],f(this._objects,b),this._objects.push(b)}else f(this._objects,a),this._objects.push(a);this.renderOnAddRemove&&this.requestRenderAll();return this},sendBackwards:function(a,
b){if(!a)return this;var d=this._activeObject,c=0;if(a===d&&"activeSelection"===a.type){var g=d._objects;for(a=0;a<g.length;a++)b=g[a],d=this._objects.indexOf(b),d>0+c&&(--d,f(this._objects,b),this._objects.splice(d,0,b)),c++}else d=this._objects.indexOf(a),0!==d&&(d=this._findNewLowerIndex(a,d,b),f(this._objects,a),this._objects.splice(d,0,a));this.renderOnAddRemove&&this.requestRenderAll();return this},_findNewLowerIndex:function(a,b,d){if(d)for(d=b,--b;0<=b;--b){if(a.intersectsWithObject(this._objects[b])||
a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){d=b;break}}else d=b-1;return d},bringForward:function(a,b){if(!a)return this;var d=this._activeObject,c=0;if(a===d&&"activeSelection"===a.type){var g=d._objects;for(a=g.length;a--;)b=g[a],d=this._objects.indexOf(b),d<this._objects.length-1-c&&(d+=1,f(this._objects,b),this._objects.splice(d,0,b)),c++}else d=this._objects.indexOf(a),d!==this._objects.length-1&&(d=this._findNewUpperIndex(a,d,b),f(this._objects,
a),this._objects.splice(d,0,a));this.renderOnAddRemove&&this.requestRenderAll();return this},_findNewUpperIndex:function(a,b,d){var c;if(d)for(d=b,b+=1,c=this._objects.length;b<c;++b){if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){d=b;break}}else d=b+1;return d},moveTo:function(a,b){f(this._objects,a);this._objects.splice(b,0,a);return this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){this.isRendering&&
(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0);this.forEachObject(function(a){a.dispose&&a.dispose()});this._objects=[];this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose();this.backgroundImage=null;this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose();this.contextContainer=this._iTextInstances=this.overlayImage=null;fabric.util.cleanUpJsdomNode(this.lowerCanvasEl);this.lowerCanvasEl=void 0;return this},toString:function(){return"#<fabric.Canvas ("+
this.complexity()+"): { objects: "+this._objects.length+" }>"}});e(fabric.StaticCanvas.prototype,fabric.Observable);e(fabric.StaticCanvas.prototype,fabric.Collection);e(fabric.StaticCanvas.prototype,fabric.DataURLExporter);e(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var b=d();if(!b||!b.getContext)return null;b=b.getContext("2d");if(!b)return null;switch(a){case "setLineDash":return"undefined"!==typeof b.setLineDash;default:return null}}});fabric.StaticCanvas.prototype.toJSON=
fabric.StaticCanvas.prototype.toObject;fabric.isLikelyNode&&(fabric.StaticCanvas.prototype.createPNGStream=function(){var a=l(this.lowerCanvasEl);return a&&a.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(a){var b=l(this.lowerCanvasEl);return b&&b.createJPEGStream(a)})}})();
(function(){var e=fabric.util.getPointer,c=fabric.util.degreesToRadians,f=fabric.util.radiansToDegrees,b=Math.atan2,a=Math.abs,g=fabric.StaticCanvas.supports("setLineDash");fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(a,b){b||(b={});this.renderAndResetBound=this.renderAndReset.bind(this);this.requestRenderAllBound=this.requestRenderAll.bind(this);this._initStatic(a,b);this._initInteractive();this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,
centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,
targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._groupSelector=this._currentTransform=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this._initRetinaScaling();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_chooseObjectsToRender:function(){var a=
this.getActiveObjects();if(0<a.length&&!this.preserveObjectStacking){var b=[];var c=[];for(var g=0,f=this._objects.length;g<f;g++){var e=this._objects[g];-1===a.indexOf(e)?b.push(e):c.push(e)}1<a.length&&(this._activeObject._objects=c);b.push.apply(b,c)}else b=this._objects;return b},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1);this.hasLostContext&&this.renderTopLayer(this.contextTop);this.renderCanvas(this.contextContainer,
this._chooseObjectsToRender());return this},renderTopLayer:function(a){a.save();this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0);this.selection&&this._groupSelector&&(this._drawSelection(a),this.contextTopDirty=!0);a.restore()},renderTop:function(){var a=this.contextTop;this.clearContext(a);this.renderTopLayer(a);this.fire("after:render");return this},_resetCurrentTransform:function(){var a=this._currentTransform;a.target.set({scaleX:a.original.scaleX,
scaleY:a.original.scaleY,skewX:a.original.skewX,skewY:a.original.skewY,left:a.original.left,top:a.original.top});this._shouldCenterTransform(a.target)?("center"!==a.originX&&(a.mouseXSign="right"===a.originX?-1:1),"center"!==a.originY&&(a.mouseYSign="bottom"===a.originY?-1:1),a.originX="center",a.originY="center"):(a.originX=a.original.originX,a.originY=a.original.originY)},containsPoint:function(a,b,c){a=c||this.getPointer(a,!0);c=b.group&&b.group===this._activeObject&&"activeSelection"===b.group.type?
this._normalizePointer(b.group,a):{x:a.x,y:a.y};return b.containsPoint(c)||b._findTargetCorner(a)},_normalizePointer:function(a,b){a=a.calcTransformMatrix();a=fabric.util.invertTransform(a);b=this.restorePointerVpt(b);return fabric.util.transformPoint(b,a)},isTargetTransparent:function(a,b,c){if(a.shouldCache()&&a._cacheCanvas&&a!==this._activeObject)return b=this._normalizePointer(a,{x:b,y:c}),a=fabric.util.isTransparent(a._cacheContext,Math.round(Math.max(a.cacheTranslationX+b.x*a.zoomX,0)),Math.round(Math.max(a.cacheTranslationY+
b.y*a.zoomY,0)),this.targetFindTolerance);var d=this.contextCache,g=a.selectionBackgroundColor,f=this.viewportTransform;a.selectionBackgroundColor="";this.clearContext(d);d.save();d.transform(f[0],f[1],f[2],f[3],f[4],f[5]);a.render(d);d.restore();a===this._activeObject&&a._renderControls(d,{hasBorders:!1,transparentCorners:!1},{hasBorders:!1});a.selectionBackgroundColor=g;return a=fabric.util.isTransparent(d,b,c,this.targetFindTolerance)},_isSelectionKeyPressed:function(a){var b=!1;return b="[object Array]"===
Object.prototype.toString.call(this.selectionKey)?!!this.selectionKey.find(function(b){return!0===a[b]}):a[this.selectionKey]},_shouldClearSelection:function(a,b){var d=this.getActiveObjects(),c=this._activeObject;return!b||b&&c&&1<d.length&&-1===d.indexOf(b)&&c!==b&&!this._isSelectionKeyPressed(a)||b&&!b.evented||b&&!b.selectable&&c&&c!==b},_shouldCenterTransform:function(a){if(a){var b=this._currentTransform,d;"scale"===b.action||"scaleX"===b.action||"scaleY"===b.action?d=this.centeredScaling||
a.centeredScaling:"rotate"===b.action&&(d=this.centeredRotation||a.centeredRotation);return d?!b.altKey:b.altKey}},_getOriginFromCorner:function(a,b){a={x:a.originX,y:a.originY};if("ml"===b||"tl"===b||"bl"===b)a.x="right";else if("mr"===b||"tr"===b||"br"===b)a.x="left";if("tl"===b||"mt"===b||"tr"===b)a.y="bottom";else if("bl"===b||"mb"===b||"br"===b)a.y="top";return a},_getActionFromCorner:function(a,b,c){if(!b||!a)return"drag";switch(b){case "mtr":return"rotate";case "ml":case "mr":return c[this.altActionKey]?
"skewY":"scaleX";case "mt":case "mb":return c[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(a,b,g){if(b){var d=this.getPointer(a),f=b._findTargetCorner(this.getPointer(a,!0));g=this._getActionFromCorner(g,f,a,b);var k=this._getOriginFromCorner(b,f);this._currentTransform={target:b,action:g,corner:f,scaleX:b.scaleX,scaleY:b.scaleY,skewX:b.skewX,skewY:b.skewY,offsetX:d.x-b.left,offsetY:d.y-b.top,originX:k.x,originY:k.y,ex:d.x,ey:d.y,lastX:d.x,lastY:d.y,
theta:c(b.angle),width:b.width*b.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:a.shiftKey,altKey:a[this.centeredKey],original:fabric.util.saveObjectTransform(b)};this._currentTransform.original.originX=k.x;this._currentTransform.original.originY=k.y;this._resetCurrentTransform();this._beforeTransform(a)}},_translateObject:function(a,b){var d=this._currentTransform,c=d.target;a-=d.offsetX;b-=d.offsetY;d=!c.get("lockMovementX")&&c.left!==a;var g=!c.get("lockMovementY")&&c.top!==b;d&&c.set("left",a);g&&
c.set("top",b);return d||g},_changeSkewTransformOrigin:function(a,b,c){var d="originX",g={0:"center"},f=b.target.skewX,e="left",k="right",l="mt"===b.corner||"ml"===b.corner?1:-1,h=1;a=0<a?1:-1;"y"===c&&(f=b.target.skewY,e="top",k="bottom",d="originY");g[-1]=e;g[1]=k;b.target.flipX&&(h*=-1);b.target.flipY&&(h*=-1);0===f?(b.skewSign=-l*a*h,b[d]=g[-a]):(f=0<f?1:-1,b.skewSign=f,b[d]=g[f*l*h])},_skewObject:function(a,b,c){var d=this._currentTransform,g=d.target,f=g.get("lockSkewingX"),e=g.get("lockSkewingY");
if(f&&"x"===c||e&&"y"===c)return!1;e=g.getCenterPoint();var k=g.toLocalPoint(new fabric.Point(a,b),"center","center")[c],l=g.toLocalPoint(new fabric.Point(d.lastX,d.lastY),"center","center")[c];f=g._getTransformedDimensions();this._changeSkewTransformOrigin(k-l,d,c);k=g.toLocalPoint(new fabric.Point(a,b),d.originX,d.originY)[c];e=g.translateToOriginPoint(e,d.originX,d.originY);c=this._setObjectSkew(k,d,c,f);d.lastX=a;d.lastY=b;g.setPositionByOrigin(e,d.originX,d.originY);return c},_setObjectSkew:function(a,
b,c,g){var d=b.target,f=b.skewSign;if("x"===c){b="y";var e="Y";var k="X";var l=0;var h=d.skewY}else b="x",e="X",k="Y",l=d.skewX,h=0;l=d._getTransformedDimensions(l,h);a=2*Math.abs(a)-l[c];2>=a?c=0:(c=f*Math.atan(a/d["scale"+k]/(l[b]/d["scale"+e])),c=fabric.util.radiansToDegrees(c));a=d["skew"+k]!==c;d.set("skew"+k,c);0!==d["skew"+e]&&(k=d._getTransformedDimensions(),c=g[b]/k[b]*d["scale"+e],d.set("scale"+e,c));return a},_scaleObject:function(a,b,c){var d=this._currentTransform,g=d.target,f=g.lockScalingX,
e=g.lockScalingY,k=g.lockScalingFlip;if(f&&e)return!1;var l=g.translateToOriginPoint(g.getCenterPoint(),d.originX,d.originY);a=g.toLocalPoint(new fabric.Point(a,b),d.originX,d.originY);b=g._getTransformedDimensions();this._setLocalMouse(a,d);c=this._setObjectScale(a,d,f,e,c,k,b);g.setPositionByOrigin(l,d.originX,d.originY);return c},_setObjectScale:function(a,b,c,g,f,e,l){var d=b.target,k=!1,h=!1,m=!1,n=a.x*d.scaleX/l.x,q=a.y*d.scaleY/l.y,x=d.scaleX!==n,z=d.scaleY!==q;b.newScaleX=n;b.newScaleY=q;
if(fabric.Textbox&&"x"===f&&d instanceof fabric.Textbox)return a=a.x/l.x*d.width,a>=d.getMinWidth()?(m=a!==d.width,d.set("width",a),m):!1;e&&0>=n&&n<d.scaleX&&(k=!0,a.x=0);e&&0>=q&&q<d.scaleY&&(h=!0,a.y=0);"equally"!==f||c||g?f?"x"!==f||d.get("lockUniScaling")?"y"!==f||d.get("lockUniScaling")||h||g||d.set("scaleY",q)&&(m=z):k||c||d.set("scaleX",n)&&(m=x):(k||c||d.set("scaleX",n)&&(m=m||x),h||g||d.set("scaleY",q)&&(m=m||z)):m=this._scaleObjectEqually(a,d,b,l);k||h||this._flipObject(b,f);return m},
_scaleObjectEqually:function(a,b,c,g){var d=a.y+a.x;g=g.y*c.original.scaleY/b.scaleY+g.x*c.original.scaleX/b.scaleX;var f=0>a.y?-1:1;a=(0>a.x?-1:1)*Math.abs(c.original.scaleX*d/g);d=f*Math.abs(c.original.scaleY*d/g);c=a!==b.scaleX||d!==b.scaleY;b.set("scaleX",a);b.set("scaleY",d);return c},_flipObject:function(a,b){0>a.newScaleX&&"y"!==b&&("left"===a.originX?a.originX="right":"right"===a.originX&&(a.originX="left"));0>a.newScaleY&&"x"!==b&&("top"===a.originY?a.originY="bottom":"bottom"===a.originY&&
(a.originY="top"))},_setLocalMouse:function(b,c){var d=c.target,g=this.getZoom();d=d.padding/g;"right"===c.originX?b.x*=-1:"center"===c.originX&&(b.x=2*b.x*c.mouseXSign,0>b.x&&(c.mouseXSign=-c.mouseXSign));"bottom"===c.originY?b.y*=-1:"center"===c.originY&&(b.y=2*b.y*c.mouseYSign,0>b.y&&(c.mouseYSign=-c.mouseYSign));a(b.x)>d?b.x=0>b.x?b.x+d:b.x-d:b.x=0;a(b.y)>d?b.y=0>b.y?b.y+d:b.y-d:b.y=0},_rotateObject:function(a,c){var d=this._currentTransform,g=d.target;var e=g.translateToOriginPoint(g.getCenterPoint(),
d.originX,d.originY);if(g.lockRotation)return!1;var k=b(d.ey-e.y,d.ex-e.x);a=b(c-e.y,a-e.x);k=f(a-k+d.theta);a=!0;if(0<g.snapAngle){var l=g.snapAngle;c=g.snapThreshold||l;var t=Math.ceil(k/l)*l;l*=Math.floor(k/l);Math.abs(k-l)<c?k=l:Math.abs(k-t)<c&&(k=t)}0>k&&(k=360+k);k%=360;g.angle===k?a=!1:(g.angle=k,g.setPositionByOrigin(e,d.originX,d.originY));return a},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_drawSelection:function(b){var d=this._groupSelector,c=d.left,f=d.top,e=a(c),l=a(f);
this.selectionColor&&(b.fillStyle=this.selectionColor,b.fillRect(d.ex-(0<c?0:-c),d.ey-(0<f?0:-f),e,l));this.selectionLineWidth&&this.selectionBorderColor&&(b.lineWidth=this.selectionLineWidth,b.strokeStyle=this.selectionBorderColor,1<this.selectionDashArray.length&&!g?(c=d.ex+.5-(0<c?0:e),d=d.ey+.5-(0<f?0:l),b.beginPath(),fabric.util.drawDashedLine(b,c,d,c+e,d,this.selectionDashArray),fabric.util.drawDashedLine(b,c,d+l-1,c+e,d+l-1,this.selectionDashArray),fabric.util.drawDashedLine(b,c,d,c,d+l,this.selectionDashArray),
fabric.util.drawDashedLine(b,c+e-1,d,c+e-1,d+l,this.selectionDashArray),b.closePath(),b.stroke()):(fabric.Object.prototype._setLineDash.call(this,b,this.selectionDashArray),b.strokeRect(d.ex+.5-(0<c?0:e),d.ey+.5-(0<f?0:l),e,l)))},findTarget:function(a,b){if(!this.skipTargetFind){var d=this.getPointer(a,!0),c=this._activeObject,g=this.getActiveObjects();this.targets=[];if(1<g.length&&!b&&c===this._searchPossibleTargets([c],d)||1===g.length&&c._findTargetCorner(d))return c;if(1===g.length&&c===this._searchPossibleTargets([c],
d))if(this.preserveObjectStacking){var f=c;var e=this.targets;this.targets=[]}else return c;b=this._searchPossibleTargets(this._objects,d);a[this.altSelectionKey]&&b&&f&&b!==f&&(b=f,this.targets=e);return b}},_checkTarget:function(a,b,c){if(b&&b.visible&&b.evented&&this.containsPoint(null,b,a)&&(!this.perPixelTargetFind&&!b.perPixelTargetFind||b.isEditing||!this.isTargetTransparent(b,c.x,c.y)))return!0},_searchPossibleTargets:function(a,b){for(var d,c=a.length;c--;){var g=a[c],f=g.group&&"activeSelection"!==
g.group.type?this._normalizePointer(g.group,b):b;if(this._checkTarget(f,g,b)){d=a[c];d.subTargetCheck&&d instanceof fabric.Group&&(a=this._searchPossibleTargets(d._objects,b))&&this.targets.push(a);break}}return d},restorePointerVpt:function(a){return fabric.util.transformPoint(a,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(a,b){var d,c;if(this._absolutePointer&&!b)return this._absolutePointer;if(this._pointer&&b)return this._pointer;a=e(a);var g=this.upperCanvasEl,f=
g.getBoundingClientRect(),k=f.width||0,l=f.height||0;k&&l||("top"in f&&"bottom"in f&&(l=Math.abs(f.top-f.bottom)),"right"in f&&"left"in f&&(k=Math.abs(f.right-f.left)));this.calcOffset();a.x-=this._offset.left;a.y-=this._offset.top;b||(a=this.restorePointerVpt(a));b=this.getRetinaScaling();1!==b&&(a.x/=b,a.y/=b);0===k||0===l?(d=1,c=1):(d=g.width/k,c=g.height/l);return{x:a.x*d,y:a.y*c}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),b=this.lowerCanvasEl,
c=this.upperCanvasEl;c?c.className="":this.upperCanvasEl=c=this._createCanvasElement();fabric.util.addClass(c,"upper-canvas "+a);this.wrapperEl.appendChild(c);this._copyCanvasStyle(b,c);this._applyCanvasStyle(c);this.contextTop=c.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=
fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var b=this.width||a.width,d=this.height||a.height;fabric.util.setStyle(a,{position:"absolute",width:b+"px",height:d+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?
"manipulation":"none"});a.width=b;a.height=d;fabric.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,b){b.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var a=this._activeObject;return a?"activeSelection"===a.type&&a._objects?a._objects.slice(0):[a]:[]},_onObjectRemoved:function(a){a===this._activeObject&&(this.fire("before:selection:cleared",
{target:a}),this._discardActiveObject(),this.fire("selection:cleared",{target:a}),a.fire("deselected"));a===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]);this.callSuper("_onObjectRemoved",a)},_fireSelectionEvents:function(a,b){var c=!1,d=this.getActiveObjects(),g=[],f=[],e={e:b};a.forEach(function(a){-1===d.indexOf(a)&&(c=!0,a.fire("deselected",e),f.push(a))});d.forEach(function(b){-1===a.indexOf(b)&&(c=!0,b.fire("selected",e),g.push(b))});0<a.length&&0<d.length?(e.selected=
g,e.deselected=f,e.updated=g[0]||f[0],e.target=this._activeObject,c&&this.fire("selection:updated",e)):0<d.length?(1===d.length&&(e.target=g[0],this.fire("object:selected",e)),e.selected=g,e.target=this._activeObject,this.fire("selection:created",e)):0<a.length&&(e.deselected=f,this.fire("selection:cleared",e))},setActiveObject:function(a,b){var c=this.getActiveObjects();this._setActiveObject(a,b);this._fireSelectionEvents(c,b);return this},_setActiveObject:function(a,b){if(this._activeObject===a||
!this._discardActiveObject(b,a)||a.onSelect({e:b}))return!1;this._activeObject=a;return!0},_discardActiveObject:function(a,b){var c=this._activeObject;if(c){if(c.onDeselect({e:a,object:b}))return!1;this._activeObject=null}return!0},discardActiveObject:function(a){var b=this.getActiveObjects(),c=this.getActiveObject();b.length&&this.fire("before:selection:cleared",{target:c,e:a});this._discardActiveObject(a);this._fireSelectionEvents(b,a);return this},dispose:function(){var a=this.wrapperEl;this.removeListeners();
a.removeChild(this.upperCanvasEl);a.removeChild(this.lowerCanvasEl);this.contextTop=this.contextCache=null;["upperCanvasEl","cacheCanvasEl"].forEach(function(a){fabric.util.cleanUpJsdomNode(this[a]);this[a]=void 0}.bind(this));a.parentNode&&a.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl);delete this.wrapperEl;fabric.StaticCanvas.prototype.dispose.call(this);return this},clear:function(){this.discardActiveObject();this.clearContext(this.contextTop);return this.callSuper("clear")},drawControls:function(a){var b=
this._activeObject;b&&b._renderControls(a)},_toObject:function(a,b,c){var d=this._realizeGroupTransformOnObject(a);b=this.callSuper("_toObject",a,b,c);this._unwindGroupTransformOnObject(a,d);return b},_realizeGroupTransformOnObject:function(a){if(a.group&&"activeSelection"===a.group.type&&this._activeObject===a.group){var b={};"angle flipX flipY left scaleX scaleY skewX skewY top".split(" ").forEach(function(c){b[c]=a[c]});this._activeObject.realizeTransform(a);return b}return null},_unwindGroupTransformOnObject:function(a,
b){b&&a.set(b)},_setSVGObject:function(a,b,c){var d=this._realizeGroupTransformOnObject(b);this.callSuper("_setSVGObject",a,b,c);this._unwindGroupTransformOnObject(b,d)},setViewportTransform:function(a){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop();fabric.StaticCanvas.prototype.setViewportTransform.call(this,a)}});for(var l in fabric.StaticCanvas)"prototype"!==l&&(fabric.Canvas[l]=fabric.StaticCanvas[l])})();
(function(){var e={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},c=fabric.util.addListener,f=fabric.util.removeListener,b={passive:!1};fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:"n-resize ne-resize e-resize se-resize s-resize sw-resize w-resize nw-resize".split(" "),mainTouchId:null,_initEventListeners:function(){this.removeListeners();this._bindEvents();this.addOrRemove(c,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(a,c){var g=
this.upperCanvasEl,d=this._getEventPrefix();a(fabric.window,"resize",this._onResize);a(g,d+"down",this._onMouseDown);a(g,d+"move",this._onMouseMove,b);a(g,d+"out",this._onMouseOut);a(g,d+"enter",this._onMouseEnter);a(g,"wheel",this._onMouseWheel);a(g,"contextmenu",this._onContextMenu);a(g,"dblclick",this._onDoubleClick);a(g,"dragover",this._onDragOver);a(g,"dragenter",this._onDragEnter);a(g,"dragleave",this._onDragLeave);a(g,"drop",this._onDrop);this.enablePointerEvents||a(g,"touchstart",this._onTouchStart,
b);"undefined"!==typeof eventjs&&c in eventjs&&(eventjs[c](g,"gesture",this._onGesture),eventjs[c](g,"drag",this._onDrag),eventjs[c](g,"orientation",this._onOrientationChange),eventjs[c](g,"shake",this._onShake),eventjs[c](g,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(f,"remove");var a=this._getEventPrefix();f(fabric.document,a+"up",this._onMouseUp);f(fabric.document,"touchend",this._onTouchEnd,b);f(fabric.document,a+"move",this._onMouseMove,b);f(fabric.document,"touchmove",
this._onMouseMove,b)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),
this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._simpleEventHandler.bind(this,
"drop"),this.eventsBound=!0)},_onGesture:function(a,b){this.__onTransformGesture&&this.__onTransformGesture(a,b)},_onDrag:function(a,b){this.__onDrag&&this.__onDrag(a,b)},_onMouseWheel:function(a){this.__onMouseWheel(a)},_onMouseOut:function(a){var b=this._hoveredTarget;this.fire("mouse:out",{target:b,e:a});this._hoveredTarget=null;b&&b.fire("mouseout",{e:a});var c=this;this._hoveredTargets.forEach(function(d){c.fire("mouse:out",{target:b,e:a});d&&b.fire("mouseout",{e:a})});this._hoveredTargets=[];
this._iTextInstances&&this._iTextInstances.forEach(function(a){a.isEditing&&a.hiddenTextarea.focus()})},_onMouseEnter:function(a){this.currentTransform||this.findTarget(a)||(this.fire("mouse:over",{target:null,e:a}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(a,b){this.__onOrientationChange&&this.__onOrientationChange(a,b)},_onShake:function(a,b){this.__onShake&&this.__onShake(a,b)},_onLongPress:function(a,b){this.__onLongPress&&this.__onLongPress(a,b)},_onDragOver:function(a){a.preventDefault();
var b=this._simpleEventHandler("dragover",a);this._fireEnterLeaveEvents(b,a)},_onContextMenu:function(a){this.stopContextMenu&&(a.stopPropagation(),a.preventDefault());return!1},_onDoubleClick:function(a){this._cacheTransformEventData(a);this._handleEvent(a,"dblclick");this._resetTransformEventData(a)},getPointerId:function(a){var b=a.changedTouches;return b?b[0]&&b[0].identifier:this.enablePointerEvents?a.pointerId:-1},_isMainEvent:function(a){return!0===a.isPrimary?!0:!1===a.isPrimary?!1:"touchend"===
a.type&&0===a.touches.length?!0:a.changedTouches?a.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(a){a.preventDefault();null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(a));this.__onMouseDown(a);this._resetTransformEventData();a=this.upperCanvasEl;var g=this._getEventPrefix();c(fabric.document,"touchend",this._onTouchEnd,b);c(fabric.document,"touchmove",this._onMouseMove,b);f(a,g+"down",this._onMouseDown)},_onMouseDown:function(a){this.__onMouseDown(a);this._resetTransformEventData();
a=this.upperCanvasEl;var g=this._getEventPrefix();f(a,g+"move",this._onMouseMove,b);c(fabric.document,g+"up",this._onMouseUp);c(fabric.document,g+"move",this._onMouseMove,b)},_onTouchEnd:function(a){if(!(0<a.touches.length)){this.__onMouseUp(a);this._resetTransformEventData();this.mainTouchId=null;var g=this._getEventPrefix();f(fabric.document,"touchend",this._onTouchEnd,b);f(fabric.document,"touchmove",this._onMouseMove,b);var e=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown);this._willAddMouseDown=
setTimeout(function(){c(e.upperCanvasEl,g+"down",e._onMouseDown);e._willAddMouseDown=0},400)}},_onMouseUp:function(a){this.__onMouseUp(a);this._resetTransformEventData();var g=this.upperCanvasEl,e=this._getEventPrefix();this._isMainEvent(a)&&(f(fabric.document,e+"up",this._onMouseUp),f(fabric.document,e+"move",this._onMouseMove,b),c(g,e+"move",this._onMouseMove,b))},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault();this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},
_shouldRender:function(a){var b=this._activeObject;return!!b!==!!a||b&&a&&b!==a?!0:!1},__onMouseUp:function(a){var b=this._currentTransform;var c=this._groupSelector;var d=!1,f=!c||0===c.left&&0===c.top;this._cacheTransformEventData(a);c=this._target;this._handleEvent(a,"up:before");a.button&&2===a.button?this.fireRightClick&&this._handleEvent(a,"up",3,f):a.button&&1===a.button?(this.fireMiddleClick&&this._handleEvent(a,"up",2,f),this._resetTransformEventData()):this.isDrawingMode&&this._isCurrentlyDrawing?
this._onMouseUpInDrawingMode(a):this._isMainEvent(a)&&(b&&(this._finalizeCurrentTransform(a),d=b.actionPerformed),f||(this._maybeGroupObjects(a),d||(d=this._shouldRender(c))),c&&(c.isMoving=!1),this._setCursorFromEvent(a,c),this._handleEvent(a,"up",1,f),this._currentTransform=this._groupSelector=null,c&&(c.__corner=0),d?this.requestRenderAll():f||this.renderTop())},_simpleEventHandler:function(a,b){var c=this.findTarget(b),d=this.targets;b={e:b,target:c,subTargets:d};this.fire(a,b);c&&c.fire(a,b);
if(!d)return c;for(var g=0;g<d.length;g++)d[g].fire(a,b);return c},_handleEvent:function(a,b,c,d){var g=this._target,f=this.targets||[];a={e:a,target:g,subTargets:f,button:c||1,isClick:d||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};this.fire("mouse:"+b,a);g&&g.fire("mouse"+b,a);for(g=0;g<f.length;g++)f[g].fire("mouse"+b,a)},_finalizeCurrentTransform:function(a){var b=this._currentTransform,c=b.target;a={e:a,target:c,transform:b};c._scaling&&(c._scaling=
!1);c.setCoords();if(b.actionPerformed||this.stateful&&c.hasStateChanged())b.actionPerformed&&(b=this._addEventOptions(a,b),this._fire(b,a)),this._fire("modified",a)},_addEventOptions:function(a,b){switch(b.action){case "scaleX":var c="scaled";var d="x";break;case "scaleY":c="scaled";d="y";break;case "skewX":c="skewed";d="x";break;case "skewY":c="skewed";d="y";break;case "scale":c="scaled";d="equally";break;case "rotate":c="rotated";break;case "drag":c="moved"}a.by=d;return c},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=
!0;this.getActiveObject()&&this.discardActiveObject(a).requestRenderAll();this.clipTo&&fabric.util.clipContext(this,this.contextTop);var b=this.getPointer(a);this.freeDrawingBrush.onMouseDown(b,{e:a,pointer:b});this._handleEvent(a,"down")},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var b=this.getPointer(a);this.freeDrawingBrush.onMouseMove(b,{e:a,pointer:b})}this.setCursor(this.freeDrawingCursor);this._handleEvent(a,"move")},_onMouseUpInDrawingMode:function(a){this.clipTo&&
this.contextTop.restore();var b=this.getPointer(a);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:a,pointer:b});this._handleEvent(a,"up")},__onMouseDown:function(a){this._cacheTransformEventData(a);this._handleEvent(a,"down:before");var b=this._target;if(a.button&&2===a.button)this.fireRightClick&&this._handleEvent(a,"down",3);else if(a.button&&1===a.button)this.fireMiddleClick&&this._handleEvent(a,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(a);else if(this._isMainEvent(a)&&
!this._currentTransform){var c=this._pointer;this._previousPointer=c;var d=this._shouldRender(b),f=this._shouldGroup(a,b);this._shouldClearSelection(a,b)?this.discardActiveObject(a):f&&(this._handleGrouping(a,b),b=this._activeObject);!this.selection||b&&(b.selectable||b.isEditing||b===this._activeObject)||(this._groupSelector={ex:c.x,ey:c.y,top:0,left:0});b&&(c=b===this._activeObject,b.selectable&&this.setActiveObject(b,a),b!==this._activeObject||!b.__corner&&f||this._setupCurrentTransform(a,b,c));
this._handleEvent(a,"down");(d||f)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._absolutePointer=this._pointer=this._target=null},_cacheTransformEventData:function(a){this._resetTransformEventData();this._pointer=this.getPointer(a,!0);this._absolutePointer=this.restorePointerVpt(this._pointer);this._target=this._currentTransform?this._currentTransform.target:this.findTarget(a)||null},_beforeTransform:function(a){var b=this._currentTransform;this.stateful&&b.target.saveState();
this.fire("before:transform",{e:a,transform:b});if(b.corner)this.onBeforeScaleRotate(b.target)},__onMouseMove:function(a){this._handleEvent(a,"move:before");this._cacheTransformEventData(a);if(this.isDrawingMode)this._onMouseMoveInDrawingMode(a);else if(this._isMainEvent(a)){var b=this._groupSelector;if(b){var c=this._pointer;b.left=c.x-b.ex;b.top=c.y-b.ey;this.renderTop()}else this._currentTransform?this._transformObject(a):(c=this.findTarget(a)||null,this._setCursorFromEvent(a,c),this._fireOverOutEvents(c,
a));this._handleEvent(a,"move");this._resetTransformEventData()}},_fireOverOutEvents:function(a,b){var c=this._hoveredTargets,d=this.targets,g=Math.max(c.length,d.length);this.fireSyntheticInOutEvents(a,b,{oldTarget:this._hoveredTarget,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var f=0;f<g;f++)this.fireSyntheticInOutEvents(d[f],b,{oldTarget:c[f],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=a;this._hoveredTargets=this.targets.concat()},
_fireEnterLeaveEvents:function(a,b){var c=this._hoveredTargets,d=this.targets,g=Math.max(c.length,d.length);this.fireSyntheticInOutEvents(a,b,{oldTarget:this._draggedoverTarget,evtOut:"dragleave",evtIn:"dragenter"});for(var f=0;f<g;f++)this.fireSyntheticInOutEvents(d[f],b,{oldTarget:c[f],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=a},fireSyntheticInOutEvents:function(a,b,c){var d=c.oldTarget,g=d!==a,f=c.canvasEvtIn,e=c.canvasEvtOut;if(g){var l={e:b,target:a,previousTarget:d};var n=
{e:b,target:d,nextTarget:a}}b=a&&g;d&&g&&(e&&this.fire(e,n),d.fire(c.evtOut,n));b&&(f&&this.fire(f,l),a.fire(c.evtIn,l))},__onMouseWheel:function(a){this._cacheTransformEventData(a);this._handleEvent(a,"wheel");this._resetTransformEventData()},_transformObject:function(a){var b=this.getPointer(a),c=this._currentTransform;c.reset=!1;c.target.isMoving=!0;c.shiftKey=a.shiftKey;c.altKey=a[this.centeredKey];this._beforeScaleTransform(a,c);this._performTransformAction(a,c,b);c.actionPerformed&&this.requestRenderAll()},
_performTransformAction:function(a,b,c){var d=c.x,g=c.y,f=b.action;c={target:b.target,e:a,transform:b,pointer:c};if("rotate"===f)(a=this._rotateObject(d,g))&&this._fire("rotating",c);else if("scale"===f)(a=this._onScale(a,b,d,g))&&this._fire("scaling",c);else if("scaleX"===f)(a=this._scaleObject(d,g,"x"))&&this._fire("scaling",c);else if("scaleY"===f)(a=this._scaleObject(d,g,"y"))&&this._fire("scaling",c);else if("skewX"===f)(a=this._skewObject(d,g,"x"))&&this._fire("skewing",c);else if("skewY"===
f)(a=this._skewObject(d,g,"y"))&&this._fire("skewing",c);else if(a=this._translateObject(d,g))this._fire("moving",c),this.setCursor(c.target.moveCursor||this.moveCursor);b.actionPerformed=b.actionPerformed||a},_fire:function(a,b){this.fire("object:"+a,b);b.target.fire(a,b)},_beforeScaleTransform:function(a,b){if("scale"===b.action||"scaleX"===b.action||"scaleY"===b.action)if((a=this._shouldCenterTransform(b.target))&&("center"!==b.originX||"center"!==b.originY)||!a&&"center"===b.originX&&"center"===
b.originY)this._resetCurrentTransform(),b.reset=!0},_onScale:function(a,b,c,d){if(this._isUniscalePossible(a,b.target))return b.currentAction="scale",this._scaleObject(c,d);b.reset||"scale"!==b.currentAction||this._resetCurrentTransform();b.currentAction="scaleEqually";return this._scaleObject(c,d,"equally")},_isUniscalePossible:function(a,b){return(a[this.uniScaleKey]||this.uniScaleTransform)&&!b.get("lockUniScaling")},_setCursorFromEvent:function(a,b){if(!b)return this.setCursor(this.defaultCursor),
!1;var c=b.hoverCursor||this.hoverCursor,d=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null;(d=(!d||!d.contains(b))&&b._findTargetCorner(this.getPointer(a,!0)))?this.setCursor(this.getCornerCursor(d,b,a)):(b.subTargetCheck&&this.targets.concat().reverse().map(function(a){c=a.hoverCursor||c}),this.setCursor(c))},getCornerCursor:function(a,b,c){return this.actionIsDisabled(a,b,c)?this.notAllowedCursor:a in e?this._getRotatedCornerCursor(a,b,c):"mtr"===a&&b.hasRotatingPoint?
this.rotationCursor:this.defaultCursor},actionIsDisabled:function(a,b,c){return"mt"===a||"mb"===a?c[this.altActionKey]?b.lockSkewingX:b.lockScalingY:"ml"===a||"mr"===a?c[this.altActionKey]?b.lockSkewingY:b.lockScalingX:"mtr"===a?b.lockRotation:this._isUniscalePossible(c,b)?b.lockScalingX&&b.lockScalingY:b.lockScalingX||b.lockScalingY},_getRotatedCornerCursor:function(a,b,c){b=Math.round(b.angle%360/45);0>b&&(b+=8);b+=e[a];c[this.altActionKey]&&0===e[a]%2&&(b+=2);return this.cursorMap[b%8]}})})();
(function(){var e=Math.min,c=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(c,b){var a=this._activeObject;return a&&this._isSelectionKeyPressed(c)&&b&&b.selectable&&this.selection&&(a!==b||"activeSelection"===a.type)&&!b.onSelect({e:c})},_handleGrouping:function(c,b){var a=this._activeObject;if(!a.__corner){if(b===a&&(b=this.findTarget(c,!0),!b||!b.selectable))return;a&&"activeSelection"===a.type?this._updateActiveSelection(b,c):this._createActiveSelection(b,c)}},
_updateActiveSelection:function(c,b){var a=this._activeObject,g=a._objects.slice(0);a.contains(c)?(a.removeWithUpdate(c),this._hoveredTarget=c,this._hoveredTargets=this.targets.concat(),1===a.size()&&this._setActiveObject(a.item(0),b)):(a.addWithUpdate(c),this._hoveredTarget=a,this._hoveredTargets=this.targets.concat());this._fireSelectionEvents(g,b)},_createActiveSelection:function(c,b){var a=this.getActiveObjects();this._hoveredTarget=c=this._createGroup(c);this._setActiveObject(c,b);this._fireSelectionEvents(a,
b)},_createGroup:function(c){var b=this._objects;c=b.indexOf(this._activeObject)<b.indexOf(c)?[this._activeObject,c]:[c,this._activeObject];this._activeObject.isEditing&&this._activeObject.exitEditing();return new fabric.ActiveSelection(c,{canvas:this})},_groupSelectedObjects:function(c){var b=this._collectObjects(c);1===b.length?this.setActiveObject(b[0],c):1<b.length&&(b=new fabric.ActiveSelection(b.reverse(),{canvas:this}),this.setActiveObject(b,c))},_collectObjects:function(f){var b=[];var a=
this._groupSelector.ex;var g=this._groupSelector.ey,l=a+this._groupSelector.left,d=g+this._groupSelector.top,k=new fabric.Point(e(a,l),e(g,d)),h=new fabric.Point(c(a,l),c(g,d)),m=!this.selectionFullyContained;g=a===l&&g===d;for(l=this._objects.length;l--&&!((a=this._objects[l])&&a.selectable&&a.visible&&(m&&a.intersectsWithRect(k,h)||a.isContainedWithinRect(k,h)||m&&a.containsPoint(k)||m&&a.containsPoint(h))&&(b.push(a),g)););1<b.length&&(b=b.filter(function(a){return!a.onSelect({e:f})}));return b},
_maybeGroupObjects:function(c){this.selection&&this._groupSelector&&this._groupSelectedObjects(c);this.setCursor(this.defaultCursor);this._groupSelector=null}})})();
(function(){fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(e){e||(e={});var c=e.format||"png",f=e.quality||1,b=(e.multiplier||1)*(e.enableRetinaScaling?this.getRetinaScaling():1);e=this.toCanvasElement(b,e);return fabric.util.toDataURL(e,c,f)},toCanvasElement:function(e,c){e=e||1;c=c||{};var f=(c.width||this.width)*e,b=(c.height||this.height)*e,a=this.getZoom(),g=this.width,l=this.height,d=a*e;a=this.viewportTransform;var k=this.interactive;e=[d,0,0,d,(a[4]-(c.left||0))*
e,(a[5]-(c.top||0))*e];c=this.enableRetinaScaling;d=fabric.util.createCanvasElement();var h=this.contextTop;d.width=f;d.height=b;this.contextTop=null;this.interactive=this.enableRetinaScaling=!1;this.viewportTransform=e;this.width=f;this.height=b;this.calcViewportBoundaries();this.renderCanvas(d.getContext("2d"),this._objects);this.viewportTransform=a;this.width=g;this.height=l;this.calcViewportBoundaries();this.interactive=k;this.enableRetinaScaling=c;this.contextTop=h;return d}})})();
fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(e,c,f){return this.loadFromJSON(e,c,f)},loadFromJSON:function(e,c,f){if(e){var b="string"===typeof e?JSON.parse(e):fabric.util.object.clone(e),a=this,g=b.clipPath,l=this.renderOnAddRemove;this.renderOnAddRemove=!1;delete b.clipPath;this._enlivenObjects(b.objects,function(d){a.clear();a._setBgOverlay(b,function(){g?a._enlivenObjects([g],function(g){a.clipPath=g[0];a.__setupCanvas.call(a,b,d,l,c)}):a.__setupCanvas.call(a,
b,d,l,c)})},f);return this}},__setupCanvas:function(e,c,f,b){var a=this;c.forEach(function(b,c){a.insertAt(b,c)});this.renderOnAddRemove=f;delete e.objects;delete e.backgroundImage;delete e.overlayImage;delete e.background;delete e.overlay;this._setOptions(e);this.renderAll();b&&b()},_setBgOverlay:function(e,c){var f={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(e.backgroundImage||e.overlayImage||e.background||e.overlay){var b=function(){f.backgroundImage&&f.overlayImage&&
f.backgroundColor&&f.overlayColor&&c&&c()};this.__setBgOverlay("backgroundImage",e.backgroundImage,f,b);this.__setBgOverlay("overlayImage",e.overlayImage,f,b);this.__setBgOverlay("backgroundColor",e.background,f,b);this.__setBgOverlay("overlayColor",e.overlay,f,b)}else c&&c()},__setBgOverlay:function(e,c,f,b){var a=this;if(c)if("backgroundImage"===e||"overlayImage"===e)fabric.util.enlivenObjects([c],function(c){a[e]=c[0];f[e]=!0;b&&b()});else this["set"+fabric.util.string.capitalize(e,!0)](c,function(){f[e]=
!0;b&&b()});else f[e]=!0,b&&b()},_enlivenObjects:function(e,c,f){e&&0!==e.length?fabric.util.enlivenObjects(e,function(b){c&&c(b)},null,f):c&&c([])},_toDataURL:function(e,c){this.clone(function(f){c(f.toDataURL(e))})},_toDataURLWithMultiplier:function(e,c,f){this.clone(function(b){f(b.toDataURLWithMultiplier(e,c))})},clone:function(e,c){var f=JSON.stringify(this.toJSON(c));this.cloneWithoutData(function(b){b.loadFromJSON(f,function(){e&&e(b)})})},cloneWithoutData:function(e){var c=fabric.util.createCanvasElement();
c.width=this.width;c.height=this.height;var f=new fabric.Canvas(c);f.clipTo=this.clipTo;this.backgroundImage?(f.setBackgroundImage(this.backgroundImage.src,function(){f.renderAll();e&&e(f)}),f.backgroundImageOpacity=this.backgroundImageOpacity,f.backgroundImageStretch=this.backgroundImageStretch):e&&e(f)}});
(function(e){var c=e.fabric||(e.fabric={});e=c.util.object.extend;var f=c.util.object.clone,b=c.util.toFixed,a=c.util.string.capitalize,g=c.util.degreesToRadians,l=c.StaticCanvas.supports("setLineDash");c.Object||(c.Object=c.util.createClass(c.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",
borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0,
selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:!c.isLikelyNode,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),
cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(a){a&&this.setOptions(a)},_createCacheCanvas:function(){this._cacheProperties={};this._cacheCanvas=c.util.createCanvasElement();this._cacheContext=this._cacheCanvas.getContext("2d");this._updateCacheCanvas();this.dirty=!0},_limitCacheSize:function(a){var b=
c.perfLimitSizeTotal,d=a.width,g=a.height,f=c.maxCacheSideLimit,e=c.minCacheSideLimit;if(d<=f&&g<=f&&d*g<=b)return d<e&&(a.width=e),g<e&&(a.height=e),a;var l=c.util.limitDimsByArea(d/g,b),t=c.util.capValue;b=t(e,l.x,f);f=t(e,l.y,f);d>b&&(a.zoomX/=d/b,a.width=b,a.capped=!0);g>f&&(a.zoomY/=g/f,a.height=f,a.capped=!0);return a},_getCacheCanvasDimensions:function(){var a=this.getTotalObjectScaling(),b=this._getTransformedDimensions(0,0),c=b.x*a.scaleX/this.scaleX;b=b.y*a.scaleY/this.scaleY;return{width:c+
2,height:b+2,zoomX:a.scaleX,zoomY:a.scaleY,x:c,y:b}},_updateCacheCanvas:function(){var a=this.canvas;if(this.noScaleCache&&a&&a._currentTransform){var b=a._currentTransform.action;if(this===a._currentTransform.target&&b.slice&&"scale"===b.slice(0,5))return!1}a=this._cacheCanvas;var g=this._limitCacheSize(this._getCacheCanvasDimensions()),f=c.minCacheSideLimit;b=g.width;var e=g.height,l=g.zoomX,x=g.zoomY,t=b!==this.cacheWidth||e!==this.cacheHeight,C=this.zoomX!==l||this.zoomY!==x,B=0,v=0,r=!1;if(t){r=
this._cacheCanvas.width;var w=this._cacheCanvas.height,y=b>r||e>w;r=y||(b<.9*r||e<.9*w)&&r>f&&w>f;y&&!g.capped&&(b>f||e>f)&&(B=.1*b,v=.1*e)}return t||C?(r?(a.width=Math.ceil(b+B),a.height=Math.ceil(e+v)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,a.width,a.height)),f=g.x/2,g=g.y/2,this.cacheTranslationX=Math.round(a.width/2-f)+f,this.cacheTranslationY=Math.round(a.height/2-g)+g,this.cacheWidth=b,this.cacheHeight=e,this._cacheContext.translate(this.cacheTranslationX,
this.cacheTranslationY),this._cacheContext.scale(l,x),this.zoomX=l,this.zoomY=x,!0):!1},setOptions:function(a){this._setOptions(a);this._initGradient(a.fill,"fill");this._initGradient(a.stroke,"stroke");this._initClipping(a);this._initPattern(a.fill,"fill");this._initPattern(a.stroke,"stroke")},transform:function(a){var b=this.group&&!this.group._transformDone?this.calcTransformMatrix():this.calcOwnMatrix();a.transform(b[0],b[1],b[2],b[3],b[4],b[5])},toObject:function(a){var d=c.Object.NUM_FRACTION_DIGITS;
d={type:this.type,version:c.version,originX:this.originX,originY:this.originY,left:b(this.left,d),top:b(this.top,d),width:b(this.width,d),height:b(this.height,d),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:b(this.strokeWidth,d),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,
strokeMiterLimit:b(this.strokeMiterLimit,d),scaleX:b(this.scaleX,d),scaleY:b(this.scaleY,d),angle:b(this.angle,d),flipX:this.flipX,flipY:this.flipY,opacity:b(this.opacity,d),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():
null,skewX:b(this.skewX,d),skewY:b(this.skewY,d)};this.clipPath&&(d.clipPath=this.clipPath.toObject(a),d.clipPath.inverted=this.clipPath.inverted,d.clipPath.absolutePositioned=this.clipPath.absolutePositioned);c.util.populateWithProperties(this,d,a);this.includeDefaultValues||(d=this._removeDefaultValues(d));return d},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(a){var b=c.util.getKlass(a.type).prototype;b.stateProperties.forEach(function(c){"left"!==c&&"top"!==
c&&(a[c]===b[c]&&delete a[c],"[object Array]"===Object.prototype.toString.call(a[c])&&"[object Array]"===Object.prototype.toString.call(b[c])&&0===a[c].length&&0===b[c].length&&delete a[c])});return a},toString:function(){return"#<fabric."+a(this.type)+">"},getObjectScaling:function(){var a=c.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(a.scaleX),scaleY:Math.abs(a.scaleY)}},getTotalObjectScaling:function(){var a=this.getObjectScaling(),b=a.scaleX;a=a.scaleY;if(this.canvas){var c=
this.canvas.getZoom(),g=this.canvas.getRetinaScaling();b*=c*g;a*=c*g}return{scaleX:b,scaleY:a}},getObjectOpacity:function(){var a=this.opacity;this.group&&(a*=this.group.getObjectOpacity());return a},_set:function(a,b){var d=this[a]!==b;if("scaleX"===a||"scaleY"===a)b=this._constrainScale(b);"scaleX"===a&&0>b?(this.flipX=!this.flipX,b*=-1):"scaleY"===a&&0>b?(this.flipY=!this.flipY,b*=-1):"shadow"!==a||!b||b instanceof c.Shadow?"dirty"===a&&this.group&&this.group.set("dirty",b):b=new c.Shadow(b);this[a]=
b;d&&(b=this.group&&this.group.isOnACache(),-1<this.cacheProperties.indexOf(a)?(this.dirty=!0,b&&this.group.set("dirty",!0)):b&&-1<this.stateProperties.indexOf(a)&&this.group.set("dirty",!0));return this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:c.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||0===this.width&&0===this.height&&0===this.strokeWidth||!this.visible},render:function(a){this.isNotVisible()||
this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(a.save(),this._setupCompositeOperation(a),this.drawSelectionBackground(a),this.transform(a),this._setOpacity(a),this._setShadow(a,this),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(a)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(a),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),a.restore())},
renderCache:function(a){a=a||{};this._cacheCanvas||this._createCacheCanvas();this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,a.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null;this.cacheHeight=this.cacheWidth=0},hasStroke:function(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth},hasFill:function(){return this.fill&&"transparent"!==this.fill},needsItsOwnCache:function(){return"stroke"===
this.paintFirst&&this.hasFill()&&this.hasStroke()&&"object"===typeof this.shadow||this.clipPath?!0:!1},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache())},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(a){var b=this.clipPath;a.save();a.globalCompositeOperation=b.inverted?"destination-out":"destination-in";if(b.absolutePositioned){var d=c.util.invertTransform(this.calcTransformMatrix());
a.transform(d[0],d[1],d[2],d[3],d[4],d[5])}b.transform(a);a.scale(1/b.zoomX,1/b.zoomY);a.drawImage(b._cacheCanvas,-b.cacheTranslationX,-b.cacheTranslationY);a.restore()},drawObject:function(a,b){var c=this.fill,d=this.stroke;b?(this.fill="black",this.stroke="",this._setClippingProperties(a)):(this._renderBackground(a),this._setStrokeStyles(a,this),this._setFillStyles(a,this));this._render(a);this._drawClipPath(a);this.fill=c;this.stroke=d},_drawClipPath:function(a){var b=this.clipPath;b&&(b.canvas=
this.canvas,b.shouldCache(),b._transformDone=!0,b.renderCache({forClipping:!0}),this.drawClipPathOnCache(a))},drawCacheOnCanvas:function(a){a.scale(1/this.zoomX,1/this.zoomY);a.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(a){if(this.isNotVisible())return!1;if(this._cacheCanvas&&!a&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&
!a){a=this.cacheWidth/this.zoomX;var b=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-a/2,-b/2,a,b)}return!0}return!1},_renderBackground:function(a){if(this.backgroundColor){var b=this._getNonTransformedDimensions();a.fillStyle=this.backgroundColor;a.fillRect(-b.x/2,-b.y/2,b.x,b.y);this._removeShadow(a)}},_setOpacity:function(a){a.globalAlpha=this.group&&!this.group._transformDone?this.getObjectOpacity():a.globalAlpha*this.opacity},_setStrokeStyles:function(a,b){b.stroke&&(a.lineWidth=
b.strokeWidth,a.lineCap=b.strokeLineCap,a.lineDashOffset=b.strokeDashOffset,a.lineJoin=b.strokeLineJoin,a.miterLimit=b.strokeMiterLimit,a.strokeStyle=b.stroke.toLive?b.stroke.toLive(a,this):b.stroke)},_setFillStyles:function(a,b){b.fill&&(a.fillStyle=b.fill.toLive?b.fill.toLive(a,this):b.fill)},_setClippingProperties:function(a){a.globalAlpha=1;a.strokeStyle="transparent";a.fillStyle="#000000"},_setLineDash:function(a,b,c){b&&0!==b.length&&(1&b.length&&b.push.apply(b,b),l?a.setLineDash(b):c&&c(a))},
_renderControls:function(a,b){var d=this.getViewportTransform(),f=this.calcTransformMatrix();b=b||{};var e="undefined"!==typeof b.hasBorders?b.hasBorders:this.hasBorders;var l="undefined"!==typeof b.hasControls?b.hasControls:this.hasControls;f=c.util.multiplyTransformMatrices(d,f);d=c.util.qrDecompose(f);a.save();a.translate(d.translateX,d.translateY);a.lineWidth=1*this.borderScaleFactor;this.group||(a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1);b.forActiveSelection?(a.rotate(g(d.angle)),
e&&this.drawBordersInGroup(a,d,b)):(a.rotate(g(this.angle)),e&&this.drawBorders(a,b));l&&this.drawControls(a,b);a.restore()},_setShadow:function(a){if(this.shadow){var b=this.shadow,d=this.canvas,g=d&&d.viewportTransform[0]||1,f=d&&d.viewportTransform[3]||1;var e=b.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling();d&&d._isRetinaScaling()&&(g*=c.devicePixelRatio,f*=c.devicePixelRatio);a.shadowColor=b.color;a.shadowBlur=b.blur*c.browserShadowBlurConstant*(g+f)*(e.scaleX+e.scaleY)/4;a.shadowOffsetX=
b.offsetX*g*e.scaleX;a.shadowOffsetY=b.offsetY*f*e.scaleY}},_removeShadow:function(a){this.shadow&&(a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0)},_applyPatternGradientTransform:function(a,b){if(!b||!b.toLive)return{offsetX:0,offsetY:0};var c=b.gradientTransform||b.patternTransform,d=-this.width/2+b.offsetX||0,g=-this.height/2+b.offsetY||0;"percentage"===b.gradientUnits?a.transform(this.width,0,0,this.height,d,g):a.transform(1,0,0,1,d,g);c&&a.transform(c[0],c[1],c[2],c[3],c[4],
c[5]);return{offsetX:d,offsetY:g}},_renderPaintInOrder:function(a){"stroke"===this.paintFirst?(this._renderStroke(a),this._renderFill(a)):(this._renderFill(a),this._renderStroke(a))},_render:function(){},_renderFill:function(a){this.fill&&(a.save(),this._applyPatternGradientTransform(a,this.fill),"evenodd"===this.fillRule?a.fill("evenodd"):a.fill(),a.restore())},_renderStroke:function(a){if(this.stroke&&0!==this.strokeWidth){this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a);a.save();if(this.strokeUniform&&
this.group){var b=this.getObjectScaling();a.scale(1/b.scaleX,1/b.scaleY)}else this.strokeUniform&&a.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(a,this.strokeDashArray,this._renderDashedStroke);this.stroke.toLive&&"percentage"===this.stroke.gradientUnits?this._applyPatternForTransformedGradient(a,this.stroke):this._applyPatternGradientTransform(a,this.stroke);a.stroke();a.restore()}},_applyPatternForTransformedGradient:function(a,b){var d=this._limitCacheSize(this._getCacheCanvasDimensions()),
g=c.util.createCanvasElement(),f=this.canvas.getRetinaScaling(),e=d.x/this.scaleX/f,l=d.y/this.scaleY/f;g.width=e;g.height=l;var k=g.getContext("2d");k.beginPath();k.moveTo(0,0);k.lineTo(e,0);k.lineTo(e,l);k.lineTo(0,l);k.closePath();k.translate(e/2,l/2);k.scale(d.zoomX/this.scaleX/f,d.zoomY/this.scaleY/f);this._applyPatternGradientTransform(k,b);k.fillStyle=b.toLive(a);k.fill();a.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2);a.scale(f*this.scaleX/d.zoomX,f*this.scaleY/
d.zoomY);a.strokeStyle=k.createPattern(g,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var a=c.util.qrDecompose(this.transformMatrix);this.flipY=this.flipX=!1;this.set("scaleX",a.scaleX);this.set("scaleY",a.scaleY);this.angle=a.angle;this.skewX=a.skewX;this.skewY=0}},_removeTransformMatrix:function(a){var b=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),
b=c.util.transformPoint(b,this.transformMatrix));this.transformMatrix=null;a&&(this.scaleX*=a.scaleX,this.scaleY*=a.scaleY,this.cropX=a.cropX,this.cropY=a.cropY,b.x+=a.offsetLeft,b.y+=a.offsetTop,this.width=a.width,this.height=a.height);this.setPositionByOrigin(b,"center","center")},clone:function(a,b){b=this.toObject(b);this.constructor.fromObject?this.constructor.fromObject(b,a):c.Object._fromObject("Object",b,a)},cloneAsImage:function(a,b){b=this.toCanvasElement(b);a&&a(new c.Image(b));return this},
toCanvasElement:function(a){a||(a={});var b=c.util,d=b.saveObjectTransform(this),g=this.group,f=this.shadow,e=Math.abs,l=(a.multiplier||1)*(a.enableRetinaScaling?c.devicePixelRatio:1);delete this.group;a.withoutTransform&&b.resetObjectTransform(this);a.withoutShadow&&(this.shadow=null);b=c.util.createCanvasElement();var t=this.getBoundingRect(!0,!0),C=this.shadow,B=0;var v=0;if(C){var r=C.blur;v=C.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling();B=2*Math.round(e(C.offsetX)+r)*e(v.scaleX);v=
2*Math.round(e(C.offsetY)+r)*e(v.scaleY)}e=t.width+B;t=t.height+v;b.width=Math.ceil(e);b.height=Math.ceil(t);b=new c.StaticCanvas(b,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===a.format&&(b.backgroundColor="#fff");this.setPositionByOrigin(new c.Point(b.width/2,b.height/2),"center","center");e=this.canvas;b.add(this);a=b.toCanvasElement(l||1,a);this.shadow=f;this.set("canvas",e);g&&(this.group=g);this.set(d).setCoords();b._objects=[];b.dispose();return a},toDataURL:function(a){a||
(a={});return c.util.toDataURL(this.toCanvasElement(a),a.format||"png",a.quality||1)},isType:function(a){return this.type===a},complexity:function(){return 1},toJSON:function(a){return this.toObject(a)},setGradient:function(a,b){b||(b={});var d={colorStops:[]};d.type=b.type||(b.r1||b.r2?"radial":"linear");d.coords={x1:b.x1,y1:b.y1,x2:b.x2,y2:b.y2};d.gradientUnits=b.gradientUnits||"pixels";if(b.r1||b.r2)d.coords.r1=b.r1,d.coords.r2=b.r2;d.gradientTransform=b.gradientTransform;c.Gradient.prototype.addColorStop.call(d,
b.colorStops);return this.set(a,c.Gradient.forObject(this,d))},setPatternFill:function(a,b){return this.set("fill",new c.Pattern(a,b))},setShadow:function(a){return this.set("shadow",a?new c.Shadow(a):null)},setColor:function(a){this.set("fill",a);return this},rotate:function(a){var b=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;b&&this._setOriginToCenter();this.set("angle",a);b&&this._resetOrigin();return this},centerH:function(){this.canvas&&this.canvas.centerObjectH(this);
return this},viewportCenterH:function(){this.canvas&&this.canvas.viewportCenterObjectH(this);return this},centerV:function(){this.canvas&&this.canvas.centerObjectV(this);return this},viewportCenterV:function(){this.canvas&&this.canvas.viewportCenterObjectV(this);return this},center:function(){this.canvas&&this.canvas.centerObject(this);return this},viewportCenter:function(){this.canvas&&this.canvas.viewportCenterObject(this);return this},getLocalPointer:function(a,b){b=b||this.canvas.getPointer(a);
a=new c.Point(b.x,b.y);b=this._getLeftTopCoords();this.angle&&(a=c.util.rotatePoint(a,b,g(-this.angle)));return{x:a.x-b.x,y:a.y-b.y}},_setupCompositeOperation:function(a){this.globalCompositeOperation&&(a.globalCompositeOperation=this.globalCompositeOperation)}}),c.util.createAccessors&&c.util.createAccessors(c.Object),e(c.Object.prototype,c.Observable),c.Object.NUM_FRACTION_DIGITS=2,c.Object._fromObject=function(a,b,g,e){var d=c[a];b=f(b,!0);c.util.enlivenPatterns([b.fill,b.stroke],function(a){"undefined"!==
typeof a[0]&&(b.fill=a[0]);"undefined"!==typeof a[1]&&(b.stroke=a[1]);c.util.enlivenObjects([b.clipPath],function(a){b.clipPath=a[0];a=e?new d(b[e],b):new d(b);g&&g(a)})})},c.Object.__uid=0)})("undefined"!==typeof exports?exports:this);
(function(){var e=fabric.util.degreesToRadians,c={left:-.5,center:0,right:.5},f={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(b,a,g,e,d){var l=b.x,h=b.y;a="string"===typeof a?c[a]:a-.5;e="string"===typeof e?c[e]:e-.5;a=e-a;g="string"===typeof g?f[g]:g-.5;d="string"===typeof d?f[d]:d-.5;g=d-g;if(a||g)h=this._getTransformedDimensions(),l=b.x+a*h.x,h=b.y+g*h.y;return new fabric.Point(l,h)},translateToCenterPoint:function(b,a,c){a=this.translateToGivenOrigin(b,
a,c,"center","center");return this.angle?fabric.util.rotatePoint(a,b,e(this.angle)):a},translateToOriginPoint:function(b,a,c){a=this.translateToGivenOrigin(b,"center","center",a,c);return this.angle?fabric.util.rotatePoint(a,b,e(this.angle)):a},getCenterPoint:function(){var b=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(b,this.originX,this.originY)},getPointByOrigin:function(b,a){var c=this.getCenterPoint();return this.translateToOriginPoint(c,b,a)},toLocalPoint:function(b,
a,c){var g=this.getCenterPoint();a="undefined"!==typeof a&&"undefined"!==typeof c?this.translateToGivenOrigin(g,"center","center",a,c):new fabric.Point(this.left,this.top);b=new fabric.Point(b.x,b.y);this.angle&&(b=fabric.util.rotatePoint(b,g,-e(this.angle)));return b.subtractEquals(a)},setPositionByOrigin:function(b,a,c){b=this.translateToCenterPoint(b,a,c);b=this.translateToOriginPoint(b,this.originX,this.originY);this.set("left",b.x);this.set("top",b.y)},adjustPosition:function(b){var a=e(this.angle),
g=this.getScaledWidth(),f=fabric.util.cos(a)*g;a=fabric.util.sin(a)*g;g="string"===typeof this.originX?c[this.originX]:this.originX-.5;var d="string"===typeof b?c[b]:b-.5;this.left+=f*(d-g);this.top+=a*(d-g);this.setCoords();this.originX=b},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var b=this.getCenterPoint();this.originY=this.originX="center";this.left=b.x;this.top=b.y},_resetOrigin:function(){var b=this.translateToOriginPoint(this.getCenterPoint(),
this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=b.x;this.top=b.y;this._originalOriginY=this._originalOriginX=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})})();
(function(){var e=fabric.util.degreesToRadians,c=fabric.util.multiplyTransformMatrices,f=fabric.util.transformPoint;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,aCoords:null,ownMatrixCache:null,matrixCache:null,getCoords:function(b,a){this.oCoords||this.setCoords();var c=b?this.aCoords:this.oCoords;b=a?this.calcCoords(b):c;return[new fabric.Point(b.tl.x,b.tl.y),new fabric.Point(b.tr.x,b.tr.y),new fabric.Point(b.br.x,b.br.y),new fabric.Point(b.bl.x,b.bl.y)]},intersectsWithRect:function(b,
a,c,f){c=this.getCoords(c,f);return"Intersection"===fabric.Intersection.intersectPolygonRectangle(c,b,a).status},intersectsWithObject:function(b,a,c){return"Intersection"===fabric.Intersection.intersectPolygonPolygon(this.getCoords(a,c),b.getCoords(a,c)).status||b.isContainedWithinObject(this,a,c)||this.isContainedWithinObject(b,a,c)},isContainedWithinObject:function(b,a,c){var g=this.getCoords(a,c),d=0;for(a=b._getImageLines(c?b.calcCoords(a):a?b.aCoords:b.oCoords);4>d;d++)if(!b.containsPoint(g[d],
a))return!1;return!0},isContainedWithinRect:function(b,a,c,f){c=this.getBoundingRect(c,f);return c.left>=b.x&&c.left+c.width<=a.x&&c.top>=b.y&&c.top+c.height<=a.y},containsPoint:function(b,a,c,f){a=a||this._getImageLines(f?this.calcCoords(c):c?this.aCoords:this.oCoords);b=this._findCrossPoints(b,a);return 0!==b&&1===b%2},isOnScreen:function(b){if(!this.canvas)return!1;for(var a=this.canvas.vptCoords.tl,c=this.canvas.vptCoords.br,f=this.getCoords(!0,b),d,e=0;4>e;e++)if(d=f[e],d.x<=c.x&&d.x>=a.x&&d.y<=
c.y&&d.y>=a.y)return!0;return this.intersectsWithRect(a,c,!0,b)?!0:this._containsCenterOfCanvas(a,c,b)},_containsCenterOfCanvas:function(b,a,c){return this.containsPoint({x:(b.x+a.x)/2,y:(b.y+a.y)/2},null,!0,c)?!0:!1},isPartiallyOnScreen:function(b){if(!this.canvas)return!1;var a=this.canvas.vptCoords.tl,c=this.canvas.vptCoords.br;return this.intersectsWithRect(a,c,!0,b)?!0:this._containsCenterOfCanvas(a,c,b)},_getImageLines:function(b){return{topline:{o:b.tl,d:b.tr},rightline:{o:b.tr,d:b.br},bottomline:{o:b.br,
d:b.bl},leftline:{o:b.bl,d:b.tl}}},_findCrossPoints:function(b,a){var c=0,f;for(f in a){var d=a[f];if(!(d.o.y<b.y&&d.d.y<b.y||d.o.y>=b.y&&d.d.y>=b.y)){if(d.o.x===d.d.x&&d.o.x>=b.x)var e=d.o.x;else{e=(d.d.y-d.o.y)/(d.d.x-d.o.x);var h=b.y-0*b.x;d=d.o.y-e*d.o.x;e=-(h-d)/(0-e)}e>=b.x&&(c+=1);if(2===c)break}}return c},getBoundingRect:function(b,a){b=this.getCoords(b,a);return fabric.util.makeBoundingBoxFromPoints(b)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},
_constrainScale:function(b){return Math.abs(b)<this.minScaleLimit?0>b?-this.minScaleLimit:this.minScaleLimit:0===b?1E-4:b},scale:function(b){this._set("scaleX",b);this._set("scaleY",b);return this.setCoords()},scaleToWidth:function(b,a){a=this.getBoundingRect(a).width/this.getScaledWidth();return this.scale(b/this.width/a)},scaleToHeight:function(b,a){a=this.getBoundingRect(a).height/this.getScaledHeight();return this.scale(b/this.height/a)},calcCoords:function(b){var a=this._calcRotateMatrix(),g=
this._calcTranslateMatrix();a=c(g,a);g=this.getViewportTransform();var l=b?a:c(g,a);a=this._getTransformedDimensions();var d=a.x/2,k=a.y/2;a=f({x:-d,y:-k},l);g=f({x:d,y:-k},l);var h=f({x:-d,y:k},l);l=f({x:d,y:k},l);if(!b){var m=this.padding,q=e(this.angle),n=fabric.util.cos(q);d=fabric.util.sin(q);var x=n*m,t=d*m;q=x+t;x-=t;m&&(a.x-=x,a.y-=q,g.x+=q,g.y-=x,h.x-=q,h.y+=x,l.x+=x,l.y+=q);m=new fabric.Point((a.x+h.x)/2,(a.y+h.y)/2);q=new fabric.Point((g.x+a.x)/2,(g.y+a.y)/2);x=new fabric.Point((l.x+g.x)/
2,(l.y+g.y)/2);t=new fabric.Point((l.x+h.x)/2,(l.y+h.y)/2);n=new fabric.Point(q.x+d*this.rotatingPointOffset,q.y-n*this.rotatingPointOffset)}a={tl:a,tr:g,br:l,bl:h};b||(a.ml=m,a.mt=q,a.mr=x,a.mb=t,a.mtr=n);return a},setCoords:function(b,a){this.oCoords=this.calcCoords(b);a||(this.aCoords=this.calcCoords(!0));b||this._setCornerCoords&&this._setCornerCoords();return this},_calcRotateMatrix:function(){return fabric.util.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var b=this.getCenterPoint();
return[1,0,0,1,b.x,b.y]},transformMatrixKey:function(b){var a="";!b&&this.group&&(a=this.group.transformMatrixKey(b)+"_");return a+this.top+"_"+this.left+"_"+this.scaleX+"_"+this.scaleY+"_"+this.skewX+"_"+this.skewY+"_"+this.angle+"_"+this.originX+"_"+this.originY+"_"+this.width+"_"+this.height+"_"+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(b){if(b)return this.calcOwnMatrix();b=this.transformMatrixKey();var a=this.matrixCache||(this.matrixCache={});if(a.key===b)return a.value;
var g=this.calcOwnMatrix();this.group&&(g=c(this.group.calcTransformMatrix(),g));a.key=b;return a.value=g},calcOwnMatrix:function(){var b=this.transformMatrixKey(!0),a=this.ownMatrixCache||(this.ownMatrixCache={});if(a.key===b)return a.value;var c=this._calcTranslateMatrix();this.translateX=c[4];this.translateY=c[5];a.key=b;a.value=fabric.util.composeMatrix(this);return a.value},_calcDimensionsTransformMatrix:function(b,a,c){return fabric.util.calcDimensionsMatrix({skewX:b,skewY:a,scaleX:this.scaleX*
(c&&this.flipX?-1:1),scaleY:this.scaleY*(c&&this.flipY?-1:1)})},_getNonTransformedDimensions:function(){var b=this.strokeWidth;return{x:this.width+b,y:this.height+b}},_getTransformedDimensions:function(b,a){"undefined"===typeof b&&(b=this.skewX);"undefined"===typeof a&&(a=this.skewY);var c=this._getNonTransformedDimensions();if(this.strokeUniform){var f=this.width;c=this.height}else f=c.x,c=c.y;if(0===b&&0===a)return this._finalizeDimensions(f*this.scaleX,c*this.scaleY);f/=2;c/=2;f=[{x:-f,y:-c},{x:f,
y:-c},{x:-f,y:c},{x:f,y:c}];b=fabric.util.calcDimensionsMatrix({scaleX:this.scaleX,scaleY:this.scaleY,skewX:b,skewY:a});b=fabric.util.makeBoundingBoxFromPoints(f,b);return this._finalizeDimensions(b.width,b.height)},_finalizeDimensions:function(b,a){return this.strokeUniform?{x:b+this.strokeWidth,y:a+this.strokeWidth}:{x:b,y:a}},_calculateCurrentDimensions:function(){var b=this.getViewportTransform(),a=this._getTransformedDimensions();return fabric.util.transformPoint(a,b,!0).scalarAdd(2*this.padding)}})})();
fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this);return this},bringToFront:function(){this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this);return this},sendBackwards:function(e){this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,e):this.canvas&&this.canvas.sendBackwards(this,
e);return this},bringForward:function(e){this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,e):this.canvas&&this.canvas.bringForward(this,e);return this},moveTo:function(e){this.group&&"activeSelection"!==this.group.type?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,e):this.canvas&&this.canvas.moveTo(this,e);return this}});
(function(){function e(c,b){if(b){if(b.toLive)return c+": url(#SVGID_"+b.id+"); ";var a=new fabric.Color(b);b=c+": "+a.toRgb()+"; ";a=a.getAlpha();1!==a&&(b+=c+"-opacity: "+a.toString()+"; ");return b}return c+": none; "}var c=fabric.util.toFixed;fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(c){var b=this.fillRule?this.fillRule:"nonzero",a=this.strokeWidth?this.strokeWidth:"0",g=this.strokeDashArray?this.strokeDashArray.join(" "):"none",f=this.strokeDashOffset?this.strokeDashOffset:
"0",d=this.strokeLineCap?this.strokeLineCap:"butt",k=this.strokeLineJoin?this.strokeLineJoin:"miter",h=this.strokeMiterLimit?this.strokeMiterLimit:"4",m="undefined"!==typeof this.opacity?this.opacity:"1",q=this.visible?"":" visibility: hidden;";c=c?"":this.getSvgFilter();var n=e("fill",this.fill);return[e("stroke",this.stroke),"stroke-width: ",a,"; stroke-dasharray: ",g,"; stroke-linecap: ",d,"; stroke-dashoffset: ",f,"; stroke-linejoin: ",k,"; stroke-miterlimit: ",h,"; ",n,"fill-rule: ",b,"; opacity: ",
m,";",c,q].join("")},getSvgSpanStyles:function(c,b){var a=c.fontFamily?"font-family: "+(-1===c.fontFamily.indexOf("'")&&-1===c.fontFamily.indexOf('"')?"'"+c.fontFamily+"'":c.fontFamily)+"; ":"",g=c.strokeWidth?"stroke-width: "+c.strokeWidth+"; ":"",f=c.fontSize?"font-size: "+c.fontSize+"px; ":"",d=c.fontStyle?"font-style: "+c.fontStyle+"; ":"",k=c.fontWeight?"font-weight: "+c.fontWeight+"; ":"",h=c.fill?e("fill",c.fill):"",m=c.stroke?e("stroke",c.stroke):"",q=this.getSvgTextDecoration(c);c=c.deltaY?
"baseline-shift: "+-c.deltaY+"; ":"";q&&(q="text-decoration: "+q+"; ");return[m,g,a,f,d,k,q,h,c,b?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(c){return["overline","underline","line-through"].filter(function(b){return c[b.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},
getSvgTransform:function(c,b){c=c?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+fabric.util.matrixToSVG(c)+(b||"")+this.getSvgTransformMatrix()+'" '},getSvgTransformMatrix:function(){return this.transformMatrix?" "+fabric.util.matrixToSVG(this.transformMatrix):""},_setSVGBg:function(f){if(this.backgroundColor){var b=fabric.Object.NUM_FRACTION_DIGITS;f.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',c(-this.width/2,b),'" y="',c(-this.height/2,b),'" width="',
c(this.width,b),'" height="',c(this.height,b),'"></rect>\n')}},toSVG:function(c){return this._createBaseSVGMarkup(this._toSVG(c),{reviver:c})},toClipPathSVG:function(c){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(c),{reviver:c})},_createBaseClipPathSVGMarkup:function(c,b){b=b||{};var a=b.reviver;b=[this.getSvgTransform(!0,b.additionalTransform||""),this.getSvgCommons()].join("");var g=c.indexOf("COMMON_PARTS");c[g]=b;return a?a(c.join("")):c.join("")},_createBaseSVGMarkup:function(c,
b){b=b||{};var a=b.noStyle,g=b.reviver,f=a?"":'style="'+this.getSvgStyles()+'" ',d=b.withShadow?'style="'+this.getSvgFilter()+'" ':"",e=this.clipPath,h=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",m=e&&e.absolutePositioned,q=this.stroke,n=this.fill,x=this.shadow,t=[],C=c.indexOf("COMMON_PARTS");b=b.additionalTransform;if(e){e.clipPathId="CLIPPATH_"+fabric.Object.__uid++;var B='<clipPath id="'+e.clipPathId+'" >\n'+e.toClipPathSVG(g)+"</clipPath>\n"}m&&t.push("<g ",d,this.getSvgCommons(),
" >\n");t.push("<g ",this.getSvgTransform(!1),m?"":d+this.getSvgCommons()," >\n");a=[f,h,a?"":this.addPaintOrder()," ",b?'transform="'+b+'" ':""].join("");c[C]=a;n&&n.toLive&&t.push(n.toSVG(this));q&&q.toLive&&t.push(q.toSVG(this));x&&t.push(x.toSVG(this));e&&t.push(B);t.push(c.join(""));t.push("</g>\n");m&&t.push("</g>\n");return g?g(t.join("")):t.join("")},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}})})();
(function(){function e(b,a,c){var g={};c.forEach(function(a){g[a]=b[a]});f(b[a],g,!0)}function c(b,a,g){if(b===a)return!0;if(Array.isArray(b)){if(!Array.isArray(a)||b.length!==a.length)return!1;g=0;for(var f=b.length;g<f;g++)if(!c(b[g],a[g]))return!1;return!0}if(b&&"object"===typeof b){var d=Object.keys(b);if(!a||"object"!==typeof a||!g&&d.length!==Object.keys(a).length)return!1;g=0;for(f=d.length;g<f;g++){var e=d[g];if("canvas"!==e&&!c(b[e],a[e]))return!1}return!0}}var f=fabric.util.object.extend;
fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(b){b=b||"stateProperties";var a="_"+b;return Object.keys(this[a]).length<this[b].length?!0:!c(this[a],this,!0)},saveState:function(b){var a=b&&b.propertySet||"stateProperties",c="_"+a;if(!this[c])return this.setupState(b);e(this,c,this[a]);b&&b.stateProperties&&e(this,c,b.stateProperties);return this},setupState:function(b){b=b||{};var a=b.propertySet||"stateProperties";b.propertySet=a;this["_"+a]={};this.saveState(b);return this}})})();
(function(){var e=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(c){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var f=c.x;c=c.y;this.__corner=0;for(var b in this.oCoords)if(this.isControlVisible(b)&&("mtr"!==b||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==b&&"mr"!==b&&"mb"!==b&&"ml"!==b)){var a=this._getImageLines(this.oCoords[b].corner);a=this._findCrossPoints({x:f,
y:c},a);if(0!==a&&1===a%2)return this.__corner=b}return!1},_setCornerCoords:function(){var c=this.oCoords,f=e(45-this.angle),b=.707106*this.cornerSize,a=b*fabric.util.cos(f);f=b*fabric.util.sin(f);var g;for(g in c){b=c[g].x;var l=c[g].y;c[g].corner={tl:{x:b-f,y:l-a},tr:{x:b+a,y:l-f},bl:{x:b-a,y:l+f},br:{x:b+f,y:l+a}}}},drawSelectionBackground:function(c){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;c.save();var f=
this.getCenterPoint(),b=this._calculateCurrentDimensions(),a=this.canvas.viewportTransform;c.translate(f.x,f.y);c.scale(1/a[0],1/a[3]);c.rotate(e(this.angle));c.fillStyle=this.selectionBackgroundColor;c.fillRect(-b.x/2,-b.y/2,b.x,b.y);c.restore();return this},drawBorders:function(c,f){f=f||{};var b=this._calculateCurrentDimensions(),a=this.borderScaleFactor,g=b.x+a;a=b.y+a;var e="undefined"!==typeof f.hasRotatingPoint?f.hasRotatingPoint:this.hasRotatingPoint,d="undefined"!==typeof f.hasControls?f.hasControls:
this.hasControls;b="undefined"!==typeof f.rotatingPointOffset?f.rotatingPointOffset:this.rotatingPointOffset;c.save();c.strokeStyle=f.borderColor||this.borderColor;this._setLineDash(c,f.borderDashArray||this.borderDashArray,null);c.strokeRect(-g/2,-a/2,g,a);e&&this.isControlVisible("mtr")&&d&&(f=-a/2,c.beginPath(),c.moveTo(0,f),c.lineTo(0,f-b),c.stroke());c.restore();return this},drawBordersInGroup:function(c,f,b){b=b||{};var a={x:this.width,y:this.height},g=fabric.util.composeMatrix({scaleX:f.scaleX,
scaleY:f.scaleY,skewX:f.skewX});g=fabric.util.transformPoint(a,g);var e=this.strokeWidth,d=this.borderScaleFactor;a=g.x+e*(this.strokeUniform?this.canvas.getZoom():f.scaleX)+d;f=g.y+e*(this.strokeUniform?this.canvas.getZoom():f.scaleY)+d;c.save();this._setLineDash(c,b.borderDashArray||this.borderDashArray,null);c.strokeStyle=b.borderColor||this.borderColor;c.strokeRect(-a/2,-f/2,a,f);c.restore();return this},drawControls:function(c,f){f=f||{};var b=this._calculateCurrentDimensions(),a=b.x;b=b.y;var g=
f.cornerSize||this.cornerSize,e=-(a+g)/2;g=-(b+g)/2;var d="undefined"!==typeof f.hasRotatingPoint?f.hasRotatingPoint:this.hasRotatingPoint,k=("undefined"!==typeof f.transparentCorners?f.transparentCorners:this.transparentCorners)?"stroke":"fill";c.save();c.strokeStyle=c.fillStyle=f.cornerColor||this.cornerColor;this.transparentCorners||(c.strokeStyle=f.cornerStrokeColor||this.cornerStrokeColor);this._setLineDash(c,f.cornerDashArray||this.cornerDashArray,null);this._drawControl("tl",c,k,e,g,f);this._drawControl("tr",
c,k,e+a,g,f);this._drawControl("bl",c,k,e,g+b,f);this._drawControl("br",c,k,e+a,g+b,f);this.get("lockUniScaling")||(this._drawControl("mt",c,k,e+a/2,g,f),this._drawControl("mb",c,k,e+a/2,g+b,f),this._drawControl("mr",c,k,e+a,g+b/2,f),this._drawControl("ml",c,k,e,g+b/2,f));d&&this._drawControl("mtr",c,k,e+a/2,g-this.rotatingPointOffset,f);c.restore();return this},_drawControl:function(c,f,b,a,g,e){e=e||{};if(this.isControlVisible(c)){c=this.cornerSize;var d=!this.transparentCorners&&this.cornerStrokeColor;
switch(e.cornerStyle||this.cornerStyle){case "circle":f.beginPath();f.arc(a+c/2,g+c/2,c/2,0,2*Math.PI,!1);f[b]();d&&f.stroke();break;default:this.transparentCorners||f.clearRect(a,g,c,c),f[b+"Rect"](a,g,c,c),d&&f.strokeRect(a,g,c,c)}}},isControlVisible:function(c){return this._getControlsVisibility()[c]},setControlVisible:function(c,f){this._getControlsVisibility()[c]=f;return this},setControlsVisibility:function(c){c||(c={});for(var f in c)this.setControlVisible(f,c[f]);return this},_getControlsVisibility:function(){this._controlsVisibility||
(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0});return this._controlsVisibility},onDeselect:function(){},onSelect:function(){}})})();
fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(e,c){c=c||{};var f=function(){},b=c.onComplete||f,a=c.onChange||f,g=this;fabric.util.animate({startValue:e.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(b){e.set("left",b);g.requestRenderAll();a()},onComplete:function(){e.setCoords();b()}});return this},fxCenterObjectV:function(e,c){c=c||{};var f=function(){},b=c.onComplete||f,a=c.onChange||f,g=this;fabric.util.animate({startValue:e.top,
endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(b){e.set("top",b);g.requestRenderAll();a()},onComplete:function(){e.setCoords();b()}});return this},fxRemove:function(e,c){c=c||{};var f=function(){},b=c.onComplete||f,a=c.onChange||f,g=this;fabric.util.animate({startValue:e.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(b){e.set("opacity",b);g.requestRenderAll();a()},onComplete:function(){g.remove(e);b()}});return this}});
fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"===typeof arguments[0]){var e=[];for(b in arguments[0])e.push(b);for(var c=0,f=e.length;c<f;c++){var b=e[c];var a=c!==f-1;this._animate(b,arguments[0][b],arguments[1],a)}}else this._animate.apply(this,arguments);return this},_animate:function(e,c,f,b){var a=this,g;c=c.toString();f=f?fabric.util.object.clone(f):{};~e.indexOf(".")&&(g=e.split("."));var l=g?this.get(g[0])[g[1]]:this.get(e);"from"in f||(f.from=
l);c=~c.indexOf("=")?l+parseFloat(c.replace("=","")):parseFloat(c);fabric.util.animate({startValue:f.from,endValue:c,byValue:f.by,easing:f.easing,duration:f.duration,abort:f.abort&&function(){return f.abort.call(a)},onChange:function(c,l,h){g?a[g[0]][g[1]]=c:a.set(e,c);b||f.onChange&&f.onChange(c,l,h)},onComplete:function(c,g,e){b||(a.setCoords(),f.onComplete&&f.onComplete(c,g,e))}})}});
(function(e){var c=e.fabric||(e.fabric={}),f=Math.PI;c.Circle?c.warn("fabric.Circle is already defined."):(c.Circle=c.util.createClass(c.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*f,cacheProperties:c.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(b,a){this.callSuper("_set",b,a);"radius"===b&&this.setRadius(a);return this},toObject:function(b){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(b))},_toSVG:function(){var b=
(this.endAngle-this.startAngle)%(2*f);if(0===b)b=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,'" />\n'];else{var a=c.util.cos(this.startAngle)*this.radius,g=c.util.sin(this.startAngle)*this.radius,e=c.util.cos(this.endAngle)*this.radius,d=c.util.sin(this.endAngle)*this.radius;b=['<path d="M '+a+" "+g," A "+this.radius+" "+this.radius," 0 ",+(b>f?1:0)+" 1"," "+e+" "+d,'" ',"COMMON_PARTS"," />\n"]}return b},_render:function(b){b.beginPath();b.arc(0,0,this.radius,this.startAngle,this.endAngle,
!1);this._renderPaintInOrder(b)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(b){this.radius=b;return this.set("width",2*b).set("height",2*b)}}),c.Circle.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["cx","cy","r"]),c.Circle.fromElement=function(b,a){b=c.parseAttributes(b,c.Circle.ATTRIBUTE_NAMES);if(!("radius"in b&&0<=b.radius))throw Error("value of `r` attribute is required and can not be negative");
b.left=(b.left||0)-b.radius;b.top=(b.top||0)-b.radius;a(new c.Circle(b))},c.Circle.fromObject=function(b,a){return c.Object._fromObject("Circle",b,a)})})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={}),f=c.util.object.extend;c.Rect?c.warn("fabric.Rect is already defined"):(c.Rect=c.util.createClass(c.Object,{stateProperties:c.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:c.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(b){this.callSuper("initialize",b);this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(b){var a=
this.rx?Math.min(this.rx,this.width/2):0,c=this.ry?Math.min(this.ry,this.height/2):0,f=this.width,d=this.height,e=-this.width/2,h=-this.height/2,m=0!==a||0!==c;b.beginPath();b.moveTo(e+a,h);b.lineTo(e+f-a,h);m&&b.bezierCurveTo(e+f-.4477152502*a,h,e+f,h+.4477152502*c,e+f,h+c);b.lineTo(e+f,h+d-c);m&&b.bezierCurveTo(e+f,h+d-.4477152502*c,e+f-.4477152502*a,h+d,e+f-a,h+d);b.lineTo(e+a,h+d);m&&b.bezierCurveTo(e+.4477152502*a,h+d,e,h+d-.4477152502*c,e,h+d-c);b.lineTo(e,h+c);m&&b.bezierCurveTo(e,h+.4477152502*
c,e+.4477152502*a,h,e+a,h);b.closePath();this._renderPaintInOrder(b)},_renderDashedStroke:function(b){var a=-this.width/2,g=-this.height/2,f=this.width,d=this.height;b.beginPath();c.util.drawDashedLine(b,a,g,a+f,g,this.strokeDashArray);c.util.drawDashedLine(b,a+f,g,a+f,g+d,this.strokeDashArray);c.util.drawDashedLine(b,a+f,g+d,a,g+d,this.strokeDashArray);c.util.drawDashedLine(b,a,g+d,a,g,this.strokeDashArray);b.closePath()},toObject:function(b){return this.callSuper("toObject",["rx","ry"].concat(b))},
_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n']}}),c.Rect.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),c.Rect.fromElement=function(b,a,g){if(!b)return a(null);g=g||{};b=c.parseAttributes(b,c.Rect.ATTRIBUTE_NAMES);b.left=b.left||0;b.top=b.top||0;b.height=b.height||0;b.width=b.width||0;g=new c.Rect(f(g?c.util.object.clone(g):{},b));
g.visible=g.visible&&0<g.width&&0<g.height;a(g)},c.Rect.fromObject=function(b,a){return c.Object._fromObject("Rect",b,a)})})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={}),f=c.util.array.min,b=c.util.array.max,a=c.util.object.extend,g=Object.prototype.toString,l=c.util.drawArc,d=c.util.toFixed,k={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},h={m:"l",M:"L"};c.Path?c.warn("fabric.Path is already defined"):(c.Path=c.util.createClass(c.Object,{type:"path",path:null,cacheProperties:c.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:c.Object.prototype.stateProperties.concat("path"),initialize:function(a,b){b=b||
{};this.callSuper("initialize",b);a||(a=[]);var d="[object Array]"===g.call(a);if(this.path=d?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi))d||(this.path=this._parsePath()),c.Polyline.prototype._setPositionDimensions.call(this,b)},_renderPathCommands:function(a){var b=null,c=0,d=0,g=0,f=0,e=0,k=0,m=-this.pathOffset.x,h=-this.pathOffset.y;a.beginPath();for(var y=0,z=this.path.length;y<z;++y){var p=this.path[y];switch(p[0]){case "l":g+=p[1];f+=p[2];a.lineTo(g+m,f+h);break;case "L":g=p[1];f=p[2];
a.lineTo(g+m,f+h);break;case "h":g+=p[1];a.lineTo(g+m,f+h);break;case "H":g=p[1];a.lineTo(g+m,f+h);break;case "v":f+=p[1];a.lineTo(g+m,f+h);break;case "V":f=p[1];a.lineTo(g+m,f+h);break;case "m":g+=p[1];f+=p[2];c=g;d=f;a.moveTo(g+m,f+h);break;case "M":g=p[1];f=p[2];c=g;d=f;a.moveTo(g+m,f+h);break;case "c":var u=g+p[5];var A=f+p[6];e=g+p[3];k=f+p[4];a.bezierCurveTo(g+p[1]+m,f+p[2]+h,e+m,k+h,u+m,A+h);g=u;f=A;break;case "C":g=p[5];f=p[6];e=p[3];k=p[4];a.bezierCurveTo(p[1]+m,p[2]+h,e+m,k+h,g+m,f+h);break;
case "s":u=g+p[3];A=f+p[4];null===b[0].match(/[CcSs]/)?(e=g,k=f):(e=2*g-e,k=2*f-k);a.bezierCurveTo(e+m,k+h,g+p[1]+m,f+p[2]+h,u+m,A+h);e=g+p[1];k=f+p[2];g=u;f=A;break;case "S":u=p[3];A=p[4];null===b[0].match(/[CcSs]/)?(e=g,k=f):(e=2*g-e,k=2*f-k);a.bezierCurveTo(e+m,k+h,p[1]+m,p[2]+h,u+m,A+h);g=u;f=A;e=p[1];k=p[2];break;case "q":u=g+p[3];A=f+p[4];e=g+p[1];k=f+p[2];a.quadraticCurveTo(e+m,k+h,u+m,A+h);g=u;f=A;break;case "Q":u=p[3];A=p[4];a.quadraticCurveTo(p[1]+m,p[2]+h,u+m,A+h);g=u;f=A;e=p[1];k=p[2];
break;case "t":u=g+p[1];A=f+p[2];null===b[0].match(/[QqTt]/)?(e=g,k=f):(e=2*g-e,k=2*f-k);a.quadraticCurveTo(e+m,k+h,u+m,A+h);g=u;f=A;break;case "T":u=p[1];A=p[2];null===b[0].match(/[QqTt]/)?(e=g,k=f):(e=2*g-e,k=2*f-k);a.quadraticCurveTo(e+m,k+h,u+m,A+h);g=u;f=A;break;case "a":l(a,g+m,f+h,[p[1],p[2],p[3],p[4],p[5],p[6]+g+m,p[7]+f+h]);g+=p[6];f+=p[7];break;case "A":l(a,g+m,f+h,[p[1],p[2],p[3],p[4],p[5],p[6]+m,p[7]+h]);g=p[6];f=p[7];break;case "z":case "Z":g=c,f=d,a.closePath()}b=p}},_render:function(a){this._renderPathCommands(a);
this._renderPaintInOrder(a)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(b){return a(this.callSuper("toObject",b),{path:this.path.map(function(a){return a.slice()})})},toDatalessObject:function(a){a=this.toObject(["sourcePath"].concat(a));a.sourcePath&&delete a.path;return a},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',this.path.map(function(a){return a.join(" ")}).join(" "),'" stroke-linecap="round" ',
"/>\n"]},_getOffsetTransform:function(){var a=c.Object.NUM_FRACTION_DIGITS;return" translate("+d(-this.pathOffset.x,a)+", "+d(-this.pathOffset.y,a)+")"},toClipPathSVG:function(a){var b=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:a,additionalTransform:b})},toSVG:function(a){var b=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:a,additionalTransform:b})},complexity:function(){return this.path.length},_parsePath:function(){for(var a=
[],b=[],d,g,f=c.rePathCommand,e,l=0,v=this.path.length;l<v;l++){d=this.path[l];e=d.slice(1).trim();for(b.length=0;g=f.exec(e);)b.push(g[0]);d=[d.charAt(0)];e=0;for(var r=b.length;e<r;e++)g=parseFloat(b[e]),isNaN(g)||d.push(g);g=d[0];e=k[g.toLowerCase()];r=h[g]||g;if(d.length-1>e)for(var w=1,y=d.length;w<y;w+=e)a.push([g].concat(d.slice(w,w+e))),g=r;else a.push(d)}return a},_calcDimensions:function(){for(var a=[],d=[],g,e=null,l=0,k=0,h=0,v=0,r=0,w=0,y,z,p,u=0,A=this.path.length;u<A;++u){g=this.path[u];
switch(g[0]){case "l":h+=g[1];v+=g[2];p=[];break;case "L":h=g[1];v=g[2];p=[];break;case "h":h+=g[1];p=[];break;case "H":h=g[1];p=[];break;case "v":v+=g[1];p=[];break;case "V":v=g[1];p=[];break;case "m":h+=g[1];v+=g[2];l=h;k=v;p=[];break;case "M":h=g[1];v=g[2];l=h;k=v;p=[];break;case "c":y=h+g[5];z=v+g[6];r=h+g[3];w=v+g[4];p=c.util.getBoundsOfCurve(h,v,h+g[1],v+g[2],r,w,y,z);h=y;v=z;break;case "C":r=g[3];w=g[4];p=c.util.getBoundsOfCurve(h,v,g[1],g[2],r,w,g[5],g[6]);h=g[5];v=g[6];break;case "s":y=h+
g[3];z=v+g[4];null===e[0].match(/[CcSs]/)?(r=h,w=v):(r=2*h-r,w=2*v-w);p=c.util.getBoundsOfCurve(h,v,r,w,h+g[1],v+g[2],y,z);r=h+g[1];w=v+g[2];h=y;v=z;break;case "S":y=g[3];z=g[4];null===e[0].match(/[CcSs]/)?(r=h,w=v):(r=2*h-r,w=2*v-w);p=c.util.getBoundsOfCurve(h,v,r,w,g[1],g[2],y,z);h=y;v=z;r=g[1];w=g[2];break;case "q":y=h+g[3];z=v+g[4];r=h+g[1];w=v+g[2];p=c.util.getBoundsOfCurve(h,v,r,w,r,w,y,z);h=y;v=z;break;case "Q":r=g[1];w=g[2];p=c.util.getBoundsOfCurve(h,v,r,w,r,w,g[3],g[4]);h=g[3];v=g[4];break;
case "t":y=h+g[1];z=v+g[2];null===e[0].match(/[QqTt]/)?(r=h,w=v):(r=2*h-r,w=2*v-w);p=c.util.getBoundsOfCurve(h,v,r,w,r,w,y,z);h=y;v=z;break;case "T":y=g[1];z=g[2];null===e[0].match(/[QqTt]/)?(r=h,w=v):(r=2*h-r,w=2*v-w);p=c.util.getBoundsOfCurve(h,v,r,w,r,w,y,z);h=y;v=z;break;case "a":p=c.util.getBoundsOfArc(h,v,g[1],g[2],g[3],g[4],g[5],g[6]+h,g[7]+v);h+=g[6];v+=g[7];break;case "A":p=c.util.getBoundsOfArc(h,v,g[1],g[2],g[3],g[4],g[5],g[6],g[7]);h=g[6];v=g[7];break;case "z":case "Z":h=l,v=k}e=g;p.forEach(function(b){a.push(b.x);
d.push(b.y)});a.push(h);d.push(v)}g=f(a)||0;e=f(d)||0;l=b(a)||0;k=b(d)||0;return{left:g,top:e,width:l-g,height:k-e}}}),c.Path.fromObject=function(a,b){"string"===typeof a.sourcePath?c.loadSVGFromURL(a.sourcePath,function(c){c=c[0];c.setOptions(a);b&&b(c)}):c.Object._fromObject("Path",a,b,"path")},c.Path.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["d"]),c.Path.fromElement=function(b,g,d){b=c.parseAttributes(b,c.Path.ATTRIBUTE_NAMES);b.fromSVG=!0;g(new c.Path(b.d,a(b,d)))})})("undefined"!==typeof exports?
exports:this);
(function(e){var c=e.fabric||(e.fabric={}),f=c.util.array.min,b=c.util.array.max;c.Group||(c.Group=c.util.createClass(c.Object,c.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(a,b,c){b=b||{};this._objects=[];c&&this.callSuper("initialize",b);this._objects=a||[];for(a=this._objects.length;a--;)this._objects[a].group=this;c?this._updateObjectsACoords():(c=b&&b.centerPoint,void 0!==b.originX&&(this.originX=b.originX),void 0!==b.originY&&
(this.originY=b.originY),c||this._calcBounds(),this._updateObjectsCoords(c),delete b.centerPoint,this.callSuper("initialize",b));this.setCoords()},_updateObjectsACoords:function(){for(var a=this._objects.length;a--;)this._objects[a].setCoords(!0,!0)},_updateObjectsCoords:function(a){a=a||this.getCenterPoint();for(var b=this._objects.length;b--;)this._updateObjectCoords(this._objects[b],a)},_updateObjectCoords:function(a,b){a.set({left:a.left-b.x,top:a.top-b.y});a.group=this;a.setCoords(!0,!0)},toString:function(){return"#<fabric.Group: ("+
this.complexity()+")>"},addWithUpdate:function(a){this._restoreObjectsState();c.util.resetObjectTransform(this);a&&(this._objects.push(a),a.group=this,a._set("canvas",this.canvas));this._calcBounds();this._updateObjectsCoords();this.setCoords();this.dirty=!0;return this},removeWithUpdate:function(a){this._restoreObjectsState();c.util.resetObjectTransform(this);this.remove(a);this._calcBounds();this._updateObjectsCoords();this.setCoords();this.dirty=!0;return this},_onObjectAdded:function(a){this.dirty=
!0;a.group=this;a._set("canvas",this.canvas)},_onObjectRemoved:function(a){this.dirty=!0;delete a.group},_set:function(a,b){var g=this._objects.length;if(this.useSetOnGroup)for(;g--;)this._objects[g].setOnGroup(a,b);if("canvas"===a)for(;g--;)this._objects[g]._set(a,b);c.Object.prototype._set.call(this,a,b)},toObject:function(a){var b=this.includeDefaultValues,f=this._objects.map(function(c){var g=c.includeDefaultValues;c.includeDefaultValues=b;var d=c.toObject(a);c.includeDefaultValues=g;return d}),
d=c.Object.prototype.toObject.call(this,a);d.objects=f;return d},toDatalessObject:function(a){var b=this.sourcePath;if(!b){var f=this.includeDefaultValues;b=this._objects.map(function(b){var c=b.includeDefaultValues;b.includeDefaultValues=f;var g=b.toDatalessObject(a);b.includeDefaultValues=c;return g})}var d=c.Object.prototype.toDatalessObject.call(this,a);d.objects=b;return d},render:function(a){this._transformDone=!0;this.callSuper("render",a);this._transformDone=!1},shouldCache:function(){var a=
c.Object.prototype.shouldCache.call(this);if(a)for(var b=0,f=this._objects.length;b<f;b++)if(this._objects[b].willDrawShadow())return this.ownCaching=!1;return a},willDrawShadow:function(){if(c.Object.prototype.willDrawShadow.call(this))return!0;for(var a=0,b=this._objects.length;a<b;a++)if(this._objects[a].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(a){for(var b=0,c=this._objects.length;b<c;b++)this._objects[b].render(a);
this._drawClipPath(a)},isCacheDirty:function(a){if(this.callSuper("isCacheDirty",a))return!0;if(!this.statefullCache)return!1;a=0;for(var b=this._objects.length;a<b;a++)if(this._objects[a].isCacheDirty(!0))return this._cacheCanvas&&(a=this.cacheWidth/this.zoomX,b=this.cacheHeight/this.zoomY,this._cacheContext.clearRect(-a/2,-b/2,a,b)),!0;return!1},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},realizeTransform:function(a){var b=a.calcTransformMatrix();
b=c.util.qrDecompose(b);var f=new c.Point(b.translateX,b.translateY);a.flipX=!1;a.flipY=!1;a.set("scaleX",b.scaleX);a.set("scaleY",b.scaleY);a.skewX=b.skewX;a.skewY=b.skewY;a.angle=b.angle;a.setPositionByOrigin(f,"center","center");return a},_restoreObjectState:function(a){this.realizeTransform(a);a.setCoords();delete a.group;return this},destroy:function(){this._objects.forEach(function(a){a.set("dirty",!0)});return this._restoreObjectsState()},toActiveSelection:function(){if(this.canvas){var a=
this._objects,b=this.canvas;this._objects=[];var f=this.toObject();delete f.objects;var d=new c.ActiveSelection([]);d.set(f);d.type="activeSelection";b.remove(this);a.forEach(function(a){a.group=d;a.dirty=!0;b.add(a)});d.canvas=b;d._objects=a;b._activeObject=d;d.setCoords();return d}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){this.forEachObject(function(a){a.setCoords(!0,!0)});return this},_calcBounds:function(a){for(var b=[],c=[],d,f,e=["tr","br",
"bl","tl"],m=0,q=this._objects.length,n,x=e.length;m<q;++m)for(d=this._objects[m],d.setCoords(!0),n=0;n<x;n++)f=e[n],b.push(d.oCoords[f].x),c.push(d.oCoords[f].y);this._getBounds(b,c,a)},_getBounds:function(a,g,e){var d=new c.Point(f(a),f(g));a=new c.Point(b(a),b(g));g=d.y||0;var l=d.x||0,h=a.y-d.y||0;this.width=a.x-d.x||0;this.height=h;e||this.setPositionByOrigin({x:l,y:g},"left","top")},_toSVG:function(a){for(var b=["<g ","COMMON_PARTS"," >\n"],c=0,d=this._objects.length;c<d;c++)b.push("\t\t",this._objects[c].toSVG(a));
b.push("</g>\n");return b},getSvgStyles:function(){var a=this.visible?"":" visibility: hidden;";return["undefined"!==typeof this.opacity&&1!==this.opacity?"opacity: "+this.opacity+";":"",this.getSvgFilter(),a].join("")},toClipPathSVG:function(a){for(var b=[],c=0,d=this._objects.length;c<d;c++)b.push("\t",this._objects[c].toClipPathSVG(a));return this._createBaseClipPathSVGMarkup(b,{reviver:a})}}),c.Group.fromObject=function(a,b){var g=a.objects,d=c.util.object.clone(a,!0);delete d.objects;"string"===
typeof g?c.loadSVGFromURL(g,function(f){f=c.util.groupSVGElements(f,a,g);f.set(d);b&&b(f)}):c.util.enlivenObjects(g,function(d){c.util.enlivenObjects([a.clipPath],function(g){var f=c.util.object.clone(a,!0);f.clipPath=g[0];delete f.objects;b&&b(new c.Group(d,f,!0))})})})})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={});c.ActiveSelection||(c.ActiveSelection=c.util.createClass(c.Group,{type:"activeSelection",initialize:function(f,b){b=b||{};this._objects=f||[];for(f=this._objects.length;f--;)this._objects[f].group=this;b.originX&&(this.originX=b.originX);b.originY&&(this.originY=b.originY);this._calcBounds();this._updateObjectsCoords();c.Object.prototype.initialize.call(this,b);this.setCoords()},toGroup:function(){var f=this._objects.concat();this._objects=[];var b=c.Object.prototype.toObject.call(this),
a=new c.Group([]);delete b.type;a.set(b);f.forEach(function(b){b.canvas.remove(b);b.group=a});a._objects=f;if(!this.canvas)return a;f=this.canvas;f.add(a);f._activeObject=a;a.setCoords();return a},onDeselect:function(){this.destroy();return!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(c,b,a){c.save();c.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;this.callSuper("_renderControls",
c,b);a=a||{};"undefined"===typeof a.hasControls&&(a.hasControls=!1);"undefined"===typeof a.hasRotatingPoint&&(a.hasRotatingPoint=!1);a.forActiveSelection=!0;b=0;for(var g=this._objects.length;b<g;b++)this._objects[b]._renderControls(c,a);c.restore()}}),c.ActiveSelection.fromObject=function(f,b){c.util.enlivenObjects(f.objects,function(a){delete f.objects;b&&b(new c.ActiveSelection(a,f,!0))})})})("undefined"!==typeof exports?exports:this);
(function(e){var c=fabric.util.object.extend;e.fabric||(e.fabric={});e.fabric.Image?fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:fabric.Object.prototype.stateProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,initialize:function(c,b){b||(b={});this.filters=[];this.cacheKey=
"texture"+fabric.Object.__uid++;this.callSuper("initialize",b);this._initElement(c,b)},getElement:function(){return this._element||{}},setElement:function(c,b){this.removeTexture(this.cacheKey);this.removeTexture(this.cacheKey+"_filtered");this._originalElement=this._element=c;this._initConfig(b);0!==this.filters.length&&this.applyFilters();this.resizeFilter&&this.applyResizeFilters();return this},removeTexture:function(c){var b=fabric.filterBackend;b&&b.evictCachesForKey&&b.evictCachesForKey(c)},
dispose:function(){this.removeTexture(this.cacheKey);this.removeTexture(this.cacheKey+"_filtered");this._cacheContext=void 0;["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(c){fabric.util.cleanUpJsdomNode(this[c]);this[c]=void 0}.bind(this))},setCrossOrigin:function(c){this.crossOrigin=c;this._element.crossOrigin=c;return this},getOriginalSize:function(){var c=this.getElement();return{width:c.naturalWidth||c.width,height:c.naturalHeight||c.height}},_stroke:function(c){if(this.stroke&&
0!==this.strokeWidth){var b=this.width/2,a=this.height/2;c.beginPath();c.moveTo(-b,-a);c.lineTo(b,-a);c.lineTo(b,a);c.lineTo(-b,a);c.lineTo(-b,-a);c.closePath()}},_renderDashedStroke:function(c){var b=-this.width/2,a=-this.height/2,g=this.width,f=this.height;c.save();this._setStrokeStyles(c,this);c.beginPath();fabric.util.drawDashedLine(c,b,a,b+g,a,this.strokeDashArray);fabric.util.drawDashedLine(c,b+g,a,b+g,a+f,this.strokeDashArray);fabric.util.drawDashedLine(c,b+g,a+f,b,a+f,this.strokeDashArray);
fabric.util.drawDashedLine(c,b,a+f,b,a,this.strokeDashArray);c.closePath();c.restore()},toObject:function(f){var b=[];this.filters.forEach(function(a){a&&b.push(a.toObject())});f=c(this.callSuper("toObject",["crossOrigin","cropX","cropY"].concat(f)),{src:this.getSrc(),filters:b});this.resizeFilter&&(f.resizeFilter=this.resizeFilter.toObject());return f},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var c=[],b=
[],a=-this.width/2,g=-this.height/2,e="";this.hasCrop()&&(e=fabric.Object.__uid++,c.push('<clipPath id="imageCrop_'+e+'">\n','\t<rect x="'+a+'" y="'+g+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),e=' clip-path="url(#imageCrop_'+e+')" ');b.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',a-this.cropX,'" y="',g-this.cropY,'" width="',this._element.width||this._element.naturalWidth,'" height="',this._element.height||this._element.height,'"',e,"></image>\n");
if(this.stroke||this.strokeDashArray){e=this.fill;this.fill=null;var d=["\t<rect ",'x="',a,'" y="',g,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'];this.fill=e}return c="fill"!==this.paintFirst?c.concat(d,b):c.concat(b,d)},getSrc:function(c){return(c=c?this._element:this._originalElement)?c.toDataURL?c.toDataURL():this.srcFromAttribute?c.getAttribute("src"):c.src:this.src||""},setSrc:function(c,b,a){fabric.util.loadImage(c,function(c){this.setElement(c,a);
this._setWidthHeight();b&&b(this)},this,a&&a.crossOrigin);return this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var c=this.resizeFilter,b=this.minimumScaleTrigger,a=this.getTotalObjectScaling(),g=a.scaleX;a=a.scaleY;var e=this._filteredEl||this._originalElement;this.group&&this.set("dirty",!0);if(!c||g>b&&a>b)this._element=e,this._filterScalingY=this._filterScalingX=1,this._lastScaleX=g,this._lastScaleY=a;else{fabric.filterBackend||(fabric.filterBackend=
fabric.initFilterBackend());b=fabric.util.createCanvasElement();var d=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,k=e.width,h=e.height;b.width=k;b.height=h;this._element=b;this._lastScaleX=c.scaleX=g;this._lastScaleY=c.scaleY=a;fabric.filterBackend.applyFilters([c],e,k,h,this._element,d);this._filterScalingX=b.width/this._originalElement.width;this._filterScalingY=b.height/this._originalElement.height}},applyFilters:function(c){c=c||this.filters||[];c=c.filter(function(a){return a&&!a.isNeutralState()});
this.set("dirty",!0);this.removeTexture(this.cacheKey+"_filtered");if(0===c.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingY=this._filterScalingX=1,this;var b=this._originalElement,a=b.naturalWidth||b.width;b=b.naturalHeight||b.height;if(this._element===this._originalElement){var g=fabric.util.createCanvasElement();g.width=a;g.height=b;this._filteredEl=this._element=g}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,a,
b),this._lastScaleY=this._lastScaleX=1;fabric.filterBackend||(fabric.filterBackend=fabric.initFilterBackend());fabric.filterBackend.applyFilters(c,this._originalElement,a,b,this._element,this.cacheKey);if(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height;return this},_render:function(c){!0!==this.isMoving&&
this.resizeFilter&&this._needsResize()&&this.applyResizeFilters();this._stroke(c);this._renderPaintInOrder(c)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(c){var b=this._element,a=this.width,g=this.height,f=Math.min(b.naturalWidth||b.width,a*this._filterScalingX),d=Math.min(b.naturalHeight||b.height,g*this._filterScalingY),e=Math.max(0,this.cropX*this._filterScalingX),h=Math.max(0,this.cropY*this._filterScalingY);b&&c.drawImage(b,e,h,f,d,-a/2,-g/2,a,g)},_needsResize:function(){var c=
this.getTotalObjectScaling();return c.scaleX!==this._lastScaleX||c.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(c,b){this.setElement(fabric.util.getById(c),b);fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(c){c||(c={});this.setOptions(c);this._setWidthHeight(c);this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(c,b){c&&c.length?fabric.util.enlivenObjects(c,
function(a){b&&b(a)},"fabric.Image.filters"):b&&b()},_setWidthHeight:function(c){c||(c={});var b=this.getElement();this.width=c.width||b.naturalWidth||b.width||0;this.height=c.height||b.naturalHeight||b.height||0},parsePreserveAspectRatioAttribute:function(){var c=fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),b=this._element.width,a=this._element.height,g=1,e=1,d=0,k=0,h=0,m=0,q=this.width,n=this.height,x={width:q,height:n};if(!c||"none"===c.alignX&&"none"===c.alignY)g=
q/b,e=n/a;else{if("meet"===c.meetOrSlice){g=e=fabric.util.findScaleToFit(this._element,x);var t=(q-b*g)/2;"Min"===c.alignX&&(d=-t);"Max"===c.alignX&&(d=t);t=(n-a*e)/2;"Min"===c.alignY&&(k=-t);"Max"===c.alignY&&(k=t)}"slice"===c.meetOrSlice&&(g=e=fabric.util.findScaleToCover(this._element,x),t=b-q/g,"Mid"===c.alignX&&(h=t/2),"Max"===c.alignX&&(h=t),t=a-n/e,"Mid"===c.alignY&&(m=t/2),"Max"===c.alignY&&(m=t),b=q/g,a=n/e)}return{width:b,height:a,scaleX:g,scaleY:e,offsetLeft:d,offsetTop:k,cropX:h,cropY:m}}}),
fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(c,b){var a=fabric.util.object.clone(c);fabric.util.loadImage(a.src,function(c,f){f?b&&b(null,f):fabric.Image.prototype._initFilters.call(a,a.filters,function(d){a.filters=d||[];fabric.Image.prototype._initFilters.call(a,[a.resizeFilter],function(d){a.resizeFilter=d[0];fabric.util.enlivenObjects([a.clipPath],function(d){a.clipPath=d[0];d=new fabric.Image(c,a);b(d)})})})},
null,a.crossOrigin)},fabric.Image.fromURL=function(c,b,a){fabric.util.loadImage(c,function(c){b&&b(new fabric.Image(c,a))},null,a&&a.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin".split(" ")),fabric.Image.fromElement=function(f,b,a){f=fabric.parseAttributes(f,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(f["xlink:href"],b,c(a?fabric.util.object.clone(a):{},f))})})("undefined"!==typeof exports?exports:this);
fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var e=this.angle%360;return 0<e?90*Math.round((e-1)/90):90*Math.round(e/90)},straighten:function(){this.rotate(this._getAngleValueForStraighten());return this},fxStraighten:function(e){e=e||{};var c=function(){},f=e.onComplete||c,b=e.onChange||c,a=this;fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(c){a.rotate(c);b()},
onComplete:function(){a.setCoords();f()}});return this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(e){e.straighten();this.requestRenderAll();return this},fxStraightenObject:function(e){e.fxStraighten({onChange:this.requestRenderAllBound});return this}});
(function(){function e(c){c&&c.tileSize&&(this.tileSize=c.tileSize);this.setupGLContext(this.tileSize,this.tileSize);this.captureGPUInfo()}fabric.isWebglSupported=function(c){if(fabric.isLikelyNode)return!1;c=c||fabric.WebglFilterBackend.prototype.tileSize;var f=document.createElement("canvas");f=f.getContext("webgl")||f.getContext("experimental-webgl");var b=!1;if(f){fabric.maxTextureSize=f.getParameter(f.MAX_TEXTURE_SIZE);b=fabric.maxTextureSize>=c;c=["highp","mediump","lowp"];for(var a=0;3>a;a++){var g=
f;var e="precision "+c[a]+" float;\nvoid main(){}",d=g.createShader(g.FRAGMENT_SHADER);g.shaderSource(d,e);g.compileShader(d);g=g.getShaderParameter(d,g.COMPILE_STATUS)?!0:!1;if(g){fabric.webGlPrecision=c[a];break}}}return this.isSupported=b};fabric.WebglFilterBackend=e;e.prototype={tileSize:2048,resources:{},setupGLContext:function(c,f){this.dispose();this.createWebGLCanvas(c,f);this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]);this.chooseFastestCopyGLTo2DMethod(c,f)},chooseFastestCopyGLTo2DMethod:function(c,
f){var b="undefined"!==typeof window.performance;try{new ImageData(1,1);var a=!0}catch(d){a=!1}var g="undefined"!==typeof ArrayBuffer,e="undefined"!==typeof Uint8ClampedArray;b&&a&&g&&e&&(g=fabric.util.createCanvasElement(),b=new ArrayBuffer(c*f*4),fabric.forceGLPutImageData?(this.imageBuffer=b,this.copyGLTo2D=copyGLTo2DPutImageData):(a={imageBuffer:b,destinationWidth:c,destinationHeight:f,targetCanvas:g},g.width=c,g.height=f,f=window.performance.now(),copyGLTo2DDrawImage.call(a,this.gl,a),c=window.performance.now()-
f,f=window.performance.now(),copyGLTo2DPutImageData.call(a,this.gl,a),f=window.performance.now()-f,c>f?(this.imageBuffer=b,this.copyGLTo2D=copyGLTo2DPutImageData):this.copyGLTo2D=copyGLTo2DDrawImage))},createWebGLCanvas:function(c,f){var b=fabric.util.createCanvasElement();b.width=c;b.height=f;c={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1};(f=b.getContext("webgl",c))||(f=b.getContext("experimental-webgl",c));f&&(f.clearColor(0,0,0,0),this.canvas=b,this.gl=f)},applyFilters:function(c,
f,b,a,g,e){var d=this.gl,l;e&&(l=this.getCachedTexture(e,f));var h={originalWidth:f.width||f.originalWidth,originalHeight:f.height||f.originalHeight,sourceWidth:b,sourceHeight:a,destinationWidth:b,destinationHeight:a,context:d,sourceTexture:this.createTexture(d,b,a,!l&&f),targetTexture:this.createTexture(d,b,a),originalTexture:l||this.createTexture(d,b,a,!l&&f),passes:c.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:g};f=d.createFramebuffer();
d.bindFramebuffer(d.FRAMEBUFFER,f);c.forEach(function(a){a&&a.applyTo(h)});resizeCanvasIfNeeded(h);this.copyGLTo2D(d,h);d.bindTexture(d.TEXTURE_2D,null);d.deleteTexture(h.sourceTexture);d.deleteTexture(h.targetTexture);d.deleteFramebuffer(f);g.getContext("2d").setTransform(1,0,0,1,0,0);return h},dispose:function(){this.canvas&&(this.gl=this.canvas=null);this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={};this.textureCache={}},createTexture:function(c,e,b,a){var g=c.createTexture();
c.bindTexture(c.TEXTURE_2D,g);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);a?c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,a):c.texImage2D(c.TEXTURE_2D,0,c.RGBA,e,b,0,c.RGBA,c.UNSIGNED_BYTE,null);return g},getCachedTexture:function(c,e){if(this.textureCache[c])return this.textureCache[c];
e=this.createTexture(this.gl,e.width,e.height,e);return this.textureCache[c]=e},evictCachesForKey:function(c){this.textureCache[c]&&(this.gl.deleteTexture(this.textureCache[c]),delete this.textureCache[c])},copyGLTo2D:copyGLTo2DDrawImage,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var c=this.gl,e={renderer:"",vendor:""};if(!c)return e;var b=c.getExtension("WEBGL_debug_renderer_info");if(b){var a=c.getParameter(b.UNMASKED_RENDERER_WEBGL);c=c.getParameter(b.UNMASKED_VENDOR_WEBGL);
a&&(e.renderer=a.toLowerCase());c&&(e.vendor=c.toLowerCase())}return this.gpuInfo=e}}})();function resizeCanvasIfNeeded(e){var c=e.targetCanvas,f=c.height,b=e.destinationWidth;e=e.destinationHeight;if(c.width!==b||f!==e)c.width=b,c.height=e}function copyGLTo2DDrawImage(e,c){e=e.canvas;c=c.targetCanvas;var f=c.getContext("2d");f.translate(0,c.height);f.scale(1,-1);f.drawImage(e,0,e.height-c.height,c.width,c.height,0,0,c.width,c.height)}
function copyGLTo2DPutImageData(e,c){var f=c.targetCanvas.getContext("2d"),b=c.destinationWidth;c=c.destinationHeight;var a=b*c*4,g=new Uint8Array(this.imageBuffer,0,a);a=new Uint8ClampedArray(this.imageBuffer,0,a);e.readPixels(0,0,b,c,e.RGBA,e.UNSIGNED_BYTE,g);e=new ImageData(a,b,c);f.putImageData(e,0,0)}
(function(){function e(){}var c=function(){};fabric.Canvas2dFilterBackend=e;e.prototype={evictCachesForKey:c,dispose:c,clearWebGLCaches:c,resources:{},applyFilters:function(c,b,a,g,e){var d=e.getContext("2d");d.drawImage(b,0,0,a,g);var f=d.getImageData(0,0,a,g),l=d.getImageData(0,0,a,g),m={sourceWidth:a,sourceHeight:g,imageData:f,originalEl:b,originalImageData:l,canvasEl:e,ctx:d,filterBackend:this};c.forEach(function(a){a.applyTo(m)});if(m.imageData.width!==a||m.imageData.height!==g)e.width=m.imageData.width,
e.height=m.imageData.height;d.putImageData(m.imageData,0,0);return m}}})();fabric.Image=fabric.Image||{};fabric.Image.filters=fabric.Image.filters||{};
fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(e){e&&this.setOptions(e)},setOptions:function(e){for(var c in e)this[c]=e[c]},createProgram:function(e,
c,f){c=c||this.fragmentSource;f=f||this.vertexSource;"highp"!==fabric.webGlPrecision&&(c=c.replace(/precision highp float/g,"precision "+fabric.webGlPrecision+" float"));var b=e.createShader(e.VERTEX_SHADER);e.shaderSource(b,f);e.compileShader(b);if(!e.getShaderParameter(b,e.COMPILE_STATUS))throw Error("Vertex shader compile error for "+this.type+": "+e.getShaderInfoLog(b));f=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(f,c);e.compileShader(f);if(!e.getShaderParameter(f,e.COMPILE_STATUS))throw Error("Fragment shader compile error for "+
this.type+": "+e.getShaderInfoLog(f));c=e.createProgram();e.attachShader(c,b);e.attachShader(c,f);e.linkProgram(c);if(!e.getProgramParameter(c,e.LINK_STATUS))throw Error('Shader link error for "${this.type}" '+e.getProgramInfoLog(c));b=this.getAttributeLocations(e,c);f=this.getUniformLocations(e,c)||{};f.uStepW=e.getUniformLocation(c,"uStepW");f.uStepH=e.getUniformLocation(c,"uStepH");return{program:c,attributeLocations:b,uniformLocations:f}},getAttributeLocations:function(e,c){return{aPosition:e.getAttribLocation(c,
"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(e,c,f){c=c.aPosition;var b=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,b);e.enableVertexAttribArray(c);e.vertexAttribPointer(c,2,e.FLOAT,!1,0,0);e.bufferData(e.ARRAY_BUFFER,f,e.STATIC_DRAW)},_setupFrameBuffer:function(e){var c=e.context;if(1<e.passes){var f=e.destinationWidth;var b=e.destinationHeight;if(e.sourceWidth!==f||e.sourceHeight!==b)c.deleteTexture(e.targetTexture),e.targetTexture=e.filterBackend.createTexture(c,
f,b);c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,e.targetTexture,0)}else c.bindFramebuffer(c.FRAMEBUFFER,null),c.finish()},_swapTextures:function(e){e.passes--;e.pass++;var c=e.targetTexture;e.targetTexture=e.sourceTexture;e.sourceTexture=c},isNeutralState:function(){var e=this.mainParameter,c=fabric.Image.filters[this.type].prototype;if(e){if(Array.isArray(c[e])){for(var f=c[e].length;f--;)if(this[e][f]!==c[e][f])return!1;return!0}return c[e]===this[e]}return!1},applyTo:function(e){e.webgl?
(this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)},retrieveShader:function(e){e.programCache.hasOwnProperty(this.type)||(e.programCache[this.type]=this.createProgram(e.context));return e.programCache[this.type]},applyToWebGL:function(e){var c=e.context,f=this.retrieveShader(e);0===e.pass&&e.originalTexture?c.bindTexture(c.TEXTURE_2D,e.originalTexture):c.bindTexture(c.TEXTURE_2D,e.sourceTexture);c.useProgram(f.program);this.sendAttributeData(c,f.attributeLocations,
e.aPosition);c.uniform1f(f.uniformLocations.uStepW,1/e.sourceWidth);c.uniform1f(f.uniformLocations.uStepH,1/e.sourceHeight);this.sendUniformData(c,f.uniformLocations);c.viewport(0,0,e.destinationWidth,e.destinationHeight);c.drawArrays(c.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(e,c,f){e.activeTexture(f);e.bindTexture(e.TEXTURE_2D,c);e.activeTexture(e.TEXTURE0)},unbindAdditionalTexture:function(e,c){e.activeTexture(c);e.bindTexture(e.TEXTURE_2D,null);e.activeTexture(e.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},
setMainParameter:function(e){this[this.mainParameter]=e},sendUniformData:function(){},createHelpLayer:function(e){if(!e.helpLayer){var c=document.createElement("canvas");c.width=e.sourceWidth;c.height=e.sourceHeight;e.helpLayer=c}},toObject:function(){var e={type:this.type},c=this.mainParameter;c&&(e[c]=this[c]);return e},toJSON:function(){return this.toObject()}});fabric.Image.filters.BaseFilter.fromObject=function(e,c){e=new fabric.Image.filters[e.type](e);c&&c(e);return e};
(function(e){e=e.fabric||(e.fabric={});var c=e.Image.filters,f=e.util.createClass;c.ColorMatrix=f(c.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(b){this.callSuper("initialize",
b);this.matrix=this.matrix.slice(0)},applyTo2d:function(b){b=b.imageData.data;var a=b.length,c=this.matrix,e,d=this.colorsOnly;for(e=0;e<a;e+=4){var f=b[e];var h=b[e+1];var m=b[e+2];if(d)b[e]=f*c[0]+h*c[1]+m*c[2]+255*c[4],b[e+1]=f*c[5]+h*c[6]+m*c[7]+255*c[9],b[e+2]=f*c[10]+h*c[11]+m*c[12]+255*c[14];else{var q=b[e+3];b[e]=f*c[0]+h*c[1]+m*c[2]+q*c[3]+255*c[4];b[e+1]=f*c[5]+h*c[6]+m*c[7]+q*c[8]+255*c[9];b[e+2]=f*c[10]+h*c[11]+m*c[12]+q*c[13]+255*c[14];b[e+3]=f*c[15]+h*c[16]+m*c[17]+q*c[18]+255*c[19]}}},
getUniformLocations:function(b,a){return{uColorMatrix:b.getUniformLocation(a,"uColorMatrix"),uConstants:b.getUniformLocation(a,"uConstants")}},sendUniformData:function(b,a){var c=this.matrix,e=[c[4],c[9],c[14],c[19]];b.uniformMatrix4fv(a.uColorMatrix,!1,[c[0],c[1],c[2],c[3],c[5],c[6],c[7],c[8],c[10],c[11],c[12],c[13],c[15],c[16],c[17],c[18]]);b.uniform4fv(a.uConstants,e)}});e.Image.filters.ColorMatrix.fromObject=e.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){e=e.fabric||(e.fabric={});var c=e.Image.filters,f=e.util.createClass;c.Brightness=f(c.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(b){if(0!==this.brightness){b=b.imageData.data;var a,c=b.length,e=Math.round(255*
this.brightness);for(a=0;a<c;a+=4)b[a]+=e,b[a+1]+=e,b[a+2]+=e}},getUniformLocations:function(b,a){return{uBrightness:b.getUniformLocation(a,"uBrightness")}},sendUniformData:function(b,a){b.uniform1f(a.uBrightness,this.brightness)}});e.Image.filters.Brightness.fromObject=e.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){e=e.fabric||(e.fabric={});var c=e.util.object.extend,f=e.Image.filters,b=e.util.createClass;f.Convolute=b(f.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",
Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",
Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",
Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",
Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},
retrieveShader:function(a){var b=this.type+"_"+Math.sqrt(this.matrix.length)+"_"+(this.opaque?1:0),c=this.fragmentSource[b];a.programCache.hasOwnProperty(b)||(a.programCache[b]=this.createProgram(a.context,c));return a.programCache[b]},applyTo2d:function(a){var b=a.imageData,c=b.data,d=this.matrix,e=Math.round(Math.sqrt(d.length)),f=Math.floor(e/2),m=b.width;b=b.height;var q=a.ctx.createImageData(m,b),n=q.data,x=this.opaque?1:0,t,C,B,v,r,w,y,z;for(w=0;w<b;w++)for(r=0;r<m;r++){var p=4*(w*m+r);for(z=
v=B=C=t=0;z<e;z++)for(y=0;y<e;y++){var u=w+z-f;var A=r+y-f;0>u||u>=b||0>A||A>=m||(A=4*(u*m+A),u=d[z*e+y],t+=c[A]*u,C+=c[A+1]*u,B+=c[A+2]*u,x||(v+=c[A+3]*u))}n[p]=t;n[p+1]=C;n[p+2]=B;n[p+3]=x?c[p+3]:v}a.imageData=q},getUniformLocations:function(a,b){return{uMatrix:a.getUniformLocation(b,"uMatrix"),uOpaque:a.getUniformLocation(b,"uOpaque"),uHalfSize:a.getUniformLocation(b,"uHalfSize"),uSize:a.getUniformLocation(b,"uSize")}},sendUniformData:function(a,b){a.uniform1fv(b.uMatrix,this.matrix)},toObject:function(){return c(this.callSuper("toObject"),
{opaque:this.opaque,matrix:this.matrix})}});e.Image.filters.Convolute.fromObject=e.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){e=e.fabric||(e.fabric={});var c=e.Image.filters,f=e.util.createClass;c.Grayscale=f(c.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",
luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(b){b=b.imageData.data;var a,c=b.length,e,d=this.mode;for(a=0;a<c;a+=4)"average"===d?e=(b[a]+b[a+1]+b[a+2])/3:"lightness"===d?e=(Math.min(b[a],b[a+1],b[a+2])+
Math.max(b[a],b[a+1],b[a+2]))/2:"luminosity"===d&&(e=.21*b[a]+.72*b[a+1]+.07*b[a+2]),b[a]=e,b[a+1]=e,b[a+2]=e},retrieveShader:function(b){var a=this.type+"_"+this.mode;b.programCache.hasOwnProperty(a)||(b.programCache[a]=this.createProgram(b.context,this.fragmentSource[this.mode]));return b.programCache[a]},getUniformLocations:function(b,a){return{uMode:b.getUniformLocation(a,"uMode")}},sendUniformData:function(b,a){b.uniform1i(a.uMode,1)},isNeutralState:function(){return!1}});e.Image.filters.Grayscale.fromObject=
e.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){e=e.fabric||(e.fabric={});var c=e.Image.filters,f=e.util.createClass;c.Invert=f(c.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(b){b=b.imageData.data;
var a,c=b.length;for(a=0;a<c;a+=4)b[a]=255-b[a],b[a+1]=255-b[a+1],b[a+2]=255-b[a+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(b,a){return{uInvert:b.getUniformLocation(a,"uInvert")}},sendUniformData:function(b,a){b.uniform1i(a.uInvert,this.invert)}});e.Image.filters.Invert.fromObject=e.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){e=e.fabric||(e.fabric={});var c=e.util.object.extend,f=e.Image.filters,b=e.util.createClass;f.Noise=b(f.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",
mainParameter:"noise",noise:0,applyTo2d:function(a){if(0!==this.noise){a=a.imageData.data;var b,c=this.noise;var d=0;for(b=a.length;d<b;d+=4){var e=(.5-Math.random())*c;a[d]+=e;a[d+1]+=e;a[d+2]+=e}}},getUniformLocations:function(a,b){return{uNoise:a.getUniformLocation(b,"uNoise"),uSeed:a.getUniformLocation(b,"uSeed")}},sendUniformData:function(a,b){a.uniform1f(b.uNoise,this.noise/255);a.uniform1f(b.uSeed,Math.random())},toObject:function(){return c(this.callSuper("toObject"),{noise:this.noise})}});
e.Image.filters.Noise.fromObject=e.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){e=e.fabric||(e.fabric={});var c=e.Image.filters,f=e.util.createClass;c.Pixelate=f(c.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(b){var a=
b.imageData;b=a.data;var c=a.height;a=a.width;var e,d,f,h;for(e=0;e<c;e+=this.blocksize)for(d=0;d<a;d+=this.blocksize){var m=4*e*a+4*d;var q=b[m];var n=b[m+1];var x=b[m+2];var t=b[m+3];var C=Math.min(e+this.blocksize,c);var B=Math.min(d+this.blocksize,a);for(f=e;f<C;f++)for(h=d;h<B;h++)m=4*f*a+4*h,b[m]=q,b[m+1]=n,b[m+2]=x,b[m+3]=t}},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(b,a){return{uBlocksize:b.getUniformLocation(a,"uBlocksize"),uStepW:b.getUniformLocation(a,
"uStepW"),uStepH:b.getUniformLocation(a,"uStepH")}},sendUniformData:function(b,a){b.uniform1f(a.uBlocksize,this.blocksize)}});e.Image.filters.Pixelate.fromObject=e.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={}),f=c.util.object.extend;e=c.Image.filters;var b=c.util.createClass;e.RemoveColor=b(e.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,
useAlpha:!1,applyTo2d:function(a){a=a.imageData.data;var b=255*this.distance;var e=(new c.Color(this.color)).getSource();var d=[e[0]-b,e[1]-b,e[2]-b],f=[e[0]+b,e[1]+b,e[2]+b];for(b=0;b<a.length;b+=4){e=a[b];var h=a[b+1];var m=a[b+2];e>d[0]&&h>d[1]&&m>d[2]&&e<f[0]&&h<f[1]&&m<f[2]&&(a[b+3]=0)}},getUniformLocations:function(a,b){return{uLow:a.getUniformLocation(b,"uLow"),uHigh:a.getUniformLocation(b,"uHigh")}},sendUniformData:function(a,b){var e=(new c.Color(this.color)).getSource(),d=parseFloat(this.distance),
g=[e[0]/255+d,e[1]/255+d,e[2]/255+d,1];a.uniform4fv(b.uLow,[e[0]/255-d,e[1]/255-d,e[2]/255-d,1]);a.uniform4fv(b.uHigh,g)},toObject:function(){return f(this.callSuper("toObject"),{color:this.color,distance:this.distance})}});c.Image.filters.RemoveColor.fromObject=c.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){e=e.fabric||(e.fabric={});var c=e.Image.filters,f=e.util.createClass,b={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,
-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]},a;for(a in b)c[a]=f(c.ColorMatrix,{type:a,matrix:b[a],mainParameter:!1,colorsOnly:!0}),e.Image.filters[a].fromObject=e.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric;e=c.Image.filters;var f=c.util.createClass;e.BlendColor=f(e.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",
darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",
tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(b){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[b]+"}\n}"},retrieveShader:function(b){var a=this.type+"_"+this.mode;if(!b.programCache.hasOwnProperty(a)){var c=this.buildSource(this.mode);b.programCache[a]=this.createProgram(b.context,
c)}return b.programCache[a]},applyTo2d:function(b){b=b.imageData.data;var a=b.length,e=1-this.alpha;var f=(new c.Color(this.color)).getSource();var d=f[0]*this.alpha;var k=f[1]*this.alpha;f=f[2]*this.alpha;for(var h=0;h<a;h+=4){var m=b[h];var q=b[h+1];var n=b[h+2];switch(this.mode){case "multiply":b[h]=m*d/255;b[h+1]=q*k/255;b[h+2]=n*f/255;break;case "screen":b[h]=255-(255-m)*(255-d)/255;b[h+1]=255-(255-q)*(255-k)/255;b[h+2]=255-(255-n)*(255-f)/255;break;case "add":b[h]=m+d;b[h+1]=q+k;b[h+2]=n+f;
break;case "diff":case "difference":b[h]=Math.abs(m-d);b[h+1]=Math.abs(q-k);b[h+2]=Math.abs(n-f);break;case "subtract":b[h]=m-d;b[h+1]=q-k;b[h+2]=n-f;break;case "darken":b[h]=Math.min(m,d);b[h+1]=Math.min(q,k);b[h+2]=Math.min(n,f);break;case "lighten":b[h]=Math.max(m,d);b[h+1]=Math.max(q,k);b[h+2]=Math.max(n,f);break;case "overlay":b[h]=128>d?2*m*d/255:255-2*(255-m)*(255-d)/255;b[h+1]=128>k?2*q*k/255:255-2*(255-q)*(255-k)/255;b[h+2]=128>f?2*n*f/255:255-2*(255-n)*(255-f)/255;break;case "exclusion":b[h]=
d+m-2*d*m/255;b[h+1]=k+q-2*k*q/255;b[h+2]=f+n-2*f*n/255;break;case "tint":b[h]=d+m*e,b[h+1]=k+q*e,b[h+2]=f+n*e}}},getUniformLocations:function(b,a){return{uColor:b.getUniformLocation(a,"uColor")}},sendUniformData:function(b,a){var e=(new c.Color(this.color)).getSource();e[0]=this.alpha*e[0]/255;e[1]=this.alpha*e[1]/255;e[2]=this.alpha*e[2]/255;e[3]=this.alpha;b.uniform4fv(a.uColor,e)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}});c.Image.filters.BlendColor.fromObject=
c.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric;e=c.Image.filters;var f=c.util.createClass;e.BlendImage=f(e.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",
mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(b){var a=this.type+"_"+this.mode,c=this.fragmentSource[this.mode];b.programCache.hasOwnProperty(a)||(b.programCache[a]=this.createProgram(b.context,c));return b.programCache[a]},
applyToWebGL:function(b){var a=b.context,c=this.createTexture(b.filterBackend,this.image);this.bindAdditionalTexture(a,c,a.TEXTURE1);this.callSuper("applyToWebGL",b);this.unbindAdditionalTexture(a,a.TEXTURE1)},createTexture:function(b,a){return b.getCachedTexture(a.cacheKey,a._element)},calculateMatrix:function(){var b=this.image;return[1/b.scaleX,0,0,0,1/b.scaleY,0,-b.left/b._element.width,-b.top/b._element.height,1]},applyTo2d:function(b){var a=b.imageData,e=b.filterBackend.resources;b=a.data;var f=
b.length,d=a.width;a=a.height;var k=this.image;e.blendImage||(e.blendImage=c.util.createCanvasElement());e=e.blendImage;var h=e.getContext("2d");e.width!==d||e.height!==a?(e.width=d,e.height=a):h.clearRect(0,0,d,a);h.setTransform(k.scaleX,0,0,k.scaleY,k.left,k.top);h.drawImage(k._element,0,0,d,a);var m=h.getImageData(0,0,d,a).data;for(var q=0;q<f;q+=4){h=b[q];var n=b[q+1];var x=b[q+2];var t=b[q+3];d=m[q];a=m[q+1];k=m[q+2];e=m[q+3];switch(this.mode){case "multiply":b[q]=h*d/255;b[q+1]=n*a/255;b[q+
2]=x*k/255;b[q+3]=t*e/255;break;case "mask":b[q+3]=e}}},getUniformLocations:function(b,a){return{uTransformMatrix:b.getUniformLocation(a,"uTransformMatrix"),uImage:b.getUniformLocation(a,"uImage")}},sendUniformData:function(b,a){var c=this.calculateMatrix();b.uniform1i(a.uImage,1);b.uniformMatrix3fv(a.uTransformMatrix,!1,c)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}});c.Image.filters.BlendImage.fromObject=function(b,a){c.Image.fromObject(b.image,
function(e){var f=c.util.object.clone(b);f.image=e;a(new c.Image.filters.BlendImage(f))})}})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={}),f=Math.pow,b=Math.floor,a=Math.sqrt,g=Math.abs,l=Math.round,d=Math.sin,k=Math.ceil;e=c.Image.filters;var h=c.util.createClass;e.Resize=h(e.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(a,b){return{uDelta:a.getUniformLocation(b,"uDelta"),uTaps:a.getUniformLocation(b,"uTaps")}},sendUniformData:function(a,b){a.uniform2fv(b.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]);a.uniform1fv(b.uTaps,
this.taps)},retrieveShader:function(a){var b=this.getFilterWindow(),c=this.type+"_"+b;a.programCache.hasOwnProperty(c)||(b=this.generateShader(b),a.programCache[c]=this.createProgram(a.context,b));return a.programCache[c]},getFilterWindow:function(){return Math.ceil(this.lanczosLobes/this.tempScale)},getTaps:function(){for(var a=this.lanczosCreate(this.lanczosLobes),b=this.tempScale,c=this.getFilterWindow(),d=Array(c),e=1;e<=c;e++)d[e-1]=a(e*b);return d},generateShader:function(a){for(var b=Array(a),
c=this.fragmentSourceTOP,d=1;d<=a;d++)b[d-1]=d+".0 * uDelta";c+="uniform float uTaps["+a+"];\n";c+="void main() {\n";c+="  vec4 color = texture2D(uTexture, vTexCoord);\n";c+="  float sum = 1.0;\n";b.forEach(function(a,b){c+="  color += texture2D(uTexture, vTexCoord + "+a+") * uTaps["+b+"];\n";c+="  color += texture2D(uTexture, vTexCoord - "+a+") * uTaps["+b+"];\n";c+="  sum += 2.0 * uTaps["+b+"];\n"});c+="  gl_FragColor = color / sum;\n";return c+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",
applyTo:function(a){a.webgl?(a.passes++,this.width=a.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=a.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),a.destinationWidth=this.dW,this._setupFrameBuffer(a),this.applyToWebGL(a),this._swapTextures(a),a.sourceWidth=a.destinationWidth,this.height=a.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),a.destinationHeight=
this.dH,this._setupFrameBuffer(a),this.applyToWebGL(a),this._swapTextures(a),a.sourceHeight=a.destinationHeight):this.applyTo2d(a)},isNeutralState:function(){return 1===this.scaleX&&1===this.scaleY},lanczosCreate:function(a){return function(b){if(b>=a||b<=-a)return 0;if(1.1920929E-7>b&&-1.1920929E-7<b)return 1;b*=Math.PI;var c=b/a;return d(b)/b*d(c)/c}},applyTo2d:function(a){var b=a.imageData,c=this.scaleX,d=this.scaleY;this.rcpScaleX=1/c;this.rcpScaleY=1/d;var e=b.width;b=b.height;c=l(e*c);d=l(b*
d);var f;"sliceHack"===this.resizeType?f=this.sliceByTwo(a,e,b,c,d):"hermite"===this.resizeType?f=this.hermiteFastResize(a,e,b,c,d):"bilinear"===this.resizeType?f=this.bilinearFiltering(a,e,b,c,d):"lanczos"===this.resizeType&&(f=this.lanczosResize(a,e,b,c,d));a.imageData=f},sliceByTwo:function(a,d,e,f,g){a=a.imageData;var k=!1,h=!1,l=.5*d,m=.5*e,n=c.filterBackend.resources,q=0,t=0,p=d,u=0;n.sliceByTwo||(n.sliceByTwo=document.createElement("canvas"));n=n.sliceByTwo;if(n.width<1.5*d||n.height<e)n.width=
1.5*d,n.height=e;var x=n.getContext("2d");x.clearRect(0,0,1.5*d,e);x.putImageData(a,0,0);f=b(f);for(g=b(g);!k||!h;)d=l,e=m,f<b(.5*l)?l=b(.5*l):(l=f,k=!0),g<b(.5*m)?m=b(.5*m):(m=g,h=!0),x.drawImage(n,q,t,d,e,p,u,l,m),q=p,t=u,u+=m;return x.getImageData(q,t,f,g)},lanczosResize:function(c,d,e,h,l){var m,n,q;function r(c){var k,w,v,y,C,B;n=(c+.5)*u;m=b(n);for(k=0;k<l;k++){q=(k+.5)*A;J=b(q);var K=B=C=y=v=0;for(w=m-F;w<=m+F;w++)if(!(0>w||w>=d)){var Q=b(1E3*g(w-n));D[Q]||(D[Q]={});for(var R=J-H;R<=J+H;R++)if(!(0>
R||R>=e)){var L=b(1E3*g(R-q));D[Q][L]||(D[Q][L]=p(a(f(Q*E,2)+f(L*G,2))/1E3));L=D[Q][L];if(0<L){var M=4*(R*d+w);v+=L;y+=L*t[M];C+=L*t[M+1];B+=L*t[M+2];K+=L*t[M+3]}}}M=4*(k*h+c);z[M]=y/v;z[M+1]=C/v;z[M+2]=B/v;z[M+3]=K/v}return++c<h?r(c):x}var t=c.imageData.data,x=c.ctx.createImageData(h,l),z=x.data,p=this.lanczosCreate(this.lanczosLobes),u=this.rcpScaleX,A=this.rcpScaleY,E=2/this.rcpScaleX,G=2/this.rcpScaleY,F=k(u*this.lanczosLobes/2),H=k(A*this.lanczosLobes/2),D={};var J=m=q=n=void 0;return r(0)},
bilinearFiltering:function(a,c,d,e,f){var g;d=0;var k=this.rcpScaleX,h=this.rcpScaleY,l=4*(c-1),m=a.imageData.data,n=a.ctx.createImageData(e,f),q=n.data;for(a=0;a<f;a++)for(g=0;g<e;g++){var p=b(k*g);var u=b(h*a);var t=k*g-p;var x=h*a-u;u=4*(u*c+p);for(p=0;4>p;p++){var G=m[u+p];var F=m[u+4+p];var H=m[u+l+p];var D=m[u+l+4+p];G=G*(1-t)*(1-x)+F*t*(1-x)+H*x*(1-t)+D*t*x;q[d++]=G}}return n},hermiteFastResize:function(c,d,e,f,h){e=this.rcpScaleX;var l=this.rcpScaleY,m=k(e/2),n=k(l/2),q=c.imageData.data;c=
c.ctx.createImageData(f,h);for(var t=c.data,x=0;x<h;x++)for(var z=0;z<f;z++){for(var p=4*(z+x*f),u,A=0,E=0,G=0,F=0,H=0,D=0,J=(x+.5)*l,K=b(x*l);K<(x+1)*l;K++){var N=g(J-(K+.5))/n,P=(z+.5)*e;N*=N;for(var O=b(z*e);O<(z+1)*e;O++){var I=g(P-(O+.5))/m;u=a(N+I*I);1<u&&-1>u||(u=2*u*u*u-3*u*u+1,0<u&&(I=4*(O+K*d),D+=u*q[I+3],E+=u,255>q[I+3]&&(u=u*q[I+3]/250),G+=u*q[I],F+=u*q[I+1],H+=u*q[I+2],A+=u))}}t[p]=G/A;t[p+1]=F/A;t[p+2]=H/A;t[p+3]=D/E}return c},toObject:function(){return{type:this.type,scaleX:this.scaleX,
scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}});c.Image.filters.Resize.fromObject=c.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){e=e.fabric||(e.fabric={});var c=e.Image.filters,f=e.util.createClass;c.Contrast=f(c.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(b){if(0!==
this.contrast){var a=b.imageData.data;b=a.length;var c=Math.floor(255*this.contrast);var e=259*(c+255)/(255*(259-c));for(c=0;c<b;c+=4)a[c]=e*(a[c]-128)+128,a[c+1]=e*(a[c+1]-128)+128,a[c+2]=e*(a[c+2]-128)+128}},getUniformLocations:function(b,a){return{uContrast:b.getUniformLocation(a,"uContrast")}},sendUniformData:function(b,a){b.uniform1f(a.uContrast,this.contrast)}});e.Image.filters.Contrast.fromObject=e.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){e=e.fabric||(e.fabric={});var c=e.Image.filters,f=e.util.createClass;c.Saturation=f(c.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",
saturation:0,mainParameter:"saturation",applyTo2d:function(b){if(0!==this.saturation){b=b.imageData.data;var a=b.length,c=-this.saturation,e;for(e=0;e<a;e+=4){var d=Math.max(b[e],b[e+1],b[e+2]);b[e]+=d!==b[e]?(d-b[e])*c:0;b[e+1]+=d!==b[e+1]?(d-b[e+1])*c:0;b[e+2]+=d!==b[e+2]?(d-b[e+2])*c:0}}},getUniformLocations:function(b,a){return{uSaturation:b.getUniformLocation(a,"uSaturation")}},sendUniformData:function(b,a){b.uniform1f(a.uSaturation,-this.saturation)}});e.Image.filters.Saturation.fromObject=
e.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={});e=c.Image.filters;var f=c.util.createClass;e.Blur=f(e.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,
mainParameter:"blur",applyTo:function(b){b.webgl?(this.aspectRatio=b.sourceWidth/b.sourceHeight,b.passes++,this._setupFrameBuffer(b),this.horizontal=!0,this.applyToWebGL(b),this._swapTextures(b),this._setupFrameBuffer(b),this.horizontal=!1,this.applyToWebGL(b),this._swapTextures(b)):this.applyTo2d(b)},applyTo2d:function(b){b.imageData=this.simpleBlur(b)},simpleBlur:function(b){var a=b.filterBackend.resources,e=b.imageData.width,f=b.imageData.height;a.blurLayer1||(a.blurLayer1=c.util.createCanvasElement(),
a.blurLayer2=c.util.createCanvasElement());var d=a.blurLayer1;var k=a.blurLayer2;if(d.width!==e||d.height!==f)k.width=d.width=e,k.height=d.height=f;a=d.getContext("2d");var h=k.getContext("2d"),m,q=.03*this.blur;a.putImageData(b.imageData,0,0);h.clearRect(0,0,e,f);for(m=-15;15>=m;m++){var n=(Math.random()-.5)/4;var x=m/15;var t=q*x*e+n;h.globalAlpha=1-Math.abs(x);h.drawImage(d,t,n);a.drawImage(k,0,0);h.globalAlpha=1;h.clearRect(0,0,k.width,k.height)}for(m=-15;15>=m;m++)n=(Math.random()-.5)/4,x=m/
15,t=q*x*f+n,h.globalAlpha=1-Math.abs(x),h.drawImage(d,n,t),a.drawImage(k,0,0),h.globalAlpha=1,h.clearRect(0,0,k.width,k.height);b.ctx.drawImage(d,0,0);b=b.ctx.getImageData(0,0,d.width,d.height);a.globalAlpha=1;a.clearRect(0,0,d.width,d.height);return b},getUniformLocations:function(b,a){return{delta:b.getUniformLocation(a,"uDelta")}},sendUniformData:function(b,a){var c=this.chooseRightDelta();b.uniform2fv(a.delta,c)},chooseRightDelta:function(){var b=1,a=[0,0];this.horizontal?1<this.aspectRatio&&
(b=1/this.aspectRatio):1>this.aspectRatio&&(b=this.aspectRatio);b=b*this.blur*.12;this.horizontal?a[0]=b:a[1]=b;return a}});e.Blur.fromObject=c.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){e=e.fabric||(e.fabric={});var c=e.Image.filters,f=e.util.createClass;c.Gamma=f(c.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,
1,1],mainParameter:"gamma",initialize:function(b){this.gamma=[1,1,1];c.BaseFilter.prototype.initialize.call(this,b)},applyTo2d:function(b){b=b.imageData.data;var a=this.gamma,c=1/a[0],e=1/a[1],d=1/a[2];this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256));var f=0;for(a=256;f<a;f++)this.rVals[f]=255*Math.pow(f/255,c),this.gVals[f]=255*Math.pow(f/255,e),this.bVals[f]=255*Math.pow(f/255,d);f=0;for(a=b.length;f<a;f+=4)b[f]=this.rVals[b[f]],b[f+1]=this.gVals[b[f+
1]],b[f+2]=this.bVals[b[f+2]]},getUniformLocations:function(b,a){return{uGamma:b.getUniformLocation(a,"uGamma")}},sendUniformData:function(b,a){b.uniform3fv(a.uGamma,this.gamma)}});e.Image.filters.Gamma.fromObject=e.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={});e=c.Image.filters;var f=c.util.createClass;e.Composed=f(e.BaseFilter,{type:"Composed",subFilters:[],initialize:function(b){this.callSuper("initialize",b);this.subFilters=this.subFilters.slice(0)},applyTo:function(b){b.passes+=this.subFilters.length-1;this.subFilters.forEach(function(a){a.applyTo(b)})},toObject:function(){return c.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(b){return b.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(b){return!b.isNeutralState()})}});
c.Image.filters.Composed.fromObject=function(b,a){b=(b.subFilters||[]).map(function(a){return new c.Image.filters[a.type](a)});b=new c.Image.filters.Composed({subFilters:b});a&&a(b);return b}})("undefined"!==typeof exports?exports:this);
(function(e){var c=e.fabric||(e.fabric={}),f=c.Image.filters;e=c.util.createClass;f.HueRotation=e(f.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var b=this.rotation*Math.PI,a=c.util.cos(b),e=c.util.sin(b);b=1/3;e*=Math.sqrt(b);var f=1-a;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this.matrix[0]=a+f/3;this.matrix[1]=b*f-e;this.matrix[2]=b*f+e;this.matrix[5]=b*f+e;this.matrix[6]=a+b*f;this.matrix[7]=b*f-e;this.matrix[10]=b*f-e;this.matrix[11]=
b*f+e;this.matrix[12]=a+b*f},isNeutralState:function(b){this.calculateMatrix();return f.BaseFilter.prototype.isNeutralState.call(this,b)},applyTo:function(b){this.calculateMatrix();f.BaseFilter.prototype.applyTo.call(this,b)}});c.Image.filters.HueRotation.fromObject=c.Image.filters.BaseFilter.fromObject})("undefined"!==typeof exports?exports:this);
